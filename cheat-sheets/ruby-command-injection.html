<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-cheat-sheets/ruby-command-injection" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.7.0">
<title data-rh="true">Command injection prevention for Ruby | Semgrep</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://semgrep.dev/thumbnail.png"><meta data-rh="true" name="twitter:image" content="https://semgrep.dev/thumbnail.png"><meta data-rh="true" property="og:url" content="https://kyle-semgrep.github.io/semgrep-docs/cheat-sheets/ruby-command-injection"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Command injection prevention for Ruby | Semgrep"><meta data-rh="true" name="description" content="Command injection prevention cheat sheet for Ruby."><meta data-rh="true" property="og:description" content="Command injection prevention cheat sheet for Ruby."><link data-rh="true" rel="icon" href="/semgrep-docs/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://kyle-semgrep.github.io/semgrep-docs/cheat-sheets/ruby-command-injection"><link data-rh="true" rel="alternate" href="https://kyle-semgrep.github.io/semgrep-docs/cheat-sheets/ruby-command-injection" hreflang="en"><link data-rh="true" rel="alternate" href="https://kyle-semgrep.github.io/semgrep-docs/cheat-sheets/ruby-command-injection" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/semgrep-docs/release-notes/rss.xml" title=" RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/semgrep-docs/release-notes/atom.xml" title=" Atom Feed">

<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-XYYV814DDN"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-XYYV814DDN",{})</script>






<script src="https://kit.fontawesome.com/9a8c23ae22.js" crossorigin="anonymous" async></script>
<script src="https://semgrep.dev/docs/fs.js" async></script>
<script src="/docs/js/gtm.js" async></script><link rel="stylesheet" href="/semgrep-docs/assets/css/styles.efff8e51.css">
<script src="/semgrep-docs/assets/js/runtime~main.fa9d5b51.js" defer="defer"></script>
<script src="/semgrep-docs/assets/js/main.5fd054fd.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a href="https://semgrep.dev" target="_self" rel="noopener noreferrer" class="navbar__brand"><div class="navbar__logo"><img src="/semgrep-docs/img/semgrep-icon-text-horizontal.svg" alt="Semgrep logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/semgrep-docs/img/semgrep-icon-text-horizontal-dark.svg" alt="Semgrep logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div></a><a href="https://semgrep.dev/api/v1/docs" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">API</a><a href="https://semgrep.dev/explore" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Registry</a><a href="https://semgrep.dev/editor" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Playground</a><a class="navbar__item navbar__link" href="/semgrep-docs/kb">Knowledge base</a><a href="https://academy.semgrep.dev" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Semgrep Academy</a></div><div class="navbar__items navbar__items--right"><a href="https://semgrep.dev/orgs/-" target="_self" rel="noopener noreferrer" class="navbar__item navbar__link">Login</a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite" aria-pressed="false"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><div id="markprompt"></div><div class="navbar__search"><button id="search_input_react" type="button" aria-label="Search or ask" class="navbar__search-input search-bar" style="text-align:left">Search or ask</button></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item home-top-level"><a class="menu__link" href="/semgrep-docs/">Docs home</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--active">Cheat sheets</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/semgrep-docs/cheat-sheets/overview">Cheat sheets</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/semgrep-docs/category/code-injection">Code injection</a><button aria-label="Expand sidebar category &#x27;Code injection&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" tabindex="0" href="/semgrep-docs/category/command-injection">Command injection</a><button aria-label="Collapse sidebar category &#x27;Command injection&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/semgrep-docs/cheat-sheets/go-command-injection">Command injection prevention for Go</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/semgrep-docs/cheat-sheets/java-command-injection">Command injection prevention for Java</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/semgrep-docs/cheat-sheets/javascript-command-injection">Command injection prevention for JavaScript</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/semgrep-docs/cheat-sheets/python-command-injection">Command injection prevention for Python</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/semgrep-docs/cheat-sheets/ruby-command-injection">Command injection prevention for Ruby</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/semgrep-docs/category/xss">XSS</a><button aria-label="Expand sidebar category &#x27;XSS&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/semgrep-docs/category/xxe">XXE</a><button aria-label="Expand sidebar category &#x27;XXE&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></ul></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/semgrep-docs/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Cheat sheets</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/semgrep-docs/category/command-injection"><span itemprop="name">Command injection</span></a><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Command injection prevention for Ruby</span><meta itemprop="position" content="3"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><ul class="top-tag-list padding--none"></ul><header><h1>Command injection prevention for Ruby</h1></header>
<p>This is a command injection prevention cheat sheet by Semgrep, Inc. It contains code patterns of potential ways to run an OS command in an application. Instead of scrutinizing code for exploitable vulnerabilities, the recommendations in this cheat sheet pave a safe road for developers that mitigate the possibility of command injection in your code. By following these recommendations, you can be reasonably sure your code is free of command injection.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="check-your-project-using-semgrep">Check your project using Semgrep<a href="#check-your-project-using-semgrep" class="hash-link" aria-label="Direct link to Check your project using Semgrep" title="Direct link to Check your project using Semgrep">​</a></h3>
<p>The following command runs an optimized set of rules for your project:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">semgrep </span><span class="token parameter variable" style="color:#36acaa">--config</span><span class="token plain"> p/default</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="1-running-os-commands">1. Running OS commands<a href="#1-running-os-commands" class="hash-link" aria-label="Direct link to 1. Running OS commands" title="Direct link to 1. Running OS commands">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="1a-open3-module">1.A. Open3 module<a href="#1a-open3-module" class="hash-link" aria-label="Direct link to 1.A. Open3 module" title="Direct link to 1.A. Open3 module">​</a></h3>
<p><code>Open3</code> grants access to running processes when running another program. For more information, see <a href="https://docs.ruby-lang.org/en/2.0.0/Open3.html" target="_blank" rel="noopener noreferrer">Ruby documentation</a>. Such methods as <code>capture2</code>, <code>capture2e</code>, <code>capture3</code>, <code>popen2</code>, <code>popen2e</code>, <code>popen3</code>, <code>pipeline</code>, <code>pipeline_r</code>, <code>pipeline_rw</code>, <code>pipeline_start</code> and <code>pipeline_w</code> are intended for running commands provided as a string. Letting user supplied data in a command that is passed as an argument to one of these methods, can create an opportunity for a command injection vulnerability.</p>
<p>Examples:</p>
<div class="language-ruby codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ruby codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">require</span><span class="token plain"> </span><span class="token string-literal string" style="color:#e3116c">&#x27;open3&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># safe</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Open3</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">popen3</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-literal string" style="color:#e3116c">&quot;ls -la&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># vulnerable</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">user_input </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string-literal string" style="color:#e3116c">&quot;  &amp;&amp; cat /etc/passwd&quot;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># Value supplied by user</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Open3</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">popen3</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-literal string" style="color:#e3116c">&quot;ls </span><span class="token string-literal interpolation delimiter punctuation" style="color:#393A34">#{</span><span class="token string-literal interpolation content">user_input</span><span class="token string-literal interpolation delimiter punctuation" style="color:#393A34">}</span><span class="token string-literal string" style="color:#e3116c">&quot;</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-ruby codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ruby codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">require</span><span class="token plain"> </span><span class="token string-literal string" style="color:#e3116c">&#x27;open3&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># safe</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">fname </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string-literal string" style="color:#e3116c">&quot;/usr/share/man/man1/ls.1.gz&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Open3</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">pipeline</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string-literal string" style="color:#e3116c">&quot;zcat&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> fname</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string-literal string" style="color:#e3116c">&quot;nroff -man&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string-literal string" style="color:#e3116c">&quot;colcrt&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># vulnerable</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">user_input </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string-literal string" style="color:#e3116c">&quot;  &amp;&amp; cat /etc/passwd&quot;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># Value supplied by user</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Open3</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">pipeline</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-literal string" style="color:#e3116c">&quot;zcat </span><span class="token string-literal interpolation delimiter punctuation" style="color:#393A34">#{</span><span class="token string-literal interpolation content">user_input</span><span class="token string-literal interpolation delimiter punctuation" style="color:#393A34">}</span><span class="token string-literal string" style="color:#e3116c">&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string-literal string" style="color:#e3116c">&quot;nroff -man&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string-literal string" style="color:#e3116c">&quot;colcrt&quot;</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="references">References<a href="#references" class="hash-link" aria-label="Direct link to References" title="Direct link to References">​</a></h4>
<ul>
<li><a href="https://docs.ruby-lang.org/en/2.0.0/Open3.html" target="_blank" rel="noopener noreferrer"><code>Open3</code></a> documentation.</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="mitigation">Mitigation<a href="#mitigation" class="hash-link" aria-label="Direct link to Mitigation" title="Direct link to Mitigation">​</a></h4>
<ul>
<li>
<p>Do not pass user input to <code>Open3</code> methods.</p>
</li>
<li>
<p>Always try to use the internal Ruby API (if it exists) instead of running an OS command. Use internal language features instead of invoking commands that can be exploited.</p>
</li>
<li>
<p>Don&#x27;t pass user-controlled input or use an allowlist for inputs.</p>
</li>
<li>
<p>Do not include command arguments in a command string, use parameterization instead. For example:<br></p>
<p>Instead of the following code:</p>
<div class="language-ruby codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ruby codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Open3</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">pipeline</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string-literal string" style="color:#e3116c">&quot;bash&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string-literal string" style="color:#e3116c">&quot;-c&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string-literal string" style="color:#e3116c">&quot;myCommand myArg1 &quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> input_value</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Use:</p>
<div class="language-ruby codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ruby codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Open3</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">pipeline</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string-literal string" style="color:#e3116c">&quot;/path/to/myCommand&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string-literal string" style="color:#e3116c">&quot;myArg1&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> input_value</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
<li>
<p>Define a list of allowed arguments.</p>
</li>
<li>
<p>Avoid non-literal values for the command string. Strip everything except alphanumeric characters from an input provided for the command string and arguments.</p>
</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="semgrep-rule">Semgrep rule<a href="#semgrep-rule" class="hash-link" aria-label="Direct link to Semgrep rule" title="Direct link to Semgrep rule">​</a></h4>
<a href="https://semgrep.dev/r?q=ruby.lang.security.dangerous-open3-pipeline.dangerous-open3-pipeline" target="_blank">ruby.lang.security.dangerous-open3-pipeline.dangerous-open3-pipeline</a>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="1b-open-function">1.B. open() function<a href="#1b-open-function" class="hash-link" aria-label="Direct link to 1.B. open() function" title="Direct link to 1.B. open() function">​</a></h3>
<p>The <code>open(...)</code> function creates an input/output (I/O) object connected to a stream, file, or subprocess. If the first argument starts with a pipe character (<code>|</code>), it creates a subprocess. An opportunity for a command injection vulnerability is created when the subprocess includes user input in a command argument to <code>open()</code> function.</p>
<p>Example:</p>
<div class="language-ruby codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ruby codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># safe</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">open</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-literal string" style="color:#e3116c">&quot;my_file.txt&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># vulnerable</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">user_input </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> “</span><span class="token operator" style="color:#393A34">|</span><span class="token plain">cat </span><span class="token operator" style="color:#393A34">/</span><span class="token plain">etc</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">passwd” </span><span class="token comment" style="color:#999988;font-style:italic"># Value supplied by user</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">open</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">user_input</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="references-1">References<a href="#references-1" class="hash-link" aria-label="Direct link to References" title="Direct link to References">​</a></h4>
<ul>
<li><a href="https://apidock.com/ruby/Kernel/open" target="_blank" rel="noopener noreferrer">open</a> documentation.</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="mitigation-1">Mitigation<a href="#mitigation-1" class="hash-link" aria-label="Direct link to Mitigation" title="Direct link to Mitigation">​</a></h4>
<ul>
<li>Do not provide raw user input to the <code>open()</code> function.</li>
<li>Always try to use the internal Ruby API (if it exists) instead of running an OS command. Use internal language features instead of invoking commands that can be exploited.</li>
<li>If the use of user input is unavoidable, create an allowlist for inputs, such as allowed command arguments.</li>
<li>Strip everything except alphanumeric characters from an input provided for the command string and arguments.</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="semgrep-rule-1">Semgrep rule<a href="#semgrep-rule-1" class="hash-link" aria-label="Direct link to Semgrep rule" title="Direct link to Semgrep rule">​</a></h4>
<a href="https://semgrep.dev/r?q=ruby.lang.security.dangerous-open.dangerous-open" target="_blank">ruby.lang.security.dangerous-open.dangerous-open</a>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="1c-system-function">1.C. system() function<a href="#1c-system-function" class="hash-link" aria-label="Direct link to 1.C. system() function" title="Direct link to 1.C. system() function">​</a></h3>
<p>The <code>system()</code> function executes OS commands in a subshell. This might potentially lead to a command injection vulnerability when used with user input. A malicious actor can potentially run OS commands to exploit the system.</p>
<p>Example:</p>
<div class="language-ruby codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ruby codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># safe</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">system</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-literal string" style="color:#e3116c">&quot;ls -lah /tmp&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># vulnerable</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">user_input </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string-literal string" style="color:#e3116c">&#x27; &amp;&amp; cat /etc/passwd&#x27;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># Value supplied by user</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">system</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-literal string" style="color:#e3116c">&quot;ls </span><span class="token string-literal interpolation delimiter punctuation" style="color:#393A34">#{</span><span class="token string-literal interpolation content">user_input</span><span class="token string-literal interpolation delimiter punctuation" style="color:#393A34">}</span><span class="token string-literal string" style="color:#e3116c">&quot;</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="references-2">References<a href="#references-2" class="hash-link" aria-label="Direct link to References" title="Direct link to References">​</a></h4>
<ul>
<li><a href="https://apidock.com/ruby/Kernel/system" target="_blank" rel="noopener noreferrer"><code>system()</code> documentation</a></li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="mitigation-2">Mitigation<a href="#mitigation-2" class="hash-link" aria-label="Direct link to Mitigation" title="Direct link to Mitigation">​</a></h4>
<ul>
<li>Do not provide raw user input to the <code>system()</code> function.</li>
<li>Always try to use the internal Ruby API (if it exists) instead of running an OS command. Use internal language features instead of invoking commands that can be exploited.</li>
<li>If the use of user input is unavoidable, create an allowlist for inputs, such as allowed arguments.</li>
<li>Strip everything except alphanumeric characters from an input provided for the command string and arguments.</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="semgrep-rule-2">Semgrep rule<a href="#semgrep-rule-2" class="hash-link" aria-label="Direct link to Semgrep rule" title="Direct link to Semgrep rule">​</a></h4>
<a href="https://semgrep.dev/r?q=ruby.lang.security.dangerous-exec.dangerous-exec" target="_blank">ruby.lang.security.dangerous-exec.dangerous-exec</a>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="1d-exec-function">1.D. exec() function<a href="#1d-exec-function" class="hash-link" aria-label="Direct link to 1.D. exec() function" title="Direct link to 1.D. exec() function">​</a></h3>
<p>The <code>exec()</code> function executes OS commands. This might potentially lead to a command injection vulnerability when used with user input. A malicious actor can potentially run OS commands to exploit the system.</p>
<p>Example:</p>
<div class="language-ruby codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ruby codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># safe</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">exec</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-literal string" style="color:#e3116c">&quot;ls -lah /tmp&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># vulnerable</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">user_input </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string-literal string" style="color:#e3116c">&#x27; &amp;&amp; cat /etc/passwd&#x27;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># Value supplied by user</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">exec</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-literal string" style="color:#e3116c">&quot;ls </span><span class="token string-literal interpolation delimiter punctuation" style="color:#393A34">#{</span><span class="token string-literal interpolation content">user_input</span><span class="token string-literal interpolation delimiter punctuation" style="color:#393A34">}</span><span class="token string-literal string" style="color:#e3116c">&quot;</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="references-3">References<a href="#references-3" class="hash-link" aria-label="Direct link to References" title="Direct link to References">​</a></h4>
<ul>
<li><a href="https://apidock.com/ruby/Kernel/exec" target="_blank" rel="noopener noreferrer"><code>exec()</code> documentation</a></li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="mitigation-3">Mitigation<a href="#mitigation-3" class="hash-link" aria-label="Direct link to Mitigation" title="Direct link to Mitigation">​</a></h4>
<ul>
<li>Do not provide raw user input to the <code>exec()</code> function.</li>
<li>Always try to use the internal Ruby API (if it exists) instead of running an OS command. Use internal language features instead of invoking commands that can be exploited.</li>
<li>If the use of user input is unavoidable, create an allowlist for inputs, such as allowed arguments.</li>
<li>Strip everything except alphanumeric characters from an input provided for the command string and arguments.</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="semgrep-rule-3">Semgrep rule<a href="#semgrep-rule-3" class="hash-link" aria-label="Direct link to Semgrep rule" title="Direct link to Semgrep rule">​</a></h4>
<a href="https://semgrep.dev/r?q=ruby.lang.security.dangerous-exec.dangerous-exec" target="_blank">ruby.lang.security.dangerous-exec.dangerous-exec</a>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="1d-spawn-function">1.D. spawn() function<a href="#1d-spawn-function" class="hash-link" aria-label="Direct link to 1.D. spawn() function" title="Direct link to 1.D. spawn() function">​</a></h3>
<p>The <code>spawn()</code> function executes OS commands. This might potentially lead to a command injection vulnerability when used with user input. A malicious actor can potentially run OS commands to exploit the system.</p>
<p>Example:</p>
<div class="language-ruby codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ruby codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># safe</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pid </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> spawn</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-literal string" style="color:#e3116c">&quot;ls -lah /tmp&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Process</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">wait pid</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># vulnerable</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">user_input </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string-literal string" style="color:#e3116c">&#x27; &amp;&amp; cat /etc/passwd&#x27;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># Value supplied by user</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pid </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> spawn</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-literal string" style="color:#e3116c">&quot;ls </span><span class="token string-literal interpolation delimiter punctuation" style="color:#393A34">#{</span><span class="token string-literal interpolation content">user_input</span><span class="token string-literal interpolation delimiter punctuation" style="color:#393A34">}</span><span class="token string-literal string" style="color:#e3116c">&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Process</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">wait pid</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="references-4">References<a href="#references-4" class="hash-link" aria-label="Direct link to References" title="Direct link to References">​</a></h4>
<ul>
<li><a href="https://apidock.com/ruby/Kernel/spawn" target="_blank" rel="noopener noreferrer"><code>spawn()</code> documentation</a></li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="mitigation-4">Mitigation<a href="#mitigation-4" class="hash-link" aria-label="Direct link to Mitigation" title="Direct link to Mitigation">​</a></h4>
<ul>
<li>Do not provide raw user input to the <code>spawn()</code> function.</li>
<li>Always try to use the internal Ruby API (if it exists) instead of running an OS command. Use internal language features instead of invoking commands that can be exploited.</li>
<li>If the use of user input is unavoidable, create an allowlist for inputs, such as allowed arguments.</li>
<li>Strip everything except alphanumeric characters from an input provided for the command string and arguments.</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="semgrep-rule-4">Semgrep rule<a href="#semgrep-rule-4" class="hash-link" aria-label="Direct link to Semgrep rule" title="Direct link to Semgrep rule">​</a></h4>
<a href="https://semgrep.dev/r?q=ruby.lang.security.dangerous-exec.dangerous-exec" target="_blank">ruby.lang.security.dangerous-exec.dangerous-exec</a>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="1e-backticks--or-xcommand-methods">1.E. Backticks (``) or %x[command] methods<a href="#1e-backticks--or-xcommand-methods" class="hash-link" aria-label="Direct link to 1.E. Backticks (``) or %x[command] methods" title="Direct link to 1.E. Backticks (``) or %x[command] methods">​</a></h3>
<p>Backticks <code>``</code> or <code>%x[command]</code> methods allow Ruby developers to execute system commands and return their outputs. Both methods accept string interpolation. As for other methods mentioned in this cheat sheet, when this method is used with user input, it can lead to a command injection vulnerability.</p>
<p>Ruby interprets the text inside of backticks as an OS command. For example, <code>`ls -l`</code> interpreted by Ruby prints the contents of current working directory. In addition, if the <code>%x</code> is used with various delimiters, it is also interpreted as an OS command. The <code>`ls -l`</code> in Ruby is equivivalent to the following:</p>
<ul>
<li><code>%x`ls -l`</code></li>
<li><code>%x;ls -l;</code></li>
<li><code>%x(ls -l)</code></li>
<li><code>%x&quot;ls -l&quot;</code></li>
<li><code>%x{ls -l}</code></li>
<li><code>%x:ls -l:</code></li>
<li><code>%x&#x27;ls -l&#x27;</code></li>
<li><code>%x[ls -l]</code></li>
</ul>
<p>Example:</p>
<div class="language-ruby codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ruby codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># safe</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token command-literal command string" style="color:#e3116c">`ls -lah /tmp`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token command-literal command string" style="color:#e3116c">%x[ ls -lah /tmp ]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token command-literal command string" style="color:#e3116c">%x{ ls -lah /tmp }</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># vulnerable</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">user_input </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string-literal string" style="color:#e3116c">&#x27; &amp;&amp; cat /etc/passwd&#x27;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># Value supplied by user</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token command-literal command string" style="color:#e3116c">`ls </span><span class="token command-literal interpolation delimiter punctuation" style="color:#393A34">#{</span><span class="token command-literal interpolation content">user_input</span><span class="token command-literal interpolation delimiter punctuation" style="color:#393A34">}</span><span class="token command-literal command string" style="color:#e3116c">`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token command-literal command string" style="color:#e3116c">%x{ls </span><span class="token command-literal interpolation delimiter punctuation" style="color:#393A34">#{</span><span class="token command-literal interpolation content">user_input</span><span class="token command-literal interpolation delimiter punctuation" style="color:#393A34">}</span><span class="token command-literal command string" style="color:#e3116c">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="references-5">References<a href="#references-5" class="hash-link" aria-label="Direct link to References" title="Direct link to References">​</a></h4>
<ul>
<li>Ruby <a href="https://ruby-doc.org/3.2.1/Kernel.html" target="_blank" rel="noopener noreferrer">Kernel</a> documentation.</li>
<li>Ruby <a href="https://ruby-doc.org/3.2.1/command_injection_rdoc.html" target="_blank" rel="noopener noreferrer">command injection</a> documentation.</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="mitigation-5">Mitigation<a href="#mitigation-5" class="hash-link" aria-label="Direct link to Mitigation" title="Direct link to Mitigation">​</a></h4>
<ul>
<li>Do not provide raw user input to <code>``</code> or <code>%x</code> methods.</li>
<li>Always try to use the internal Ruby API (if it exists) instead of running an OS command. Use internal language features instead of invoking commands that can be exploited.</li>
<li>If the use of user input is unavoidable, create an allowlist for inputs, such as allowed arguments.</li>
<li>Strip everything except alphanumeric characters from an input provided for the command string and arguments.</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="semgrep-rule-5">Semgrep rule<a href="#semgrep-rule-5" class="hash-link" aria-label="Direct link to Semgrep rule" title="Direct link to Semgrep rule">​</a></h4>
<a href="https://semgrep.dev/r?q=ruby.lang.security.dangerous-subshell.dangerous-subshell" target="_blank">ruby.lang.security.dangerous-subshell.dangerous-subshell</a>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="1f-processspawn-and-processexec-methods">1.F. Process.spawn and Process.exec methods<a href="#1f-processspawn-and-processexec-methods" class="hash-link" aria-label="Direct link to 1.F. Process.spawn and Process.exec methods" title="Direct link to 1.F. Process.spawn and Process.exec methods">​</a></h3>
<p>The <code>spawn</code> and <code>exec</code> methods execute a system command and return its output. Both methods accept string interpolation. Similarly to other methods mentioned in this cheat sheet, when either of these methods is used with user input, it can lead to command injection vulnerability.</p>
<p><a href="https://ruby-doc.org/3.2.1/Process.html" target="_blank" rel="noopener noreferrer">https://ruby-doc.org/3.2.1/Process.html</a></p>
<p>Example:</p>
<div class="language-ruby codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ruby codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># safe</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Process</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">spawn</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-literal string" style="color:#e3116c">&quot;ls -alh&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Process</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">spawn</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-literal string" style="color:#e3116c">&quot;ls&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string-literal string" style="color:#e3116c">&quot;-alh&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Process</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">spawn</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string-literal string" style="color:#e3116c">&quot;ls&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string-literal string" style="color:#e3116c">&quot;-alh&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># vulnerable</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">user_input </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string-literal string" style="color:#e3116c">&#x27; &amp;&amp; cat /etc/passwd&#x27;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># Value supplied by user</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Process</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">spawn</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-literal string" style="color:#e3116c">&quot;ls </span><span class="token string-literal interpolation delimiter punctuation" style="color:#393A34">#{</span><span class="token string-literal interpolation content">user_input</span><span class="token string-literal interpolation delimiter punctuation" style="color:#393A34">}</span><span class="token string-literal string" style="color:#e3116c">&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># safe</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Process</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">exec</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-literal string" style="color:#e3116c">&quot;ls -alh&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Process</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">exec</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-literal string" style="color:#e3116c">&quot;ls&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string-literal string" style="color:#e3116c">&quot;-alh&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Process</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">exec</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string-literal string" style="color:#e3116c">&quot;ls&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string-literal string" style="color:#e3116c">&quot;-alh&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># vulnerable</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">user_input </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string-literal string" style="color:#e3116c">&#x27; &amp;&amp; cat /etc/passwd&#x27;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># Value supplied by user</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Process</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">exec</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-literal string" style="color:#e3116c">&quot;ls </span><span class="token string-literal interpolation delimiter punctuation" style="color:#393A34">#{</span><span class="token string-literal interpolation content">user_input</span><span class="token string-literal interpolation delimiter punctuation" style="color:#393A34">}</span><span class="token string-literal string" style="color:#e3116c">&quot;</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="references-6">References<a href="#references-6" class="hash-link" aria-label="Direct link to References" title="Direct link to References">​</a></h4>
<ul>
<li><a href="https://ruby-doc.org/3.2.1/Process.html" target="_blank" rel="noopener noreferrer">Process</a> documentation.</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="mitigation-6">Mitigation<a href="#mitigation-6" class="hash-link" aria-label="Direct link to Mitigation" title="Direct link to Mitigation">​</a></h4>
<ul>
<li>Do not provide raw user input to <code>Process.spawn</code> and <code>Process.exec</code> methods.</li>
<li>Always try to use internal Ruby API (if it exists) instead of running an OS command. Use internal language features instead of invoking commands that can be exploited.</li>
<li>If the use of user input is unavoidable, create an allowlist for inputs, such as allowed arguments.</li>
<li>Strip everything except alphanumeric characters from an input provided for the command string and arguments.</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="semgrep-rule-6">Semgrep rule<a href="#semgrep-rule-6" class="hash-link" aria-label="Direct link to Semgrep rule" title="Direct link to Semgrep rule">​</a></h4>
<a href="https://semgrep.dev/r?q=ruby.lang.security.dangerous-exec.dangerous-exec" target="_blank">ruby.lang.security.dangerous-exec.dangerous-exec</a>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="1f-ptyspawn-method">1.F. PTY.spawn method<a href="#1f-ptyspawn-method" class="hash-link" aria-label="Direct link to 1.F. PTY.spawn method" title="Direct link to 1.F. PTY.spawn method">​</a></h3>
<p>The <code>PTY.spawn</code> method executes OS commands in a new terminal. This might potentially lead to a command injection vulnerability when used with user input. A malicious actor can potentially run OS commands to exploit the system.</p>
<p>Example:</p>
<div class="language-ruby codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ruby codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># safe</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">stdout</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">stdin</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">pid </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">PTY</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">spawn</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-literal string" style="color:#e3116c">&quot;ls -lah&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># vulnerable</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">user_input </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string-literal string" style="color:#e3116c">&#x27; &amp;&amp; cat /etc/passwd&#x27;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># Value supplied by user</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">stdout</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">stdin</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">pid </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">PTY</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">spawn</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-literal string" style="color:#e3116c">&quot;ls </span><span class="token string-literal interpolation delimiter punctuation" style="color:#393A34">#{</span><span class="token string-literal interpolation content">user_input</span><span class="token string-literal interpolation delimiter punctuation" style="color:#393A34">}</span><span class="token string-literal string" style="color:#e3116c">&quot;</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="references-7">References<a href="#references-7" class="hash-link" aria-label="Direct link to References" title="Direct link to References">​</a></h4>
<ul>
<li><a href="https://ruby-doc.org/3.2.1/exts/pty/PTY.html" target="_blank" rel="noopener noreferrer">PTY</a> library documentation.</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="mitigation-7">Mitigation<a href="#mitigation-7" class="hash-link" aria-label="Direct link to Mitigation" title="Direct link to Mitigation">​</a></h4>
<ul>
<li>Do not provide raw user input to <code>PTY.spawn</code> methods.</li>
<li>Always try to use the internal Ruby API (if it exists) instead of running an OS command. Use internal language features instead of invoking commands that can be exploited.</li>
<li>If the use of user input is unavoidable, create an allowlist for inputs, such as allowed arguments.</li>
<li>Strip everything except alphanumeric characters from an input provided for the command string and arguments.</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="semgrep-rule-7">Semgrep rule<a href="#semgrep-rule-7" class="hash-link" aria-label="Direct link to Semgrep rule" title="Direct link to Semgrep rule">​</a></h4>
<a href="https://semgrep.dev/r?q=ruby.lang.security.dangerous-exec.dangerous-exec" target="_blank">ruby.lang.security.dangerous-exec.dangerous-exec</a><div><hr><p>Not finding what you need in this doc? Ask questions in our <a href="https://go.semgrep.dev/slack">Community Slack group</a>, or see <a href="/docs/support/">Support</a> for other ways to get help.</p></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/kyle-semgrep/semgrep-docs/edit/main?base=kyle-semgrep:main/docs/cheat-sheets/ruby-command-injection.mdx" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"><span class="theme-last-updated">Last updated<!-- --> on <b><time datetime="2025-07-11T17:18:25.000Z" itemprop="dateModified">Jul 11, 2025</time></b></span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/semgrep-docs/cheat-sheets/python-command-injection"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Command injection prevention for Python</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/semgrep-docs/category/xss"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">XSS</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#check-your-project-using-semgrep" class="table-of-contents__link toc-highlight">Check your project using Semgrep</a></li><li><a href="#1-running-os-commands" class="table-of-contents__link toc-highlight">1. Running OS commands</a><ul><li><a href="#1a-open3-module" class="table-of-contents__link toc-highlight">1.A. Open3 module</a></li><li><a href="#1b-open-function" class="table-of-contents__link toc-highlight">1.B. open() function</a></li><li><a href="#1c-system-function" class="table-of-contents__link toc-highlight">1.C. system() function</a></li><li><a href="#1d-exec-function" class="table-of-contents__link toc-highlight">1.D. exec() function</a></li><li><a href="#1d-spawn-function" class="table-of-contents__link toc-highlight">1.D. spawn() function</a></li><li><a href="#1e-backticks--or-xcommand-methods" class="table-of-contents__link toc-highlight">1.E. Backticks (``) or %x[command] methods</a></li><li><a href="#1f-processspawn-and-processexec-methods" class="table-of-contents__link toc-highlight">1.F. Process.spawn and Process.exec methods</a></li><li><a href="#1f-ptyspawn-method" class="table-of-contents__link toc-highlight">1.F. PTY.spawn method</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="footer"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://go.semgrep.dev/slack" target="_blank" rel="noopener noreferrer" class="footer__link-item">Slack<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/semgrep/semgrep" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/semgrep/semgrep/issues" target="_blank" rel="noopener noreferrer" class="footer__link-item">File an issue<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Products</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://semgrep.dev/products/semgrep-code/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Semgrep Code</a></li><li class="footer__item"><a href="https://semgrep.dev/products/semgrep-supply-chain/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Semgrep Supply Chain</a></li><li class="footer__item"><a href="https://semgrep.dev/products/semgrep-appsec-platform/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Semgrep AppSec Platform</a></li></ul></div><div class="col footer__col"><div class="footer__title">Resources</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" target="_self" href="/semgrep-docs/docs">Docs</a></li><li class="footer__item"><a href="https://semgrep.dev/blog" target="_blank" rel="noopener noreferrer" class="footer__link-item">Blog</a></li><li class="footer__item"><a href="https://semgrep.dev/contact/demo" target="_blank" rel="noopener noreferrer" class="footer__link-item">Book a demo</a></li><li class="footer__item"><a href="https://semgrep.dev/pricing/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Pricing</a></li><li class="footer__item"><a href="https://semgrep.dev/privacy" target="_self" rel="noopener noreferrer" class="footer__link-item">Privacy</a></li><li class="footer__item"><a href="https://semgrep.dev/terms" target="_blank" rel="noopener noreferrer" class="footer__link-item">Terms of service</a></li></ul></div><div class="col footer__col"><div class="footer__title">Company</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://semgrep.dev/about" target="_blank" rel="noopener noreferrer" class="footer__link-item">About<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://semgrep.dev/about/careers" target="_blank" rel="noopener noreferrer" class="footer__link-item">Careers<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://semgrep.dev/contact-us" target="_blank" rel="noopener noreferrer" class="footer__link-item">Contact us<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 Semgrep, Inc. Semgrep®️  is a registered trademark of Semgrep, Inc. These docs are made with Docusaurus.</div></div></div></footer></div>
</body>
</html>