<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-cheat-sheets/rails-xss" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.7.0">
<title data-rh="true">XSS prevention for Ruby on Rails | Semgrep</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://semgrep.dev/thumbnail.png"><meta data-rh="true" name="twitter:image" content="https://semgrep.dev/thumbnail.png"><meta data-rh="true" property="og:url" content="https://kyle-semgrep.github.io/semgrep-docs/cheat-sheets/rails-xss"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="XSS prevention for Ruby on Rails | Semgrep"><meta data-rh="true" name="description" content="XSS prevention cheat sheet for Ruby on Rails."><meta data-rh="true" property="og:description" content="XSS prevention cheat sheet for Ruby on Rails."><link data-rh="true" rel="icon" href="/semgrep-docs/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://kyle-semgrep.github.io/semgrep-docs/cheat-sheets/rails-xss"><link data-rh="true" rel="alternate" href="https://kyle-semgrep.github.io/semgrep-docs/cheat-sheets/rails-xss" hreflang="en"><link data-rh="true" rel="alternate" href="https://kyle-semgrep.github.io/semgrep-docs/cheat-sheets/rails-xss" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/semgrep-docs/release-notes/rss.xml" title=" RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/semgrep-docs/release-notes/atom.xml" title=" Atom Feed">

<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-XYYV814DDN"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-XYYV814DDN",{})</script>






<script src="https://kit.fontawesome.com/9a8c23ae22.js" crossorigin="anonymous" async></script>
<script src="https://semgrep.dev/docs/fs.js" async></script>
<script src="/docs/js/gtm.js" async></script><link rel="stylesheet" href="/semgrep-docs/assets/css/styles.efff8e51.css">
<script src="/semgrep-docs/assets/js/runtime~main.b48fba5c.js" defer="defer"></script>
<script src="/semgrep-docs/assets/js/main.01bb37bc.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a href="https://semgrep.dev" target="_self" rel="noopener noreferrer" class="navbar__brand"><div class="navbar__logo"><img src="/semgrep-docs/img/semgrep-icon-text-horizontal.svg" alt="Semgrep logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/semgrep-docs/img/semgrep-icon-text-horizontal-dark.svg" alt="Semgrep logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div></a><a href="https://semgrep.dev/api/v1/docs" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">API</a><a href="https://semgrep.dev/explore" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Registry</a><a href="https://semgrep.dev/editor" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Playground</a><a class="navbar__item navbar__link" href="/semgrep-docs/kb">Knowledge base</a><a href="https://academy.semgrep.dev" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Semgrep Academy</a></div><div class="navbar__items navbar__items--right"><a href="https://semgrep.dev/orgs/-" target="_self" rel="noopener noreferrer" class="navbar__item navbar__link">Login</a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite" aria-pressed="false"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><div id="markprompt"></div><div class="navbar__search"><button id="search_input_react" type="button" aria-label="Search or ask" class="navbar__search-input search-bar" style="text-align:left">Search or ask</button></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item home-top-level"><a class="menu__link" href="/semgrep-docs/">Docs home</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--active">Cheat sheets</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/semgrep-docs/cheat-sheets/overview">Cheat sheets</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/semgrep-docs/category/code-injection">Code injection</a><button aria-label="Expand sidebar category &#x27;Code injection&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/semgrep-docs/category/command-injection">Command injection</a><button aria-label="Expand sidebar category &#x27;Command injection&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" tabindex="0" href="/semgrep-docs/category/xss">XSS</a><button aria-label="Collapse sidebar category &#x27;XSS&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/semgrep-docs/cheat-sheets/django-xss">XSS prevention for Django</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/semgrep-docs/cheat-sheets/express-xss">XSS prevention for ExpressJS</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/semgrep-docs/cheat-sheets/flask-xss">XSS prevention for Flask</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/semgrep-docs/cheat-sheets/go-xss">XSS prevention for Go net/http</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/semgrep-docs/cheat-sheets/java-jsp-xss">XSS prevention for Java + JSP</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/semgrep-docs/cheat-sheets/rails-xss">XSS prevention for Ruby on Rails</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/semgrep-docs/category/xxe">XXE</a><button aria-label="Expand sidebar category &#x27;XXE&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></ul></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/semgrep-docs/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Cheat sheets</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/semgrep-docs/category/xss"><span itemprop="name">XSS</span></a><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">XSS prevention for Ruby on Rails</span><meta itemprop="position" content="3"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><ul class="top-tag-list padding--none"></ul><header><h1>XSS prevention for Ruby on Rails</h1></header>
<p>This is a cross-site scripting (XSS) prevention cheat sheet by Semgrep, Inc. It contains code patterns of potential XSS in an application. Instead of scrutinizing code for exploitable vulnerabilities, the recommendations in this cheat sheet pave a safe road for developers that mitigate the possibility of XSS in your code. By following these recommendations, you can be reasonably sure your code is free of XSS.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="mitigation-summary">Mitigation summary<a href="#mitigation-summary" class="hash-link" aria-label="Direct link to Mitigation summary" title="Direct link to Mitigation summary">​</a></h2>
<p>In general, always let Rails render ERB template files rather than constructing them in code. If HTML escaping is needed, use <code>html_safe()</code> in Ruby code and review each individual usage carefully. Once reviewed, mark the line with <code># nosem</code>. Beware of putting data in dangerous locations in templates. And as always, run a security checker continuously on your code.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="check-your-project-using-semgrep">Check your project using Semgrep<a href="#check-your-project-using-semgrep" class="hash-link" aria-label="Direct link to Check your project using Semgrep" title="Direct link to Check your project using Semgrep">​</a></h3>
<p>The following command runs an optimized set of rules for your project:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">semgrep </span><span class="token parameter variable" style="color:#36acaa">--config</span><span class="token plain"> p/default</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="1-unescaped-variable-enters-template-engine-in-ruby-code">1. Unescaped variable enters template engine in Ruby code<a href="#1-unescaped-variable-enters-template-engine-in-ruby-code" class="hash-link" aria-label="Direct link to 1. Unescaped variable enters template engine in Ruby code" title="Direct link to 1. Unescaped variable enters template engine in Ruby code">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="1a-using-html_safe">1.A. Using <strong>html_safe()</strong><a href="#1a-using-html_safe" class="hash-link" aria-label="Direct link to 1a-using-html_safe" title="Direct link to 1a-using-html_safe">​</a></h3>
<p><code>html_safe()</code> marks the supplied string as &quot;safe for HTML rendering.&quot; This bypasses HTML escaping and potentially creates XSS vulnerabilities.</p>
<p>Example:</p>
<div class="language-ruby codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ruby codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">html </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string-literal string" style="color:#e3116c">&quot;&lt;div&gt;</span><span class="token string-literal interpolation delimiter punctuation" style="color:#393A34">#{</span><span class="token string-literal interpolation content">name</span><span class="token string-literal interpolation delimiter punctuation" style="color:#393A34">}</span><span class="token string-literal string" style="color:#e3116c">&lt;/div&gt;&quot;</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">html_safe</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="references">References<a href="#references" class="hash-link" aria-label="Direct link to References" title="Direct link to References">​</a></h4>
<ul>
<li><a href="https://github.com/presidentbeef/brakeman/blob/main/docs/warning_types/cross_site_scripting/index.markdown" target="_blank" rel="noopener noreferrer">Brakeman scanner - Cross-site scripting</a></li>
<li><a href="https://www.netsparker.com/blog/web-security/preventing-xss-ruby-on-rails-web-applications/" target="_blank" rel="noopener noreferrer">Preventing XSS in Ruby on Rails</a></li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="mitigation">Mitigation<a href="#mitigation" class="hash-link" aria-label="Direct link to Mitigation" title="Direct link to Mitigation">​</a></h4>
<p>Ban <code>html_safe()</code>. Alternatively, If needed, review each usage and exempt with <code># nosem</code>.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="semgrep-rule">Semgrep rule<a href="#semgrep-rule" class="hash-link" aria-label="Direct link to Semgrep rule" title="Direct link to Semgrep rule">​</a></h4>
<a href="https://semgrep.dev/r?q=ruby.rails.security.audit.xss.avoid-html-safe.avoid-html-safe" target="_blank">ruby.rails.security.audit.xss.avoid-html-safe.avoid-html-safe</a>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="1b-using-content_tag">1.B. Using <strong>content_tag()</strong><a href="#1b-using-content_tag" class="hash-link" aria-label="Direct link to 1b-using-content_tag" title="Direct link to 1b-using-content_tag">​</a></h3>
<p><code>content_tag()</code>&#x27;s escaping behavior has changed between Rails 2 and 3. In Rails 2, no supplied content is escaped. In Rails 2 and 3, attribute names are not escaped. Further, the returned value is marked as &quot;safe,&quot; the same as if <code>html_safe()</code> had been used. This confusing behavior makes it difficult to use <code>content_tag()</code> properly; improper use can create XSS vulnerabilities in your application.</p>
<p>Example:</p>
<div class="language-ruby codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ruby codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">content_tag </span><span class="token symbol" style="color:#36acaa">:p</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string-literal string" style="color:#e3116c">&quot;Hello, </span><span class="token string-literal interpolation delimiter punctuation" style="color:#393A34">#{</span><span class="token string-literal interpolation content">name</span><span class="token string-literal interpolation delimiter punctuation" style="color:#393A34">}</span><span class="token string-literal string" style="color:#e3116c">&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="references-1">References<a href="#references-1" class="hash-link" aria-label="Direct link to References" title="Direct link to References">​</a></h4>
<ul>
<li><a href="https://brakemanscanner.org/docs/warning_types/content_tag/" target="_blank" rel="noopener noreferrer">Brakeman scanner - Content tag</a></li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="mitigation-1">Mitigation<a href="#mitigation-1" class="hash-link" aria-label="Direct link to Mitigation" title="Direct link to Mitigation">​</a></h4>
<p>Ban <code>content_tag()</code>. Alternatively, If necessary, prefer <code>html_safe()</code> due to its straightforward behavior.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="semgrep-rule-1">Semgrep rule<a href="#semgrep-rule-1" class="hash-link" aria-label="Direct link to Semgrep rule" title="Direct link to Semgrep rule">​</a></h4>
<a href="https://semgrep.dev/r?q=ruby.rails.security.audit.xss.avoid-content-tag.avoid-content-tag" target="_blank">ruby.rails.security.audit.xss.avoid-content-tag.avoid-content-tag</a>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="1c-using-raw">1.C. Using <strong>raw()</strong><a href="#1c-using-raw" class="hash-link" aria-label="Direct link to 1c-using-raw" title="Direct link to 1c-using-raw">​</a></h3>
<p><code>raw()</code> disables HTML escaping for the returned content. This permits raw HTML to be rendered in a template, which could create a XSS vulnerability.</p>
<p>Example:</p>
<div class="language-ruby codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ruby codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">raw </span><span class="token variable" style="color:#36acaa">@user</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">name</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="references-2">References<a href="#references-2" class="hash-link" aria-label="Direct link to References" title="Direct link to References">​</a></h4>
<ul>
<li><a href="https://api.rubyonrails.org/classes/ActionView/Helpers/OutputSafetyHelper.html#method-i-raw" target="_blank" rel="noopener noreferrer"><code>raw()</code> documentation</a></li>
<li><a href="https://www.netsparker.com/blog/web-security/preventing-xss-ruby-on-rails-web-applications/" target="_blank" rel="noopener noreferrer">Preventing XSS in Ruby on Rails</a></li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="mitigation-2">Mitigation<a href="#mitigation-2" class="hash-link" aria-label="Direct link to Mitigation" title="Direct link to Mitigation">​</a></h4>
<p>Ban <code>raw()</code>. Alternatively, Prefer <code>html_safe()</code> if necessary.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="semgrep-rule-2">Semgrep rule<a href="#semgrep-rule-2" class="hash-link" aria-label="Direct link to Semgrep rule" title="Direct link to Semgrep rule">​</a></h4>
<a href="https://semgrep.dev/r?q=ruby.rails.security.audit.xss.avoid-raw.avoid-raw" target="_blank">ruby.rails.security.audit.xss.avoid-raw.avoid-raw</a>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="1d-disabling-of-activesupportescape_html_entities_in_json">1.D. Disabling of <strong>ActiveSupport#escape_html_entities_in_json</strong><a href="#1d-disabling-of-activesupportescape_html_entities_in_json" class="hash-link" aria-label="Direct link to 1d-disabling-of-activesupportescape_html_entities_in_json" title="Direct link to 1d-disabling-of-activesupportescape_html_entities_in_json">​</a></h3>
<p><code>ActiveSupport#escape_html_entities_in_json</code> is a setting which determines whether <code>Hash#to_json()</code> will escape HTML characters. Disabling this could create XSS vulnerabilities.</p>
<p>Example:</p>
<div class="language-ruby codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ruby codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">config</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">active_support</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">escape_html_entities_in_json </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="references-3">References<a href="#references-3" class="hash-link" aria-label="Direct link to References" title="Direct link to References">​</a></h4>
<ul>
<li><a href="https://rubydoc.info/docs/rails/ActiveSupport/JSON/Encoding.escape_html_entities_in_json=" target="_blank" rel="noopener noreferrer"><code>escape_html_entities_in_json</code> documentation</a></li>
<li><a href="https://brakemanscanner.org/docs/warning_types/cross_site_scripting_to_json/" target="_blank" rel="noopener noreferrer">Brakeman scanner - Cross-site scripting (JSON)</a></li>
<li><a href="https://stackoverflow.com/a/43877771" target="_blank" rel="noopener noreferrer">How to disable HTML escaping for JSON, but keep enabled for views?</a></li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="mitigation-3">Mitigation<a href="#mitigation-3" class="hash-link" aria-label="Direct link to Mitigation" title="Direct link to Mitigation">​</a></h4>
<p>Ban disabling of <code>ActiveSupport#escape_html_entities_in_json</code>. Alternatively, If HTML is needed in JSON, use <code>JSON.generate()</code> and review each usage carefully. Exempt each case with <code># nosem</code>.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="semgrep-rule-3">Semgrep rule<a href="#semgrep-rule-3" class="hash-link" aria-label="Direct link to Semgrep rule" title="Direct link to Semgrep rule">​</a></h4>
<a href="https://semgrep.dev/r?q=ruby.lang.security.json-entity-escape.json-entity-escape" target="_blank">ruby.lang.security.json-entity-escape.json-entity-escape</a>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="2-bypassing-the-template-engine">2. Bypassing the template engine<a href="#2-bypassing-the-template-engine" class="hash-link" aria-label="Direct link to 2. Bypassing the template engine" title="Direct link to 2. Bypassing the template engine">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="2a-manually-creating-an-erb-template">2.A. Manually creating an ERB template<a href="#2a-manually-creating-an-erb-template" class="hash-link" aria-label="Direct link to 2.A. Manually creating an ERB template" title="Direct link to 2.A. Manually creating an ERB template">​</a></h3>
<p>Manually creating an ERB template could create a server-side template injection (SSTI) vulnerability if it is created with user input. (This could also result in XSS.) Due to the severity of this type of vulnerability, it is better to use a template file instead of creating templates in code.</p>
<p>Example:</p>
<div class="language-ruby codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ruby codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token class-name">ERB</span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword" style="color:#00009f">new</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-literal string" style="color:#e3116c">&quot;&lt;div&gt;</span><span class="token string-literal interpolation delimiter punctuation" style="color:#393A34">#{</span><span class="token string-literal interpolation content variable" style="color:#36acaa">@user</span><span class="token string-literal interpolation content punctuation" style="color:#393A34">.</span><span class="token string-literal interpolation content">name</span><span class="token string-literal interpolation delimiter punctuation" style="color:#393A34">}</span><span class="token string-literal string" style="color:#e3116c">&lt;/div&gt;&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">result</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="references-4">References<a href="#references-4" class="hash-link" aria-label="Direct link to References" title="Direct link to References">​</a></h4>
<ul>
<li><a href="https://github.com/presidentbeef/brakeman/blob/main/docs/warning_types/template_injection/index.markdown" target="_blank" rel="noopener noreferrer">Brakeman scanner - Template injection</a></li>
<li><a href="https://www.trustedsec.com/blog/rubyerb-template-injection/" target="_blank" rel="noopener noreferrer">Ruby ERB template injection</a></li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="mitigation-4">Mitigation<a href="#mitigation-4" class="hash-link" aria-label="Direct link to Mitigation" title="Direct link to Mitigation">​</a></h4>
<p>Ban template creation in code. Alternatively, Use ERB template files.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="semgrep-rule-4">Semgrep rule<a href="#semgrep-rule-4" class="hash-link" aria-label="Direct link to Semgrep rule" title="Direct link to Semgrep rule">​</a></h4>
<a href="https://semgrep.dev/r?q=ruby.rails.security.audit.xss.manual-template-creation.manual-template-creation" target="_blank">ruby.rails.security.audit.xss.manual-template-creation.manual-template-creation</a>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="2b-rendering-an-inline-template-with-render-inline">2.B. Rendering an inline template with <strong>render inline</strong><a href="#2b-rendering-an-inline-template-with-render-inline" class="hash-link" aria-label="Direct link to 2b-rendering-an-inline-template-with-render-inline" title="Direct link to 2b-rendering-an-inline-template-with-render-inline">​</a></h3>
<p><code>render inline:</code> is the same as creating a template manually and is therefore susceptible to the same vulnerabilities as manually creating an ERB template. This can result in a SSTI or XSS vulnerability.</p>
<p>Example:</p>
<div class="language-ruby codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ruby codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">render inline</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string-literal string" style="color:#e3116c">&quot;&lt;div&gt;</span><span class="token string-literal interpolation delimiter punctuation" style="color:#393A34">#{</span><span class="token string-literal interpolation content variable" style="color:#36acaa">@user</span><span class="token string-literal interpolation content punctuation" style="color:#393A34">.</span><span class="token string-literal interpolation content">name</span><span class="token string-literal interpolation delimiter punctuation" style="color:#393A34">}</span><span class="token string-literal string" style="color:#e3116c">&lt;/div&gt;&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="references-5">References<a href="#references-5" class="hash-link" aria-label="Direct link to References" title="Direct link to References">​</a></h4>
<ul>
<li><a href="https://github.com/brunofacca/zen-rails-security-checklist#output-escaping--sanitization" target="_blank" rel="noopener noreferrer">Zen Rails Security Checklist</a></li>
<li><a href="https://brakemanpro.com/2017/09/08/cross-site-scripting-in-rails#inline-renders---even-worse-than-xss" target="_blank" rel="noopener noreferrer">Inline renders - even worse than XSS!</a></li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="mitigation-5">Mitigation<a href="#mitigation-5" class="hash-link" aria-label="Direct link to Mitigation" title="Direct link to Mitigation">​</a></h4>
<p>Ban <code>render inline:</code>. Alternatively, Use ERB template files.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="semgrep-rule-5">Semgrep rule<a href="#semgrep-rule-5" class="hash-link" aria-label="Direct link to Semgrep rule" title="Direct link to Semgrep rule">​</a></h4>
<a href="https://semgrep.dev/r?q=ruby.rails.security.audit.xss.avoid-render-inline.avoid-render-inline" target="_blank">ruby.rails.security.audit.xss.avoid-render-inline.avoid-render-inline</a>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="2c-using-render-text">2.C. Using <strong>render text:</strong><a href="#2c-using-render-text" class="hash-link" aria-label="Direct link to 2c-using-render-text" title="Direct link to 2c-using-render-text">​</a></h3>
<p><code>render text:</code> unintuitively sets the Content-Type to text/html. This means anything rendered through <code>render text:</code> will be interpreted as HTML. Templates rendered in this manner could create a XSS vulnerability.</p>
<p>Example:</p>
<div class="language-ruby codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ruby codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">render text</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string-literal string" style="color:#e3116c">&quot;&lt;div&gt;</span><span class="token string-literal interpolation delimiter punctuation" style="color:#393A34">#{</span><span class="token string-literal interpolation content variable" style="color:#36acaa">@user</span><span class="token string-literal interpolation content punctuation" style="color:#393A34">.</span><span class="token string-literal interpolation content">name</span><span class="token string-literal interpolation delimiter punctuation" style="color:#393A34">}</span><span class="token string-literal string" style="color:#e3116c">&lt;/div&gt;&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="references-6">References<a href="#references-6" class="hash-link" aria-label="Direct link to References" title="Direct link to References">​</a></h4>
<ul>
<li><a href="https://brakemanpro.com/2017/09/08/cross-site-scripting-in-rails#inline-renders---even-worse-than-xss" target="_blank" rel="noopener noreferrer">Inline renders - even worse than XSS!</a></li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="mitigation-6">Mitigation<a href="#mitigation-6" class="hash-link" aria-label="Direct link to Mitigation" title="Direct link to Mitigation">​</a></h4>
<p>Ban <code>render text:</code>. Alternatively, Use ERB template files.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="semgrep-rule-6">Semgrep rule<a href="#semgrep-rule-6" class="hash-link" aria-label="Direct link to Semgrep rule" title="Direct link to Semgrep rule">​</a></h4>
<a href="https://semgrep.dev/r?q=ruby.rails.security.audit.xss.avoid-render-text.avoid-render-text" target="_blank">ruby.rails.security.audit.xss.avoid-render-text.avoid-render-text</a>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="3-templates-variable-explicitly-unescaped">3. Templates: Variable explicitly unescaped<a href="#3-templates-variable-explicitly-unescaped" class="hash-link" aria-label="Direct link to 3. Templates: Variable explicitly unescaped" title="Direct link to 3. Templates: Variable explicitly unescaped">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="3a-using-html_safe">3.A. Using <strong>html_safe()</strong><a href="#3a-using-html_safe" class="hash-link" aria-label="Direct link to 3a-using-html_safe" title="Direct link to 3a-using-html_safe">​</a></h3>
<p><code>html_safe()</code> marks the supplied string as &quot;safe for HTML rendering.&quot; This bypasses HTML escaping and potentially creates XSS vulnerabilities.</p>
<p>Example:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">&lt;%= name.html_safe %&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="references-7">References<a href="#references-7" class="hash-link" aria-label="Direct link to References" title="Direct link to References">​</a></h4>
<ul>
<li><a href="https://github.com/presidentbeef/brakeman/blob/main/docs/warning_types/cross_site_scripting/index.markdown" target="_blank" rel="noopener noreferrer">Brakeman scanner - Cross-site scripting</a></li>
<li><a href="https://www.netsparker.com/blog/web-security/preventing-xss-ruby-on-rails-web-applications/" target="_blank" rel="noopener noreferrer">Preventing XSS in Ruby on Rails</a></li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="mitigation-7">Mitigation<a href="#mitigation-7" class="hash-link" aria-label="Direct link to Mitigation" title="Direct link to Mitigation">​</a></h4>
<p>Ban <code>html_safe()</code>. Alternatively, Prefer using <code>html_safe()</code> in Ruby code instead of templates.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="semgrep-rule-7">Semgrep rule<a href="#semgrep-rule-7" class="hash-link" aria-label="Direct link to Semgrep rule" title="Direct link to Semgrep rule">​</a></h4>
<a href="https://semgrep.dev/r?q=ruby.rails.security.audit.xss.templates.avoid-html-safe.avoid-html-safe" target="_blank">ruby.rails.security.audit.xss.templates.avoid-html-safe.avoid-html-safe</a>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="3b-using-content_tag">3.B Using <strong>content_tag()</strong><a href="#3b-using-content_tag" class="hash-link" aria-label="Direct link to 3b-using-content_tag" title="Direct link to 3b-using-content_tag">​</a></h3>
<p><code>content_tag()</code>&#x27;s escaping behavior has changed between Rails 2 and 3. In Rails 2, no supplied content is escaped. In Rails 2 and 3, attribute names are not escaped. Further, the returned value is marked as &quot;safe,&quot; the same as if <code>html_safe()</code> had been used. This confusing behavior makes it difficult to use <code>content_tag()</code> properly; improper use can create XSS vulnerabilities in your application.</p>
<p>Example:</p>
<div class="language-ruby codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ruby codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token operator" style="color:#393A34">&lt;</span><span class="token operator" style="color:#393A34">%=</span><span class="token plain"> content_tag </span><span class="token symbol" style="color:#36acaa">:p</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string-literal string" style="color:#e3116c">&quot;Hello, </span><span class="token string-literal interpolation delimiter punctuation" style="color:#393A34">#{</span><span class="token string-literal interpolation content">name</span><span class="token string-literal interpolation delimiter punctuation" style="color:#393A34">}</span><span class="token string-literal string" style="color:#e3116c">&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">%</span><span class="token operator" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="references-8">References<a href="#references-8" class="hash-link" aria-label="Direct link to References" title="Direct link to References">​</a></h4>
<ul>
<li><a href="https://brakemanscanner.org/docs/warning_types/content_tag/" target="_blank" rel="noopener noreferrer">Brakeman scanner - Content tag</a></li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="mitigation-8">Mitigation<a href="#mitigation-8" class="hash-link" aria-label="Direct link to Mitigation" title="Direct link to Mitigation">​</a></h4>
<p>Ban <code>content_tag()</code>. Alternatively, If necessary, prefer <code>html_safe()</code> in Ruby code due to its straightforward behavior.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="semgrep-rule-8">Semgrep rule<a href="#semgrep-rule-8" class="hash-link" aria-label="Direct link to Semgrep rule" title="Direct link to Semgrep rule">​</a></h4>
<a href="https://semgrep.dev/r?q=ruby.rails.security.audit.xss.templates.avoid-content-tag.avoid-content-tag" target="_blank">ruby.rails.security.audit.xss.templates.avoid-content-tag.avoid-content-tag</a>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="3c-using-raw">3.C. Using <strong>raw()</strong><a href="#3c-using-raw" class="hash-link" aria-label="Direct link to 3c-using-raw" title="Direct link to 3c-using-raw">​</a></h3>
<p><code>raw()</code> disables HTML escaping for the returned content. This permits raw HTML to be rendered in a template, which could create a XSS vulnerability.</p>
<p>Example:</p>
<div class="language-ruby codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ruby codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token operator" style="color:#393A34">&lt;</span><span class="token operator" style="color:#393A34">%=</span><span class="token plain"> raw </span><span class="token variable" style="color:#36acaa">@user</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">name </span><span class="token operator" style="color:#393A34">=&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="references-9">References<a href="#references-9" class="hash-link" aria-label="Direct link to References" title="Direct link to References">​</a></h4>
<ul>
<li><a href="https://api.rubyonrails.org/classes/ActionView/Helpers/OutputSafetyHelper.html#method-i-raw" target="_blank" rel="noopener noreferrer"><code>raw()</code> documentation</a></li>
<li><a href="https://www.netsparker.com/blog/web-security/preventing-xss-ruby-on-rails-web-applications/" target="_blank" rel="noopener noreferrer">Preventing XSS in Ruby on Rails</a></li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="mitigation-9">Mitigation<a href="#mitigation-9" class="hash-link" aria-label="Direct link to Mitigation" title="Direct link to Mitigation">​</a></h4>
<p>Ban <code>raw()</code>. Alternatively, Prefer <code>html_safe()</code> in Ruby code if necessary.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="semgrep-rule-9">Semgrep rule<a href="#semgrep-rule-9" class="hash-link" aria-label="Direct link to Semgrep rule" title="Direct link to Semgrep rule">​</a></h4>
<a href="https://semgrep.dev/r?q=ruby.rails.security.audit.xss.templates.avoid-raw.avoid-raw" target="_blank">ruby.rails.security.audit.xss.templates.avoid-raw.avoid-raw</a>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="3d-using----which-is-an-alias-for-html_safe">3.D. Using <strong>&lt;%== ... %&gt;</strong>, which is an alias for <strong>html_safe()</strong><a href="#3d-using----which-is-an-alias-for-html_safe" class="hash-link" aria-label="Direct link to 3d-using----which-is-an-alias-for-html_safe" title="Direct link to 3d-using----which-is-an-alias-for-html_safe">​</a></h3>
<p>The double-equals <code>==</code> is an ERB alias for <code>html_safe()</code>. This will mark the contents as &quot;safe for rendering&quot; and may introduce an XSS vulnerability.</p>
<p>Example:</p>
<div class="language-ruby codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ruby codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token operator" style="color:#393A34">&lt;</span><span class="token operator" style="color:#393A34">%=</span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">@user</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">name </span><span class="token operator" style="color:#393A34">%</span><span class="token operator" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="references-10">References<a href="#references-10" class="hash-link" aria-label="Direct link to References" title="Direct link to References">​</a></h4>
<ul>
<li><a href="https://medium.com/sumone-technical-blog/a-pretty-way-to-unescape-html-in-a-ruby-on-rails-application-efc22b850027" target="_blank" rel="noopener noreferrer">Alias for <code>html_safe()</code></a></li>
<li><a href="https://stackoverflow.com/questions/4251284/raw-vs-html-safe-vs-h-to-unescape-html#:~:text===" target="_blank" rel="noopener noreferrer">Raw vs. html_safe</a></li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="mitigation-10">Mitigation<a href="#mitigation-10" class="hash-link" aria-label="Direct link to Mitigation" title="Direct link to Mitigation">​</a></h4>
<p>Ban <code>&lt;%== ... %&gt;</code>, which is an alias for <code>html_safe()</code>. Alternatively, Prefer <code>html_safe()</code> in Ruby code if necessary.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="semgrep-rule-10">Semgrep rule<a href="#semgrep-rule-10" class="hash-link" aria-label="Direct link to Semgrep rule" title="Direct link to Semgrep rule">​</a></h4>
<a href="https://semgrep.dev/r?q=ruby.rails.security.audit.xss.templates.alias-for-html-safe.alias-for-html-safe" target="_blank">ruby.rails.security.audit.xss.templates.alias-for-html-safe.alias-for-html-safe</a>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="4-templates-variable-in-dangerous-location">4. Templates: Variable in dangerous location<a href="#4-templates-variable-in-dangerous-location" class="hash-link" aria-label="Direct link to 4. Templates: Variable in dangerous location" title="Direct link to 4. Templates: Variable in dangerous location">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="4a-unquoted-variable-in-html-attribute">4.A Unquoted variable in HTML attribute<a href="#4a-unquoted-variable-in-html-attribute" class="hash-link" aria-label="Direct link to 4.A Unquoted variable in HTML attribute" title="Direct link to 4.A Unquoted variable in HTML attribute">​</a></h3>
<p>Unquoted template variables rendered into HTML attributes is a potential XSS vector because an attacker could inject JavaScript handlers which do not require HTML characters. An example handler might look like: <code>onmouseover=alert(1)</code>. HTML escaping will not mitigate this. The variable must be quoted to avoid this.</p>
<p>Example:</p>
<div class="language-ruby codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ruby codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">div </span><span class="token keyword" style="color:#00009f">class</span><span class="token operator" style="color:#393A34">=</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token operator" style="color:#393A34">%=</span><span class="token plain"> classes </span><span class="token string-literal string" style="color:#e3116c">%&gt;&lt;/div&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="references-11">References:<a href="#references-11" class="hash-link" aria-label="Direct link to References:" title="Direct link to References:">​</a></h4>
<ul>
<li><a href="https://flask.palletsprojects.com/en/1.1.x/security/#cross-site-scripting-xss" target="_blank" rel="noopener noreferrer">Flask cross-site scripting considerations - unquoted variable in HTML attribute</a></li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="mitigation-11">Mitigation<a href="#mitigation-11" class="hash-link" aria-label="Direct link to Mitigation" title="Direct link to Mitigation">​</a></h4>
<p>Flag unquoted HTML attributes ERB expressions. Alternatively, Always use quotes around HTML attributes.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="semgrep-rule-11">Semgrep rule<a href="#semgrep-rule-11" class="hash-link" aria-label="Direct link to Semgrep rule" title="Direct link to Semgrep rule">​</a></h4>
<a href="https://semgrep.dev/r?q=ruby.rails.security.audit.xss.templates.unquoted-attribute.unquoted-attribute" target="_blank">ruby.rails.security.audit.xss.templates.unquoted-attribute.unquoted-attribute</a>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="4b-variable-in-href-attribute">4.B. Variable in <strong>href</strong> attribute<a href="#4b-variable-in-href-attribute" class="hash-link" aria-label="Direct link to 4b-variable-in-href-attribute" title="Direct link to 4b-variable-in-href-attribute">​</a></h3>
<p>Template variables in a <code>href</code> value could still accept the <code>javascript:</code> URI. This could be a XSS vulnerability. HTML escaping will not prevent this. Use <code>link_to</code> beginning with a literal forward slash to generate links.</p>
<p>Example:</p>
<div class="language-ruby codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ruby codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">a href</span><span class="token operator" style="color:#393A34">=</span><span class="token string-literal string" style="color:#e3116c">&quot;&lt;%= link %&gt;&quot;</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">a</span><span class="token operator" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="references-12">References<a href="#references-12" class="hash-link" aria-label="Direct link to References" title="Direct link to References">​</a></h4>
<ul>
<li><a href="https://flask.palletsprojects.com/en/1.1.x/security/#cross-site-scripting-xss" target="_blank" rel="noopener noreferrer">Flask cross-site scripting considerations - variable in <code>href</code></a></li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="mitigation-12">Mitigation<a href="#mitigation-12" class="hash-link" aria-label="Direct link to Mitigation" title="Direct link to Mitigation">​</a></h4>
<p>Flag template variables in <code>href</code> attributes. Alternatively, Use <code>url_for</code> to generate links.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="semgrep-rule-12">Semgrep rule<a href="#semgrep-rule-12" class="hash-link" aria-label="Direct link to Semgrep rule" title="Direct link to Semgrep rule">​</a></h4>
<a href="https://semgrep.dev/r?q=ruby.rails.security.audit.xss.templates.var-in-href.var-in-href" target="_blank">ruby.rails.security.audit.xss.templates.var-in-href.var-in-href</a>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="4c-using-link_to-with-unrestricted-url-scheme">4.C. Using <strong>link_to</strong> with unrestricted URL scheme<a href="#4c-using-link_to-with-unrestricted-url-scheme" class="hash-link" aria-label="Direct link to 4c-using-link_to-with-unrestricted-url-scheme" title="Direct link to 4c-using-link_to-with-unrestricted-url-scheme">​</a></h3>
<p>Detected a template variable used in &#x27;link_to&#x27;. This will generate dynamic data in the &#x27;href&#x27; attribute. This allows a malicious actor to input the &#x27;javascript:&#x27; URI and is subject to cross- site scripting (XSS) attacks. If using a relative URL, start with a literal forward slash and concatenate the URL, like this: <code>&lt;%= link_to &quot;Here&quot;, &quot;/&quot;+@link %&gt;</code>. You may also consider setting the Content Security Policy (CSP) header.</p>
<p>Example:</p>
<div class="language-ruby codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ruby codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token operator" style="color:#393A34">&lt;</span><span class="token operator" style="color:#393A34">%=</span><span class="token plain"> link_to </span><span class="token string-literal string" style="color:#e3116c">&quot;Here&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">@link</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">%</span><span class="token operator" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="references-13">References<a href="#references-13" class="hash-link" aria-label="Direct link to References" title="Direct link to References">​</a></h4>
<ul>
<li><a href="https://cheatsheetseries.owasp.org/cheatsheets/Ruby_on_Rails_Cheat_Sheet.html#cross-site-scripting-xss" target="_blank" rel="noopener noreferrer">OWASP Cheatsheet - Ruby on Rails XSS</a></li>
<li><a href="https://github.com/presidentbeef/brakeman/blob/main/docs/warning_types/link_to_href/index.markdown" target="_blank" rel="noopener noreferrer">Brakeman scanner - link_to</a></li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="mitigation-13">Mitigation<a href="#mitigation-13" class="hash-link" aria-label="Direct link to Mitigation" title="Direct link to Mitigation">​</a></h4>
<p>Flag <code>link_to</code> in templates. Alternatively, If you must use this, add a literal forward-slash at the beginning to create a relative url.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="semgrep-rule-13">Semgrep rule<a href="#semgrep-rule-13" class="hash-link" aria-label="Direct link to Semgrep rule" title="Direct link to Semgrep rule">​</a></h4>
<a href="https://semgrep.dev/r?q=ruby.rails.security.audit.xss.templates.dangerous-link-to.dangerous-link-to" target="_blank">ruby.rails.security.audit.xss.templates.dangerous-link-to.dangerous-link-to</a>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="4d-variable-in-script-block">4.D. Variable in <strong>&lt;script&gt;</strong> block<a href="#4d-variable-in-script-block" class="hash-link" aria-label="Direct link to 4d-variable-in-script-block" title="Direct link to 4d-variable-in-script-block">​</a></h3>
<p>Template variables placed directly into JavaScript or similar are now directly in a code execution context. Normal HTML escaping will not prevent the possibility of code injection because code can be written without HTML characters. This creates the potential for XSS vulnerabilities, or worse.</p>
<p>Example:</p>
<div class="language-ruby codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ruby codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">script</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">var name </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token operator" style="color:#393A34">%=</span><span class="token plain"> name </span><span class="token string-literal string" style="color:#e3116c">%&gt;;&lt;/script&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="references-14">References<a href="#references-14" class="hash-link" aria-label="Direct link to References" title="Direct link to References">​</a></h4>
<ul>
<li><a href="https://www.veracode.com/blog/secure-development/nodejs-template-engines-why-default-encoders-are-not-enough" target="_blank" rel="noopener noreferrer">Template engines: Why default encoders are not enough</a></li>
<li><a href="https://blog.ircmaxell.com/2018/06/protecting-rails-xss.html" target="_blank" rel="noopener noreferrer">Protecting against XSS in Rails - JavaScript contexts</a></li>
<li><a href="https://api.rubyonrails.org/classes/ActionView/Helpers/JavaScriptHelper.html#method-i-escape_javascript" target="_blank" rel="noopener noreferrer"><code>escape_javascript</code> documentation</a></li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="mitigation-14">Mitigation<a href="#mitigation-14" class="hash-link" aria-label="Direct link to Mitigation" title="Direct link to Mitigation">​</a></h4>
<p>Ban template variables in <code>&amp;lt;script&amp;gt;</code> blocks. Alternatively, If necessary, use the <code>escape_javascript</code> function or its alias, <code>j</code>. Review each usage carefully and exempt with <code># nosem</code>.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="semgrep-rule-14">Semgrep rule<a href="#semgrep-rule-14" class="hash-link" aria-label="Direct link to Semgrep rule" title="Direct link to Semgrep rule">​</a></h4>
<a href="https://semgrep.dev/r?q=ruby.rails.security.audit.xss.templates.var-in-script-tag.var-in-script-tag" target="_blank">ruby.rails.security.audit.xss.templates.var-in-script-tag.var-in-script-tag</a><div><hr><p>Not finding what you need in this doc? Ask questions in our <a href="https://go.semgrep.dev/slack">Community Slack group</a>, or see <a href="/docs/support/">Support</a> for other ways to get help.</p></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/kyle-semgrep/semgrep-docs/edit/main/docs/docs/cheat-sheets/rails-xss.mdx" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"><span class="theme-last-updated">Last updated<!-- --> on <b><time datetime="2025-07-11T18:49:07.000Z" itemprop="dateModified">Jul 11, 2025</time></b></span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/semgrep-docs/cheat-sheets/java-jsp-xss"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">XSS prevention for Java + JSP</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/semgrep-docs/category/xxe"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">XXE</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#mitigation-summary" class="table-of-contents__link toc-highlight">Mitigation summary</a><ul><li><a href="#check-your-project-using-semgrep" class="table-of-contents__link toc-highlight">Check your project using Semgrep</a></li></ul></li><li><a href="#1-unescaped-variable-enters-template-engine-in-ruby-code" class="table-of-contents__link toc-highlight">1. Unescaped variable enters template engine in Ruby code</a><ul><li><a href="#1a-using-html_safe" class="table-of-contents__link toc-highlight">1.A. Using <strong>html_safe()</strong></a></li><li><a href="#1b-using-content_tag" class="table-of-contents__link toc-highlight">1.B. Using <strong>content_tag()</strong></a></li><li><a href="#1c-using-raw" class="table-of-contents__link toc-highlight">1.C. Using <strong>raw()</strong></a></li><li><a href="#1d-disabling-of-activesupportescape_html_entities_in_json" class="table-of-contents__link toc-highlight">1.D. Disabling of <strong>ActiveSupport#escape_html_entities_in_json</strong></a></li></ul></li><li><a href="#2-bypassing-the-template-engine" class="table-of-contents__link toc-highlight">2. Bypassing the template engine</a><ul><li><a href="#2a-manually-creating-an-erb-template" class="table-of-contents__link toc-highlight">2.A. Manually creating an ERB template</a></li><li><a href="#2b-rendering-an-inline-template-with-render-inline" class="table-of-contents__link toc-highlight">2.B. Rendering an inline template with <strong>render inline</strong></a></li><li><a href="#2c-using-render-text" class="table-of-contents__link toc-highlight">2.C. Using <strong>render text:</strong></a></li></ul></li><li><a href="#3-templates-variable-explicitly-unescaped" class="table-of-contents__link toc-highlight">3. Templates: Variable explicitly unescaped</a><ul><li><a href="#3a-using-html_safe" class="table-of-contents__link toc-highlight">3.A. Using <strong>html_safe()</strong></a></li><li><a href="#3b-using-content_tag" class="table-of-contents__link toc-highlight">3.B Using <strong>content_tag()</strong></a></li><li><a href="#3c-using-raw" class="table-of-contents__link toc-highlight">3.C. Using <strong>raw()</strong></a></li><li><a href="#3d-using----which-is-an-alias-for-html_safe" class="table-of-contents__link toc-highlight">3.D. Using <strong>&lt;%== ... %&gt;</strong>, which is an alias for <strong>html_safe()</strong></a></li></ul></li><li><a href="#4-templates-variable-in-dangerous-location" class="table-of-contents__link toc-highlight">4. Templates: Variable in dangerous location</a><ul><li><a href="#4a-unquoted-variable-in-html-attribute" class="table-of-contents__link toc-highlight">4.A Unquoted variable in HTML attribute</a></li><li><a href="#4b-variable-in-href-attribute" class="table-of-contents__link toc-highlight">4.B. Variable in <strong>href</strong> attribute</a></li><li><a href="#4c-using-link_to-with-unrestricted-url-scheme" class="table-of-contents__link toc-highlight">4.C. Using <strong>link_to</strong> with unrestricted URL scheme</a></li><li><a href="#4d-variable-in-script-block" class="table-of-contents__link toc-highlight">4.D. Variable in <strong>&lt;script&gt;</strong> block</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="footer"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://go.semgrep.dev/slack" target="_blank" rel="noopener noreferrer" class="footer__link-item">Slack<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/semgrep/semgrep" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/semgrep/semgrep/issues" target="_blank" rel="noopener noreferrer" class="footer__link-item">File an issue<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Products</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://semgrep.dev/products/semgrep-code/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Semgrep Code</a></li><li class="footer__item"><a href="https://semgrep.dev/products/semgrep-supply-chain/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Semgrep Supply Chain</a></li><li class="footer__item"><a href="https://semgrep.dev/products/semgrep-appsec-platform/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Semgrep AppSec Platform</a></li></ul></div><div class="col footer__col"><div class="footer__title">Resources</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" target="_self" href="/semgrep-docs/docs">Docs</a></li><li class="footer__item"><a href="https://semgrep.dev/blog" target="_blank" rel="noopener noreferrer" class="footer__link-item">Blog</a></li><li class="footer__item"><a href="https://semgrep.dev/contact/demo" target="_blank" rel="noopener noreferrer" class="footer__link-item">Book a demo</a></li><li class="footer__item"><a href="https://semgrep.dev/pricing/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Pricing</a></li><li class="footer__item"><a href="https://semgrep.dev/privacy" target="_self" rel="noopener noreferrer" class="footer__link-item">Privacy</a></li><li class="footer__item"><a href="https://semgrep.dev/terms" target="_blank" rel="noopener noreferrer" class="footer__link-item">Terms of service</a></li></ul></div><div class="col footer__col"><div class="footer__title">Company</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://semgrep.dev/about" target="_blank" rel="noopener noreferrer" class="footer__link-item">About<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://semgrep.dev/about/careers" target="_blank" rel="noopener noreferrer" class="footer__link-item">Careers<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://semgrep.dev/contact-us" target="_blank" rel="noopener noreferrer" class="footer__link-item">Contact us<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 Semgrep, Inc. Semgrep®️  is a registered trademark of Semgrep, Inc. These docs are made with Docusaurus.</div></div></div></footer></div>
</body>
</html>