<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-contributing/semgrep-core-contributing" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.7.0">
<title data-rh="true">semgrep-core contributing | Semgrep</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://semgrep.dev/thumbnail.png"><meta data-rh="true" name="twitter:image" content="https://semgrep.dev/thumbnail.png"><meta data-rh="true" property="og:url" content="https://kyle-semgrep.github.io/semgrep-docs/contributing/semgrep-core-contributing"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="semgrep-core contributing | Semgrep"><meta data-rh="true" name="description" content="The following explains how to build semgrep-core so you can make and test changes to the OCaml code. Once you have semgrep-core installed, you can refer to semgrep-contributing to see how to build and run the Semgrep application."><meta data-rh="true" property="og:description" content="The following explains how to build semgrep-core so you can make and test changes to the OCaml code. Once you have semgrep-core installed, you can refer to semgrep-contributing to see how to build and run the Semgrep application."><link data-rh="true" rel="icon" href="/semgrep-docs/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://kyle-semgrep.github.io/semgrep-docs/contributing/semgrep-core-contributing"><link data-rh="true" rel="alternate" href="https://kyle-semgrep.github.io/semgrep-docs/contributing/semgrep-core-contributing" hreflang="en"><link data-rh="true" rel="alternate" href="https://kyle-semgrep.github.io/semgrep-docs/contributing/semgrep-core-contributing" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/semgrep-docs/release-notes/rss.xml" title=" RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/semgrep-docs/release-notes/atom.xml" title=" Atom Feed">

<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-XYYV814DDN"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-XYYV814DDN",{})</script>






<script src="https://kit.fontawesome.com/9a8c23ae22.js" crossorigin="anonymous" async></script>
<script src="https://semgrep.dev/docs/fs.js" async></script>
<script src="/docs/js/gtm.js" async></script><link rel="stylesheet" href="/semgrep-docs/assets/css/styles.efff8e51.css">
<script src="/semgrep-docs/assets/js/runtime~main.a68cd6f8.js" defer="defer"></script>
<script src="/semgrep-docs/assets/js/main.60ef6fcb.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a href="https://semgrep.dev" target="_self" rel="noopener noreferrer" class="navbar__brand"><div class="navbar__logo"><img src="/semgrep-docs/img/semgrep-icon-text-horizontal.svg" alt="Semgrep logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/semgrep-docs/img/semgrep-icon-text-horizontal-dark.svg" alt="Semgrep logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div></a><a href="https://semgrep.dev/api/v1/docs" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">API</a><a href="https://semgrep.dev/explore" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Registry</a><a href="https://semgrep.dev/editor" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Playground</a><a class="navbar__item navbar__link" href="/semgrep-docs/kb">Knowledge base</a><a href="https://academy.semgrep.dev" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Semgrep Academy</a></div><div class="navbar__items navbar__items--right"><a href="https://semgrep.dev/orgs/-" target="_self" rel="noopener noreferrer" class="navbar__item navbar__link">Login</a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite" aria-pressed="false"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><div id="markprompt"></div><div class="navbar__search"><button id="search_input_react" type="button" aria-label="Search or ask" class="navbar__search-input search-bar" style="text-align:left">Search or ask</button></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item home-top-level"><a class="menu__link" href="/semgrep-docs/">Docs home</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--active">About Semgrep</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/semgrep-docs/trophy-case">Semgrep trophy case</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/semgrep-docs/support">Support</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/semgrep-docs/security">Security</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/semgrep-docs/licensing">Licensing</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/semgrep-docs/faq/overview">Frequently asked questions</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/semgrep-docs/integrating">Semgrep integration guide for partners</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/semgrep-docs/usage-and-billing">Usage and billing</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/semgrep-docs/deployment/claim-a-license">Claim a license</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/semgrep-docs/contributing/semgrep-philosophy">Semgrep Community Edition (CE) philosophy</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/semgrep-docs/semgrep-pro-vs-oss">Semgrep AppSec Platform versus Community Edition</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/semgrep-docs/run-a-successful-pov">Run a successful trial with Semgrep</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/semgrep-docs/faq/comparisons/codeql">Comparisons with other tools</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/semgrep-docs/metrics">Semgrep metrics</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" tabindex="0" href="/semgrep-docs/contributing/contributing">Contribute to Semgrep</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/semgrep-docs/contributing/contributing">Contributing overview</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/semgrep-docs/contributing/contributing-to-semgrep-rules-repository">Contribute rules to the Semgrep Registry</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/semgrep-docs/contributing/contributing-code">Contributing code</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/semgrep-docs/contributing/semgrep-core-contributing">semgrep-core contributing</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/semgrep-docs/contributing/semgrep-contributing">semgrep contributing</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/semgrep-docs/contributing/adding-a-language">Add support for a new language</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/semgrep-docs/contributing/updating-a-grammar">How to upgrade the grammar for a language</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/semgrep-docs/contributing/troubleshooting">Troubleshooting</a></li></ul></li></ul></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/semgrep-docs/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">About Semgrep</span><meta itemprop="position" content="1"></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Contribute to Semgrep</span><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">semgrep-core contributing</span><meta itemprop="position" content="3"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><ul class="top-tag-list padding--none"></ul><header><h1><code>semgrep-core</code> contributing</h1></header>
<p>The following explains how to build <code>semgrep-core</code> so you can make and test changes to the OCaml code. Once you have <code>semgrep-core</code> installed, you can refer to <a href="/semgrep-docs/contributing/semgrep-contributing">semgrep-contributing</a> to see how to build and run the Semgrep application.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="build-semgrep-core">Build <code>semgrep-core</code><a href="#build-semgrep-core" class="hash-link" aria-label="Direct link to build-semgrep-core" title="Direct link to build-semgrep-core">​</a></h2>
<p>This document assumes you are building on MacOS and have already installed the Homebrew package manager. Installation commands and package names for different OSes may vary slightly.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="check-out-the-code">Check out the code<a href="#check-out-the-code" class="hash-link" aria-label="Direct link to Check out the code" title="Direct link to Check out the code">​</a></h3>
<p>Begin by cloning the Semgrep repo from Git. Each parser&#x27;s tree-sitter code is managed as a separate submodule, so pass <code>--recurse-submodules</code> to ensure they are cloned as well.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">git</span><span class="token plain"> clone --recurse-submodules https://github.com/semgrep/semgrep</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">cd</span><span class="token plain"> semgrep</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>If you have already cloned without submodules, you can check them out as a second separate step from the root of the repository:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">git</span><span class="token plain"> submodule update </span><span class="token parameter variable" style="color:#36acaa">--init</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">--recursive</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="prerequisites">Prerequisites<a href="#prerequisites" class="hash-link" aria-label="Direct link to Prerequisites" title="Direct link to Prerequisites">​</a></h3>
<p><code>semgrep-core</code> is written primarily in OCaml. You must <a href="https://opam.ocaml.org/doc/Install.html" target="_blank" rel="noopener noreferrer">install OCaml</a> and its package manager OPAM, and pin the current compiler version. On MacOS, it is done through the following steps:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">brew </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> opam</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">opam init</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">opam switch create semgrep </span><span class="token number" style="color:#36acaa">5.3</span><span class="token plain">.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">eval</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">$(</span><span class="token variable" style="color:#36acaa">opam </span><span class="token variable function" style="color:#d73a49">env</span><span class="token variable" style="color:#36acaa">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Next, install some base packages required for setup and compilation.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">brew </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> pkg-config </span><span class="token function" style="color:#d73a49">bash</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Lastly, you will almost certainly want the Python environment for <code>semgrep-cli</code>
configured before proceeding. Please refer to the <a href="/semgrep-docs/contributing/semgrep-contributing#set-up-the-environment">Set up the environment</a> documentation.</p>
<p>Once you&#x27;ve returned here, ensure that your shell is able to enter the Python
virtual environment.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token builtin class-name">cd</span><span class="token plain"> cli</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> pipenv shell </span><span class="token comment" style="color:#999988;font-style:italic"># enter the virtual environment</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">cd</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">                </span><span class="token comment" style="color:#999988;font-style:italic"># from within the virtual environment, return to the repo root</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="first-time-installation">First-time installation<a href="#first-time-installation" class="hash-link" aria-label="Direct link to First-time installation" title="Direct link to First-time installation">​</a></h3>
<p>The root <code>Makefile</code> contains targets that take care of building the
right things. It is commented. Please refer to it and keep it
up-to-date.</p>
<p>To install all necessary dependencies, run</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">make</span><span class="token plain"> dev-setup</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">make</span><span class="token plain"> setup</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Next, to install <code>semgrep-core</code>, run</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">make core</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Finally, test the installation with</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">bin/semgrep-core -help</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>If you would like to finish the Semgrep installation, return to the
<a href="/semgrep-docs/contributing/semgrep-contributing">Python-side instructions</a>.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="rebuild-after-a-change">Rebuild after a change<a href="#rebuild-after-a-change" class="hash-link" aria-label="Direct link to Rebuild after a change" title="Direct link to Rebuild after a change">​</a></h3>
<p>Unless there is a significant dependency change, you won&#x27;t need to run <code>make dev-setup</code> again.</p>
<p>The Semgrep team has provided useful targets to help you build and link the entire semgrep project, including both <code>semgrep-core</code> and <code>semgrep</code>. You may find these helpful.</p>
<p>To install the latest OCaml binaries and <code>semgrep</code> binary after pulling source code changes from Git, run:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">make rebuild</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>To install after you make a change locally, run</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">make build    # or just `make`</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>After making either of these targets, <code>semgrep</code> runs with all your local changes, OCaml and Python both.</p>
<div class="language-note codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-note codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Because this updates the `semgrep` binary, if you do not have your Python environment configured properly, you will encounter errors when running these commands. Follow the procedure under [Development](#development)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="development">Development<a href="#development" class="hash-link" aria-label="Direct link to Development" title="Direct link to Development">​</a></h2>
<p>In practice, it is not always convenient to use <code>make build</code> or <code>make rebuild</code>. <code>make rebuild</code> will update everything within the project; <code>make build</code> will compile and install all the binaries. You can do this yourself in a more targeted fashion.</p>
<p>Below is a flow appropriate for frequent developers of <code>semgrep-core</code></p>
<p>After you pull, run</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">git submodule update --recursive</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>This will update internal dependencies. (We suggest aliasing it to <code>uu</code>)</p>
<p>After <code>tree-sitter</code> is updated, you may need to reconfigure it. If so, run</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">make config</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="develop-semgrep-core">Develop <code>semgrep-core</code><a href="#develop-semgrep-core" class="hash-link" aria-label="Direct link to develop-semgrep-core" title="Direct link to develop-semgrep-core">​</a></h3>
<p>If you are developing <code>semgrep-core</code>, Use <code>Makefile</code> in the repository root for <code>core</code> and <code>core-test</code> targets; the code is primarily in <code>src/</code>.</p>
<p>The following assumes you are in the repository root.</p>
<p>After you pull or make a change, compile using</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">make</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>This will build an executable for <code>semgrep-core</code> in <code>_build/default/src/main/Main.exe</code> (we suggest aliasing this to <code>sc</code>). Try it out by running</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">_build/default/src/main/Main.exe -help</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>When you are done, test your changes with</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">make core-test</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Finally, to update the <code>semgrep-core</code> binary used by <code>semgrep</code>, run</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">make copy-core-for-cli</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="test-semgrep-core">Test <code>semgrep-core</code><a href="#test-semgrep-core" class="hash-link" aria-label="Direct link to test-semgrep-core" title="Direct link to test-semgrep-core">​</a></h3>
<p><code>make test</code> in the repository root directory will run tests that check code is correctly parsed
and patterns perform as expected. To add a test in an appropriate language subdirectory, <code>tests/patterns/[LANG]</code>, create a target file (expected file extension given language) and a .sgrep file with a pattern. The testing suite will check that all places with a comment with <code>ERROR</code> were matches found by the .sgrep file. See existing tests for more clarity.</p>
<p>If you are diagnosing test failures, it is time-consuming to re-run the entire test suite.
<code>make retest</code> will only re-run tests that failed.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="development-environment">Development environment<a href="#development-environment" class="hash-link" aria-label="Direct link to Development environment" title="Direct link to Development environment">​</a></h3>
<p>OCaml installations include a language server that most modern editors like
Neovim and Emacs support out of the box.</p>
<p>You can also use Visual Studio Code (vscode) to edit the code of Semgrep. The <a href="https://marketplace.visualstudio.com/items?itemName=jaredly.reason-vscode" target="_blank" rel="noopener noreferrer">reason-vscode</a> Marketplace extension adds support for OCaml/Reason.</p>
<p>The <a href="https://github.com/reasonml-editor/vscode-reasonml" target="_blank" rel="noopener noreferrer">OCaml and Reason IDE extension</a> by @freebroccolo is another valid extension, but it seems not as actively maintained as reason-vscode.</p>
<p>The source of Semgrep contains also a .vscode/ directory at its root containing a task file to automatically build Semgrep from vscode.</p>
<p>Note that dune and ocamlmerlin must be in your PATH for vscode to correctly build and provide cross-reference on the code. In case of problems, do:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token builtin class-name">cd</span><span class="token plain"> /path/to/semgrep</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">eval</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">$(</span><span class="token variable" style="color:#36acaa">opam </span><span class="token variable function" style="color:#d73a49">env</span><span class="token variable" style="color:#36acaa">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dune        </span><span class="token parameter variable" style="color:#36acaa">--version</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># just checking dune is in your PATH</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ocamlmerlin </span><span class="token parameter variable" style="color:#36acaa">-version</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># just checking ocamlmerlin is in your PATH</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">code </span><span class="token builtin class-name">.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="test-semgrep-performance">Test Semgrep performance<a href="#test-semgrep-performance" class="hash-link" aria-label="Direct link to Test Semgrep performance" title="Direct link to Test Semgrep performance">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="explore-results-from-a-slow-run-of-semgrep">Explore results from a slow run of Semgrep<a href="#explore-results-from-a-slow-run-of-semgrep" class="hash-link" aria-label="Direct link to Explore results from a slow run of Semgrep" title="Direct link to Explore results from a slow run of Semgrep">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="interpret-the-result-object">Interpret the result object<a href="#interpret-the-result-object" class="hash-link" aria-label="Direct link to Interpret the result object" title="Direct link to Interpret the result object">​</a></h4>
<p>For full timing information, run Semgrep with <code>--time</code> and <code>--json</code> flags. In addition, you can add <code>time</code> at the beginning of the command to get the true wall time. The <code>--json</code> argument produces a large amount of output, so redirecting the output to a file with <code>-o</code> is recommended.</p>
<p>See the following example for the full command:</p>
<pre class="language-bash"><code>time semgrep --config=auto --time --json -o result.json <span class="placeholder">PATH/TO/SRC</span></code></pre>
<p>Substitute the optional placeholder <code><span class="placeholder">PATH/TO/SRC</span></code> with the path to your source code.</p>
<p>Here is an example result object.</p>
<div class="language-JSON language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token property" style="color:#36acaa">&quot;results&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;paths&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;errors&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;time&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;max_memory_bytes&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">48693248</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;profiling_times&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;config_time&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.0624239444732666</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;core_time&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.11341428756713867</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;ignores_time&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.00017690658569335938</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;total_time&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.17628788948059082</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;rules&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;id&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;test-rule&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;rules_parse_time&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.0013418197631835938</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;targets&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;match_times&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token number" style="color:#36acaa">5.9604644775390625e-06</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;num_bytes&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">340</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;parse_times&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token number" style="color:#36acaa">0.0071868896484375</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;path&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;test_functions.java&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;run_time&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.011521100997924805</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;total_bytes&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">340</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>All the information about timing is contained under <code>time</code>.</p>
<p>The first section is <code>profiling_times</code>. This contains wall time durations of various relevant steps:</p>
<ul>
<li>Getting the rule config files (<code>config_time</code>)</li>
<li>Running the main engine (<code>core_time</code>)</li>
<li>Processing the ignores (<code>ignores_time</code>)</li>
</ul>
<p>The <code>total_time</code> field represents the sum of these steps.</p>
<p>The remaining fields report engine performance. Together, <code>rule_parse_time</code> and <code>targets</code> should capture all the time spent running <code>semgrep-core</code>.</p>
<p><code>rule_parse_time</code> is straightforward. It records the time spent parsing the rules file.</p>
<p><code>targets</code> poses more difficulty. Since files are run in parallel, the amount of time spent parsing (<code>parse_times</code>) and matching (<code>match_times</code>) will inevitably be meaningless compared against <code>total_time</code> or <code>core_time</code>. Therefore, the total run time (<code>run_time</code>) of each target for each rule is taken within the parallel run. This helps contextualize the time spent parsing and matching each target. The sum of the run times thus can (and usually should) be longer than the total time.</p>
<p>The lists <code>match_times</code> and <code>parse_times</code> are in the same order as <code>rules</code>. That is, the match time of rule <code>rules[0]</code> is <code>match_times[0]</code>.</p>
<p>Note that <code>parse_times</code> is given for each rule, but a file should only be parsed once (the first number). Afterwards, the parse time represents the time spent retrieving the file&#x27;s AST from the cache.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="negative-values-in-the-metrics">Negative values in the metrics<a href="#negative-values-in-the-metrics" class="hash-link" aria-label="Direct link to Negative values in the metrics" title="Direct link to Negative values in the metrics">​</a></h4>
<p>When a time is not measured, by default it has the value -1. It is common to a have a normal runtime, but -1 for the parse time or match time; this indicates an error in parsing.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="tips-for-exploring-semgrep-results">Tips for exploring Semgrep results<a href="#tips-for-exploring-semgrep-results" class="hash-link" aria-label="Direct link to Tips for exploring Semgrep results" title="Direct link to Tips for exploring Semgrep results">​</a></h4>
<p>There are several scripts already written to analyze and summarize these timing data. Find them in <a href="https://github.com/semgrep/semgrep/tree/develop/scripts/processing-output" target="_blank" rel="noopener noreferrer"><code>scripts/processing-output</code></a>. If you have a timing file, you can run</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">python read_timing.py </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">your_timing_file</span><span class="token punctuation" style="color:#393A34">]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>You may need to adjust the line <code>result_times = results</code> based on whether you have a timing file or the full results (in which case this should be <code>result_times = results[&quot;time&quot;]</code>)</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="profile-code">Profile code<a href="#profile-code" class="hash-link" aria-label="Direct link to Profile code" title="Direct link to Profile code">​</a></h3>
<p>You can pass the -profile command-line argument to semgrep-core to get
a short profile of the code. For example, running:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token builtin class-name">cd</span><span class="token plain"> semgrep-core</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">./bin/semgrep-core </span><span class="token parameter variable" style="color:#36acaa">-profile</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-e</span><span class="token plain"> foo tests/python</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>will output:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">---------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">profiling result</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">---------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Main total                               </span><span class="token builtin class-name">:</span><span class="token plain">      </span><span class="token number" style="color:#36acaa">1.975</span><span class="token plain"> sec          </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> count</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Parse_python.parse                       </span><span class="token builtin class-name">:</span><span class="token plain">      </span><span class="token number" style="color:#36acaa">0.828</span><span class="token plain"> sec          </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> count</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>You can also instead set the environment variable SEMGREP_CORE_PROFILE to 1 to get the same information:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token builtin class-name">cd</span><span class="token plain"> semgrep-core</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">SEMGREP_CORE_PROFILE</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">./bin/semgrep-core </span><span class="token parameter variable" style="color:#36acaa">-e</span><span class="token plain"> foo tests/python</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>will output:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">---------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">profiling result</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">---------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Main total                               </span><span class="token builtin class-name">:</span><span class="token plain">      </span><span class="token number" style="color:#36acaa">1.975</span><span class="token plain"> sec          </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> count</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Parse_python.parse                       </span><span class="token builtin class-name">:</span><span class="token plain">      </span><span class="token number" style="color:#36acaa">0.828</span><span class="token plain"> sec          </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> count</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>This is especially useful when you don&#x27;t call directly semgrep-core, but
instead use the python wrapper semgrep.</p>
<p>Note that since semgrep 0.82, you can pass the <code>--dump-command-for-core</code> (or the shorter <code>-d</code>) to <code>semgrep</code> to get the command the python wrapper will use to call semgrep-core (this is an hidden option, which is why you will not see it in <code>semgrep --help</code>). For example:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">semgrep --dump-command-for-core </span><span class="token parameter variable" style="color:#36acaa">--config</span><span class="token plain"> bench/zulip/input/rules/zulip/rules.zulip.semgrep.yml.yaml bench/zulip/input/zulip/</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>will output:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Running </span><span class="token number" style="color:#36acaa">10</span><span class="token plain"> rules</span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/home/pad/github/semgrep/cli/src/semgrep/bin/semgrep-core </span><span class="token parameter variable" style="color:#36acaa">-json</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-rules</span><span class="token plain"> semgrep_rules.yaml </span><span class="token parameter variable" style="color:#36acaa">-j</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">20</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-targets</span><span class="token plain"> semgrep_targets.txt </span><span class="token parameter variable" style="color:#36acaa">-timeout</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">30</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-timeout_threshold</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-max_memory</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-json_time</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-fast</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>where <code>semgrep_rules.yaml</code> and <code>semgrep_targets.txt</code> are files created by <code>semgrep</code> that respectively contain the list of rules and targets. It is easy then to copy-paste this command and possibly add a <code>-profile</code> or <code>-debug</code> to get more information.</p>
<p>You can also use the SEMGREP_CORE_DEBUG environment variable to add debugging
information, for example:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token builtin class-name">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">SEMGREP_CORE_DEBUG</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">SEMGREP_CORE_PROFILE</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pipenv run semgrep </span><span class="token parameter variable" style="color:#36acaa">-f</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">/semgrep-core/tests/PERF/ajin.yaml </span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">/semgrep-core/tests/PERF/three.js</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>will output:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Debug mode On</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Executed as: semgrep-core </span><span class="token parameter variable" style="color:#36acaa">-lang</span><span class="token plain"> javascript </span><span class="token parameter variable" style="color:#36acaa">-rules_file</span><span class="token plain"> /tmp/tmpy5pzp3p_ </span><span class="token parameter variable" style="color:#36acaa">-j</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">8</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">/semgrep-core/tests/PERF/three.js</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Profile mode On</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">disabling </span><span class="token parameter variable" style="color:#36acaa">-j</span><span class="token plain"> when </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> profiling mode</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">PARSING: </span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">/semgrep-core/tests/PERF/three.js</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">saving rules </span><span class="token function" style="color:#d73a49">file</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> debugging in: /tmp/semgrep_core_rule-97ae74.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">---------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">profiling result</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">---------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Main total                               </span><span class="token builtin class-name">:</span><span class="token plain">      </span><span class="token number" style="color:#36acaa">1.975</span><span class="token plain"> sec          </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> count</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Parse_js.parse                           </span><span class="token builtin class-name">:</span><span class="token plain">      </span><span class="token number" style="color:#36acaa">0.828</span><span class="token plain"> sec          </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> count</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Semgrep.check                            </span><span class="token builtin class-name">:</span><span class="token plain">      </span><span class="token number" style="color:#36acaa">0.791</span><span class="token plain"> sec          </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> count</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Semgrep.match_sts_sts                    </span><span class="token builtin class-name">:</span><span class="token plain">      </span><span class="token number" style="color:#36acaa">0.559</span><span class="token plain"> sec     </span><span class="token number" style="color:#36acaa">185064</span><span class="token plain"> count</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="benchmark-code">Benchmark code<a href="#benchmark-code" class="hash-link" aria-label="Direct link to Benchmark code" title="Direct link to Benchmark code">​</a></h3>
<p>We have two sets of benchmarks, one on a suite of real repositories against real rulesets (real benchmarks), another that highlights specific slow (rule, file) pairs (micro benchmarks).</p>
<p>To run the micro benchmarks, go to <code>perf/perf-matching/</code>, and run <code>./run-perf-suite</code>.</p>
<p>To run the real benchmarks, go to <code>perf</code>, and run <code>./run-benchmarks</code>. See the perf <a href="https://github.com/semgrep/semgrep/blob/develop/perf/README.md" target="_blank" rel="noopener noreferrer">readme</a> for more details on how these are set up.</p>
<p>There are a number of flags (<code>./run-benchmarks --help</code> to see them) which may be helpful if you are using the benchmarks for local development. For example, <code>./run-benchmarks --plot_benchmarks</code> will output a graph of the benchmark results at the end.</p>
<p>If you are concerned about performance, the recommended way to test is to hide your change behind a flag and add that flag to run-benchmarks. Add a flag in <code>src/configuring/Flag_semgrep.ml</code>. These are ref cells, so you can check whether the flag is enabled or not via <code>!Flag_semgrep.your_flag</code>. In <code>src/core_cli/Core_CLI.ml</code>, go to options, and add a flag that sets the appropriate <code>Flag_semgrep</code>. Then, in <code>perf/run-benchmarks</code>, go to the <code>SemgrepVariants</code> list, and add your variant.</p>
<p>You can also test the impact of your change by running <code>./run_benchmarks --std_only</code> in <code>perf</code>, which will only run the default version of semgrep.</p>
<hr>
<p>In these next sections we will give an overview of <code>semgrep-core</code> and then some tips for making common changes to <code>semgrep-core</code>. These are only tips; without seeing an error, we cannot know its cause and proper resolution, but hopefully it gives useful direction.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="cheatsheet">Cheatsheet<a href="#cheatsheet" class="hash-link" aria-label="Direct link to Cheatsheet" title="Direct link to Cheatsheet">​</a></h2>
<p>The following assume you are in the root of the repository.</p>
<p>Compilation:</p>
<ul>
<li>To compile: <code>make</code></li>
<li>To run the test suite: <code>make test</code></li>
<li>To install the <code>semgrep-core</code> binary: <code>make install</code></li>
<li>The <code>semgrep-core</code> executable produced by <code>make</code>: <code>_build/default/src/main/Main.exe</code> (alias <code>sc</code>)</li>
</ul>
<p>Running (examples in Python):</p>
<ul>
<li>To match a rule file against a target: <code>sc -rules [your-rule].yaml [your-target].py -lang python</code></li>
<li>To match a pattern against a target: <code>sc -f [your-pattern].sgrep [your-target].py -lang python</code></li>
<li>To dump a pattern AST: <code>sc -dump_pattern [your-pattern].sgrep -lang python</code></li>
<li>To dump a target AST: <code>sc -dump_ast [your-target].py -lang python</code></li>
<li>To dump a pattern Python AST: <code>pf -dump_python [your_pattern].sgrep -sgrep_mode -lang python</code></li>
<li>To dump a target Python AST: <code>pf -dump_python [your_pattern].sgrep -lang python</code></li>
</ul>
<p>Debugging:</p>
<ul>
<li>To get the semgrep-core command the python wrapper will use: <code>semgrep --dump-command-for-core --config [your-config] [your-target-directory]</code></li>
</ul>
<p>Try it out: <code>sc -f tests/python/dots_stmts.sgrep tests/python/dots_stmts.py -lang python</code></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="semgrep-core-overview"><code>semgrep-core</code> overview<a href="#semgrep-core-overview" class="hash-link" aria-label="Direct link to semgrep-core-overview" title="Direct link to semgrep-core-overview">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="entry-point">Entry point<a href="#entry-point" class="hash-link" aria-label="Direct link to Entry point" title="Direct link to Entry point">​</a></h3>
<p>The entry point to <code>semgrep-core</code> is <code>Core_CLI.ml</code>, in <code>src/core_cli/</code>. This is where you add command-line arguments. It calls functions depending on the mode in which <code>semgrep-core</code> was invoked (<code>-config</code> for a yaml file, <code>-f</code> for a single pattern, etc.)</p>
<p>When invoked by <code>semgrep</code>, <code>semgrep-core</code> is called by default with <code>-config</code>. This corresponds to the function <code>semgrep_with_rules_file</code>, which in turn calls <code>semgrep_with_rules</code>. These functions will parse and then match the rule and targets.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="parsing">Parsing<a href="#parsing" class="hash-link" aria-label="Direct link to Parsing" title="Direct link to Parsing">​</a></h3>
<p><code>semgrep-core</code> uses external modules to parse code into augmented language-specific abstract syntax trees (ASTs). Though we call these ASTs, they additionally contain token information such as parentheses that are traditionally only present in concrete syntax trees (CSTs) so that we can output results in the correct range.</p>
<p>When <code>semgrep-core</code> receives a rule or a target, it will first need to parse it. The functions that do this are located in <code>src/parsing/</code>.</p>
<ul>
<li>If it reads a rule, it will go through <code>Parse_rule.ml</code>, which uses <code>Parse_pattern.ml</code> to parse the code-like portions of the rule</li>
<li>If it reads a target, it will go through <code>Parse_target.ml</code></li>
</ul>
<p>Depending on the language, <code>Parse_pattern.ml</code> and <code>Parse_target.ml</code> will invoke parsers to parse the code. For example, if we have Java code, it will first be parsed into a Java-specific AST.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="converting-to-the-generic-ast">Converting to the generic AST<a href="#converting-to-the-generic-ast" class="hash-link" aria-label="Direct link to Converting to the generic AST" title="Direct link to Converting to the generic AST">​</a></h3>
<p><code>semgrep-core</code> does not match based on the Java AST. It has a generic AST, defined in <code>AST_generic.ml</code> (in <code>libs/ast_generic/</code>), which all language-specific ASTs are converted to.</p>
<p>The functions for this conversion are in either <code>languages/[LANG]/generic/</code>. They are named with the appropriate language in a consistent convention.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="matching">Matching<a href="#matching" class="hash-link" aria-label="Direct link to Matching" title="Direct link to Matching">​</a></h3>
<p>The matching functions are contained in <code>src/engine/</code> (e.g. <code>Match_rules.ml</code>, <code>Match_patterns.ml</code>) and <code>src/matching/</code> (e.g. <code>Generic_vs_generic.ml</code>). There are several possible matchers to invoke</p>
<ul>
<li>spacegrep (for generic mode)</li>
<li>regexp (to match by regexp instead of semgrep patterns)</li>
<li>comby (an experimental mode for languages we don&#x27;t yet support)</li>
<li>pattern (the main mode)</li>
</ul>
<p>We will only talk about the last for now. In most cases, <code>Match_rules.ml</code> will invoke the <code>check</code> function in <code>Match_patterns.ml</code>. This will visit the target AST and try to match the pattern to it at each point. If the pattern and the target node correspond, it will call the relevant function in <code>Generic_vs_generic.ml</code>.</p>
<p>The core of the matching is done by <code>Generic_vs_generic.ml</code>. The logic for whether two expressions, statements, etc. match is contained within this file.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="report-results">Report results<a href="#report-results" class="hash-link" aria-label="Direct link to Report results" title="Direct link to Report results">​</a></h3>
<p>The results of the match will be returned to the calling function in <code>Main.ml</code> (for example, <code>semgrep_with_rules</code>). From there, the results are formatted and outputted.</p>
<p>There are two modes for outputting: JSON and text. JSON output is processed by functions in <code>JSON_report.ml</code> in <code>semgrep-core/src/reporting/</code></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="fix-a-parse-error">Fix a parse error<a href="#fix-a-parse-error" class="hash-link" aria-label="Direct link to Fix a parse error" title="Direct link to Fix a parse error">​</a></h2>
<p>Before you start fixing a parse error, you need to know what parser was used. This bears some explanation.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="guide-to-parsers">Guide to parsers<a href="#guide-to-parsers" class="hash-link" aria-label="Direct link to Guide to parsers" title="Direct link to Guide to parsers">​</a></h3>
<p>The parsers used by semgrep fall into these categories:</p>
<ul>
<li>legacy parsers (pfff): implemented directly in OCaml via a parser generator</li>
<li>tree-sitter parsers: third-party parsers implemented as
<a href="https://tree-sitter.github.io/" target="_blank" rel="noopener noreferrer">tree-sitter</a> grammars</li>
<li>generic parser (spacegrep): fallback for unsupported languages,
comes with its own matching engine</li>
</ul>
<p>For each language, we need a parser for target files and a parser for
semgrep patterns. For a given language, ideally both would use the same
parser. For historical reasons, some languages use a legacy
parser for patterns and a tree-sitter parser for target code.
Here&#x27;s the breakdown by language as of February 2021:</p>
<ul>
<li>legacy parser for both pattern and target:<!-- -->
<ul>
<li>OCaml</li>
<li>PHP</li>
<li>Python</li>
</ul>
</li>
<li>legacy parser for pattern, tree-sitter parser for target:<!-- -->
<ul>
<li>C</li>
<li>Go</li>
<li>Java</li>
<li>JavaScript, JSX, JSON</li>
<li>Ruby</li>
<li>TypeScript, TSX</li>
</ul>
</li>
<li>tree-sitter parser for both pattern and target:<!-- -->
<ul>
<li>C#</li>
<li>Kotlin</li>
<li>Lua</li>
<li>R</li>
<li>Rust</li>
</ul>
</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="fix-a-pfff-parse-error">Fix a <code>pfff</code> parse error<a href="#fix-a-pfff-parse-error" class="hash-link" aria-label="Direct link to fix-a-pfff-parse-error" title="Direct link to fix-a-pfff-parse-error">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="parse-with-pfff">Parse with <code>pfff</code><a href="#parse-with-pfff" class="hash-link" aria-label="Direct link to parse-with-pfff" title="Direct link to parse-with-pfff">​</a></h4>
<p><a href="https://github.com/semgrep/pfff" target="_blank" rel="noopener noreferrer"><code>pfff</code></a> is an OCaml project that we plug into <code>semgrep-core</code> as a git submodule. It uses menhir to generate parsers from a defined grammar.</p>
<p>Consider a Python pattern (or target). To parse it into a generic AST form, we transform the code as follows:</p>
<p>Text -- (via <code>Lexer_python.mll</code>) --&gt; Tokens -- (via <code>Parser_python.mly</code>) --&gt; <code>Ast_python</code> -- (via <code>Python_to_generic.ml</code>) --&gt; <code>AST_generic</code></p>
<p>These files live in different places. Specifically,</p>
<ul>
<li><code>Lexer_python.mll</code> is in <code>semgrep-core/src/pfff/lang_python/parsing</code></li>
<li><code>Parser_python.mly</code> is in <code>semgrep-core/src/pfff/lang_python/parsing</code></li>
<li><code>AST_python.ml</code> is in <code>semgrep-core/src/pfff/lang_python/parsing</code></li>
<li><code>Python_to_generic.ml</code> is in <code>semgrep-core/src/parsing/pfff</code></li>
<li><code>AST_generic.ml</code> is in <code>semgrep-core/src/core/ast</code></li>
</ul>
<p>You will notice that the first three, <code>Lexer_python.mll</code>, <code>Parser_python.mly</code>, and <code>AST_python.ml</code> are in <code>semgrep-core/src/pfff/</code>, which is a submodule. This means that when you modify them, you modify the submodule rather than <code>semgrep-core</code>. You can develop as usual---<code>pfff</code> is compiled when you run <code>make</code> in <code>semgrep-core/</code>---but will need to go through an extra step to make a pull request (explained later).</p>
<p>When a language is particularly complicated, it can be convenient to first parse into a CST, then convert to the AST. Currently, we only do this for PHP. In this case, there is an extra step:</p>
<p>Tokens -- (via <code>Parser_php.mly</code>) --&gt; <code>Cst_php</code> -- (via <code>Ast_php_build.ml</code>) --&gt; <code>Ast_php</code></p>
<p>The lexers and parsers apply for both patterns and targets of a given language. To avoid parsing invalid targets, we have a function <code>Flag_semgrep.sgrep_guard</code> which fails when parsing constructs that only appear in patterns if a target is being parsed.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="identify-the-error">Identify the error<a href="#identify-the-error" class="hash-link" aria-label="Direct link to Identify the error" title="Direct link to Identify the error">​</a></h4>
<p>The source of the error can be anywhere along the Text --&gt; <code>AST_generic</code> path, so you will want to identify which file is causing it.</p>
<p>First, create a minimum failing case. If you are debugging a rule, isolate this to an individual pattern if possible, saved in a <code>.sgrep</code> file.</p>
<p>For simplicity, we will use Python in the examples, but you can substitute Python for any language parsed with <code>pfff</code>.</p>
<p>If the problem is in <code>Lexer_python.mll</code>, you will probably get a helpful error message which should tell you what you need to change.</p>
<p>If the problem is in <code>Parser_python.mly</code>, you will probably not get a helpful error message, because the error will be reported in the generated parser, not the grammar. To identify which production within the grammar is problematic, you will want to see what AST the parser is trying to produce. Modify the failing case minimally until it parses successfully.</p>
<p>Now, you need to see what generic AST is produced by this similar code. You can actually do this in the playground, by going to Tools -&gt; Dump AST. On the command line, you can run</p>
<ul>
<li>For a pattern:<!-- -->
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">sc -dump_pattern -f [your_pattern].sgrep -lang python</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
<li>For a target:<!-- -->
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">sc -dump_ast [your_target].py -lang python</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
</ul>
<p>where <code>sc</code> is an alias for <code>semgrep-core/_build/default/src/cli/Main.exe</code>, the executable produced by running <code>make</code> in <code>semgrep-core/</code>. If you have installed <code>semgrep-core</code>, you can instead use <code>semgrep-core</code> here, but each time you make a change you will need to compile (<code>make</code>) and then install (<code>make install</code>).</p>
<p>By default, tokens are not shown in full in the dumped AST. Their presence is indicated by <code>()</code>.</p>
<p>You may also find it useful to see the Python AST representation of the pattern. Just as <code>make</code> produces an executable for <code>semgrep-core</code> in <code>semgrep-core/_build/default/src/cli/Main.exe</code>, it also produces one for <code>pfff</code> in <code>semgrep-core/_build/default/src/pfff/cli/Main.exe</code> (alias to <code>pf</code> for these docs).</p>
<p>To dump the Python AST, run</p>
<ul>
<li>For a pattern:<!-- -->
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">pf -dump_python [your_pattern].sgrep -sgrep_mode -lang python</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
<li>For a target:<!-- -->
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">pf -dump_python [your_target].py -lang python</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
</ul>
<p>(Note that <code>-sgrep_mode</code> does not always work with incomplete programs. You may need to wrap your pattern so that it is a valid program for that language, except for semgrep constructs such as <code>...</code>)</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="fix-the-error">Fix the error<a href="#fix-the-error" class="hash-link" aria-label="Direct link to Fix the error" title="Direct link to Fix the error">​</a></h4>
<p>At this point, the relevant change you need to make will vary depending on your goal. It may be as simple as adding <code>...</code> as a possible case. It may require you to introduce a new construct and add it to <code>AST_generic</code> and <code>Ast_python</code>. As a rule of thumb, prefer to avoid changing <code>AST_generic</code> if possible. This will also make your life easier!</p>
<p>If you add a pattern-specific feature, remember to use <code>Flag_semgrep.sgrep_guard</code> so that an invalid target does not parse successfully.</p>
<p>When you change the grammar, it is important that you do not introduce conflicts. Check the conflicts before you start by forcing dune to compile the grammar. (You can either use <code>make clean</code> and read through the output or make a change in <code>Parser_python.mly</code>, run <code>make</code>, then remove the change and run <code>make</code> again.) Then, after you change the grammar, see if there are any more conflicts than there were before your change.</p>
<p>It can sometimes be okay to introduce a <code>shift/reduce</code> conflict, though avoid doing this if possible. It is never okay to introduce a <code>reduce/reduce</code> conflict. To understand why, read about <a href="https://en.wikipedia.org/wiki/Canonical_LR_parser" target="_blank" rel="noopener noreferrer">LR(1) parsers</a>.</p>
<p>If you do introduce a conflict, you can figure out how to resolve it by running</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">menhir --explain Parser_python.mly</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>This will produce the file <code>Parser_python.conflicts</code> in the same folder as <code>Parser_python.mly</code>, which will show the two possible interpretations Menhir is considering for each conflict.</p>
<p>Unfortunately, it will also produce <code>Parser_python.ml</code> and <code>Parser_python.mli</code>, which will confuse dune when it tries to build. Remove these files before you run <code>make</code> again.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="commit-the-fix">Commit the fix<a href="#commit-the-fix" class="hash-link" aria-label="Direct link to Commit the fix" title="Direct link to Commit the fix">​</a></h4>
<p>Once you have made your desired pattern or target parse, you need to make sure it doesn&#x27;t break anything else. In <code>semgrep-core/</code>, run <code>make test</code>. If at the end it says <code>Ok</code>, you can commit your fix!</p>
<p>First, if you have any changes in <code>pfff</code>, go into the <code>semgrep-core/src/pfff/</code> directory, checkout <code>develop</code>, pull, and then make a pull request as usual with your changes. This will make a PR to <a href="https://github.com/semgrep/pfff" target="_blank" rel="noopener noreferrer"><code>pfff</code></a>.</p>
<p>When you change files in <code>pfff</code>, <code>semgrep-core</code> will realize that <code>pfff</code> is different (though not which file within <code>pfff</code>). If you go back up to <code>semgrep-core/</code> and run <code>git status</code>, you will see <code>modified: src/pfff (modified content)</code>. To pin your latest <code>pfff</code> changes to <code>semgrep-core</code>, add <code>src/pfff</code>.</p>
<p>Now, make the rest of your pull request for <code>semgrep-core</code> as usual.</p>
<p>If you haven&#x27;t changed <code>pfff</code>, don&#x27;t worry about this. Just make a pull request with your changes.</p>
<p>Remember to add test cases so that future changes don&#x27;t break your example! See <a href="#testing-semgrep-core">Testing <code>semgrep-core</code></a></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="fix-a-tree-sitter-parse-error">Fix a Tree-sitter parse error<a href="#fix-a-tree-sitter-parse-error" class="hash-link" aria-label="Direct link to Fix a Tree-sitter parse error" title="Direct link to Fix a Tree-sitter parse error">​</a></h3>
<p>There is more information in <a href="#adding-support-for-a-language">Adding Support for a Language</a> on tree-sitter which will be helpful. Also, see <code>semgrep-core/src/parsing/tree-sitter/</code>.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="fix-a-match-error">Fix a match error<a href="#fix-a-match-error" class="hash-link" aria-label="Direct link to Fix a match error" title="Direct link to Fix a match error">​</a></h2>
<p>The first thing you will need to do is understand what you expected and why you aren&#x27;t getting that. If possible, reduce your rule to a single pattern that doesn&#x27;t match. You may need to experiment with the clauses in your rule. For example, if you are getting too many matches, it may be because the pattern in <code>pattern-not</code> doesn&#x27;t match what you expect.</p>
<p>If you are unable to do so, you may need to investigate <code>Match_rule.ml</code>.</p>
<p>Otherwise, produce a minimal failing pattern/target pair. You will need to compare the ASTs to see which portion is not matching as you expect. Run</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">sc -dump_ast [your_target].py -lang py</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>and then</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">sc -dump_pattern [your_pattern].sgrep -lang py</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>It can be hard to figure out where in the AST you are looking. You can make it easier by using a distinctive variable name in the section you&#x27;re interested in.</p>
<p>Once you&#x27;ve isolated the parts that aren&#x27;t matching, try to figure out where they&#x27;re different, taking into account special features like metavariables and ellipses. It is unlikely (though not impossible) that the problem would ever be that two identical code segments aren&#x27;t matching or that there is some AST element that ellipses refuse to match. You might find it helpful to write out the AST parts you want to match on a whiteboard, indicating which part is matched by a special feature. Pare down the code as much as possible and try changing the bit you&#x27;re interested in.</p>
<p>When you are sure you know what ought to have happened, make it happen. If two pieces of code should match but don&#x27;t, change <code>Generic_vs_generic.ml</code> to tell it that pattern should match the target.</p>
<p>Oftentimes, a matching error is actually a parsing error. You may want to change how <code>Parser_python.mly</code> reduces the construct or how it gets converted in <code>Python_to_generic.ml</code>. Refer to <a href="#fixing-a-parse-error">Fixing a Parse Error</a> for advice.</p>
<p>At the end, confirm the match with</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">sc -f [your_pattern].sgrep [your_target].py -lang py</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="fix-an-autofix-error">Fix an autofix error<a href="#fix-an-autofix-error" class="hash-link" aria-label="Direct link to Fix an autofix error" title="Direct link to Fix an autofix error">​</a></h2>
<p>Autofix runs through both <code>semgrep-core</code> and <code>semgrep</code>, but the most common autofix error you can encounter is a kind of incorrect range. This happens because <code>semgrep-core</code> determines the range of a match based on the locations of the tokens stored in the AST. When the range is incorrect, that usually means a token is missing. You can see token location information with</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">sc -full_token_info -dump_ast [your_target].py -lang py</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>See <a href="#fixing-a-parse-error">Fixing a Parse Error</a> for more on parsing</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="debugging-resources">Debugging resources<a href="#debugging-resources" class="hash-link" aria-label="Direct link to Debugging resources" title="Direct link to Debugging resources">​</a></h2>
<p>In the process of debugging, you will probably want to print things. We provide a function <code>pr2</code> in <code>Common.ml</code> (in <code>semgrep-core/src/pfff/commons/</code>) to print strings. You can also use the <code>Printf</code> module.</p>
<p>If you would like to print an AST element, you can use a <code>show</code> function. For example, to print a node of type <code>any</code> in <code>AST_generic</code>, you can use</p>
<p><code>pr2 (show_any your_node)</code></p>
<p>Any type that includes <code>[@@deriving show]</code> in its definition can be converted to a string in this way.</p>
<p>We also provide some flags that are useful. If you run with <code>-debug</code>, you can see the steps <code>semgrep-core</code> is taking. You can see more information (and change what you want to see) using <code>-log_config_file</code>, which takes a file. You can use one of <code>semgrep-core/log_config.json.ex1</code> or <code>semgrep-core/log_config.json.ex2</code> to start.</p>
<p>Additionally, the <a href="https://ocaml.org/manual/debugger.html" target="_blank" rel="noopener noreferrer">OCaml debugger</a> is a great resource.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="add-support-for-a-language">Add support for a language<a href="#add-support-for-a-language" class="hash-link" aria-label="Direct link to Add support for a language" title="Direct link to Add support for a language">​</a></h2>
<p>There are some cases where we have chosen to implement a new parser in <code>pfff</code>, but in general new languages should use tree-sitter.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="tree-sitter-parsers">Tree-Sitter parsers<a href="#tree-sitter-parsers" class="hash-link" aria-label="Direct link to Tree-Sitter parsers" title="Direct link to Tree-Sitter parsers">​</a></h3>
<p>Tree-sitter parsers exist as individual public projects. They are
shared with other users of tree-sitter outside of semgrep. Our
<a href="https://github.com/semgrep/ocaml-tree-sitter-semgrep" target="_blank" rel="noopener noreferrer">ocaml-tree-sitter</a>
project adds the necessary extensions for supporting semgrep patterns
(ellipsis <code>...</code> and such). It also contains the machinery for turning
a tree-sitter grammar into a usable, typed concrete syntax tree (CST).</p>
<p>For example, for the Kotlin language we have:</p>
<ul>
<li>input: <a href="https://github.com/fwcd/tree-sitter-kotlin" target="_blank" rel="noopener noreferrer">tree-sitter-kotlin</a></li>
<li>output: <a href="https://github.com/semgrep/semgrep-kotlin" target="_blank" rel="noopener noreferrer">semgrep-kotlin</a></li>
</ul>
<p>Assuming the tree-sitter grammar works well enough, most of the work
consists in mapping the CST to the generic abstract syntax tree (AST)
shared by all languages in semgrep.</p>
<p>These guides go over the integration work in more details:</p>
<ul>
<li><a href="/semgrep-docs/contributing/adding-a-language">How to add support for a new language</a></li>
<li><a href="/semgrep-docs/contributing/updating-a-grammar">How to upgrade the grammar for a language</a></li>
<li><a href="/semgrep-docs/contributing/cst-to-ast-tips">Tips for converting CST to generic AST</a></li>
</ul><div><hr><p>Not finding what you need in this doc? Ask questions in our <a href="https://go.semgrep.dev/slack">Community Slack group</a>, or see <a href="/docs/support/">Support</a> for other ways to get help.</p></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/semgrep/semgrep-docs/edit/main/docs/contributing/semgrep-core-contributing.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"><span class="theme-last-updated">Last updated<!-- --> on <b><time datetime="2025-04-15T17:45:48.000Z" itemprop="dateModified">Apr 15, 2025</time></b></span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/semgrep-docs/contributing/contributing-code"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Contributing code</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/semgrep-docs/contributing/semgrep-contributing"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">semgrep contributing</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#build-semgrep-core" class="table-of-contents__link toc-highlight">Build <code>semgrep-core</code></a><ul><li><a href="#check-out-the-code" class="table-of-contents__link toc-highlight">Check out the code</a></li><li><a href="#prerequisites" class="table-of-contents__link toc-highlight">Prerequisites</a></li><li><a href="#first-time-installation" class="table-of-contents__link toc-highlight">First-time installation</a></li><li><a href="#rebuild-after-a-change" class="table-of-contents__link toc-highlight">Rebuild after a change</a></li></ul></li><li><a href="#development" class="table-of-contents__link toc-highlight">Development</a><ul><li><a href="#develop-semgrep-core" class="table-of-contents__link toc-highlight">Develop <code>semgrep-core</code></a></li><li><a href="#test-semgrep-core" class="table-of-contents__link toc-highlight">Test <code>semgrep-core</code></a></li><li><a href="#development-environment" class="table-of-contents__link toc-highlight">Development environment</a></li></ul></li><li><a href="#test-semgrep-performance" class="table-of-contents__link toc-highlight">Test Semgrep performance</a><ul><li><a href="#explore-results-from-a-slow-run-of-semgrep" class="table-of-contents__link toc-highlight">Explore results from a slow run of Semgrep</a></li><li><a href="#profile-code" class="table-of-contents__link toc-highlight">Profile code</a></li><li><a href="#benchmark-code" class="table-of-contents__link toc-highlight">Benchmark code</a></li></ul></li><li><a href="#cheatsheet" class="table-of-contents__link toc-highlight">Cheatsheet</a></li><li><a href="#semgrep-core-overview" class="table-of-contents__link toc-highlight"><code>semgrep-core</code> overview</a><ul><li><a href="#entry-point" class="table-of-contents__link toc-highlight">Entry point</a></li><li><a href="#parsing" class="table-of-contents__link toc-highlight">Parsing</a></li><li><a href="#converting-to-the-generic-ast" class="table-of-contents__link toc-highlight">Converting to the generic AST</a></li><li><a href="#matching" class="table-of-contents__link toc-highlight">Matching</a></li><li><a href="#report-results" class="table-of-contents__link toc-highlight">Report results</a></li></ul></li><li><a href="#fix-a-parse-error" class="table-of-contents__link toc-highlight">Fix a parse error</a><ul><li><a href="#guide-to-parsers" class="table-of-contents__link toc-highlight">Guide to parsers</a></li><li><a href="#fix-a-pfff-parse-error" class="table-of-contents__link toc-highlight">Fix a <code>pfff</code> parse error</a></li><li><a href="#fix-a-tree-sitter-parse-error" class="table-of-contents__link toc-highlight">Fix a Tree-sitter parse error</a></li></ul></li><li><a href="#fix-a-match-error" class="table-of-contents__link toc-highlight">Fix a match error</a></li><li><a href="#fix-an-autofix-error" class="table-of-contents__link toc-highlight">Fix an autofix error</a></li><li><a href="#debugging-resources" class="table-of-contents__link toc-highlight">Debugging resources</a></li><li><a href="#add-support-for-a-language" class="table-of-contents__link toc-highlight">Add support for a language</a><ul><li><a href="#tree-sitter-parsers" class="table-of-contents__link toc-highlight">Tree-Sitter parsers</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="footer"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://go.semgrep.dev/slack" target="_blank" rel="noopener noreferrer" class="footer__link-item">Slack<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/semgrep/semgrep" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/semgrep/semgrep/issues" target="_blank" rel="noopener noreferrer" class="footer__link-item">File an issue<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Products</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://semgrep.dev/products/semgrep-code/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Semgrep Code</a></li><li class="footer__item"><a href="https://semgrep.dev/products/semgrep-supply-chain/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Semgrep Supply Chain</a></li><li class="footer__item"><a href="https://semgrep.dev/products/semgrep-appsec-platform/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Semgrep AppSec Platform</a></li></ul></div><div class="col footer__col"><div class="footer__title">Resources</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" target="_self" href="/semgrep-docs/docs">Docs</a></li><li class="footer__item"><a href="https://semgrep.dev/blog" target="_blank" rel="noopener noreferrer" class="footer__link-item">Blog</a></li><li class="footer__item"><a href="https://semgrep.dev/contact/demo" target="_blank" rel="noopener noreferrer" class="footer__link-item">Book a demo</a></li><li class="footer__item"><a href="https://semgrep.dev/pricing/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Pricing</a></li><li class="footer__item"><a href="https://semgrep.dev/privacy" target="_self" rel="noopener noreferrer" class="footer__link-item">Privacy</a></li><li class="footer__item"><a href="https://semgrep.dev/terms" target="_blank" rel="noopener noreferrer" class="footer__link-item">Terms of service</a></li></ul></div><div class="col footer__col"><div class="footer__title">Company</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://semgrep.dev/about" target="_blank" rel="noopener noreferrer" class="footer__link-item">About<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://semgrep.dev/about/careers" target="_blank" rel="noopener noreferrer" class="footer__link-item">Careers<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://semgrep.dev/contact-us" target="_blank" rel="noopener noreferrer" class="footer__link-item">Contact us<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 Semgrep, Inc. Semgrep®️  is a registered trademark of Semgrep, Inc. These docs are made with Docusaurus.</div></div></div></footer></div>
</body>
</html>