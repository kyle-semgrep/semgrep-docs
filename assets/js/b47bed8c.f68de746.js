"use strict";(self.webpackChunkmegadocs=self.webpackChunkmegadocs||[]).push([[87434],{15911:(e,s,n)=>{n.r(s),n.d(s,{assets:()=>a,contentTitle:()=>c,default:()=>h,frontMatter:()=>r,metadata:()=>t,toc:()=>d});const t=JSON.parse('{"id":"kb/integrations/customize-semgrep-precommit","title":"Customize Semgrep in pre-commit","description":"Understand how to customize Semgrep\'s behavior when using it with pre-commit.","source":"@site/docs/kb/integrations/customize-semgrep-precommit.md","sourceDirName":"kb/integrations","slug":"/kb/integrations/customize-semgrep-precommit","permalink":"/semgrep-docs/kb/integrations/customize-semgrep-precommit","draft":false,"unlisted":false,"editUrl":"https://github.com/kyle-semgrep/semgrep-docs/edit/main/docs/kb/integrations/customize-semgrep-precommit.md","tags":[{"inline":true,"label":"Extensions","permalink":"/semgrep-docs/tags/extensions"}],"version":"current","lastUpdatedAt":1752504841000,"frontMatter":{"description":"Understand how to customize Semgrep\'s behavior when using it with pre-commit.","tags":["Extensions"]},"sidebar":"kbSidebar","previous":{"title":"Integrations","permalink":"/semgrep-docs/kb/integrations"},"next":{"title":"How to connect Semgrep and DefectDojo","permalink":"/semgrep-docs/kb/integrations/defect-dojo-integration"}}');var i=n(74848),o=n(28453);const r={description:"Understand how to customize Semgrep's behavior when using it with pre-commit.",tags:["Extensions"]},c="Customize Semgrep in pre-commit",a={},d=[{value:"Show the scan output",id:"show-the-scan-output",level:2},{value:"Limit the scan to a particular product",id:"limit-the-scan-to-a-particular-product",level:2},{value:"Scan with Pro rules and cross-function analysis",id:"scan-with-pro-rules-and-cross-function-analysis",level:2},{value:"Customization tips",id:"customization-tips",level:2},{value:"Useful arguments",id:"useful-arguments",level:3},{value:"Entry point",id:"entry-point",level:3}];function l(e){const s={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,o.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(s.header,{children:(0,i.jsx)(s.h1,{id:"customize-semgrep-in-pre-commit",children:"Customize Semgrep in pre-commit"})}),"\n",(0,i.jsxs)(s.p,{children:["Semgrep offers two standard pre-commit hooks ",(0,i.jsx)(s.a,{href:"/docs/extensions/overview/#pre-commit",children:"outlined here"}),"."]}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["The ",(0,i.jsx)(s.code,{children:"semgrep"})," hook is optimized to run with a provided set of rules, either local rules or rules from the Semgrep Registry."]}),"\n",(0,i.jsxs)(s.li,{children:["The ",(0,i.jsx)(s.code,{children:"semgrep-ci"})," hook is optimized to run with the rules from your organization in the Semgrep AppSec Platform, without sending results to the platform, since results from pre-commit are temporary and not linked to the final code in the repository.","\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"This hook requires the user be logged in locally to fetch the rules from the organization."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(s.p,{children:"You can also create your own Semgrep hooks for pre-commit if you have particular needs or preferences, such as if you want users to see the output of the Semgrep scan even if it passed, or if you want to limit the scan to a particular Semgrep product."}),"\n",(0,i.jsx)(s.h2,{id:"show-the-scan-output",children:"Show the scan output"}),"\n",(0,i.jsxs)(s.p,{children:["By default, pre-commit does not show the scan output if the hook passes. If you want your developers to see the output even if non-blocking findings are found, you can set the ",(0,i.jsx)(s.code,{children:"verbose"})," option to print the output. To limit output to findings only (no scan information or diagnostics), redirect ",(0,i.jsx)(s.code,{children:"stderr"})," to ",(0,i.jsx)(s.code,{children:"/dev/null"}),", or use ",(0,i.jsx)(s.code,{children:"--quiet"}),"."]}),"\n",(0,i.jsxs)(s.p,{children:["This example is based on the ",(0,i.jsx)(s.code,{children:"semgrep-ci"})," hook, but a similar adjustment would also work with the ",(0,i.jsx)(s.code,{children:"semgrep"})," hook."]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-yaml",children:'repos:\n- repo: https://github.com/semgrep/pre-commit\n  rev: \'v1.101.0\'\n  hooks:\n    - id: semgrep-verbose\n      entry: semgrep\n      args: ["ci", "--dry-run", "--baseline-commit", "HEAD" "2>/dev/null"]\n      verbose: true\n      pass_filenames: false\n'})}),"\n",(0,i.jsx)(s.h2,{id:"limit-the-scan-to-a-particular-product",children:"Limit the scan to a particular product"}),"\n",(0,i.jsxs)(s.p,{children:["Semgrep Secrets is an ideal product to run before commit, since it can help prevent secrets from ever making it into the Git history, even locally. To run only Secrets in pre-commit, add the product flag to the ",(0,i.jsx)(s.code,{children:"args"}),":"]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-yaml",children:'- repo: https://github.com/semgrep/pre-commit\n  rev: \'v1.101.0\'\n  hooks:\n    - id:  semgrep-secrets\n      pass_filenames: false\n      args: ["ci", "--dry-run", "--baseline-commit", "HEAD", "--secrets"]\n'})}),"\n",(0,i.jsx)(s.h2,{id:"scan-with-pro-rules-and-cross-function-analysis",children:"Scan with Pro rules and cross-function analysis"}),"\n",(0,i.jsxs)(s.p,{children:["The ",(0,i.jsx)(s.code,{children:"semgrep-ci"})," hook requires the user to be logged in locally and runs with the engine configured in the organization, but the standard ",(0,i.jsx)(s.code,{children:"semgrep"})," hook can also take advantage of local login to run with Pro rules and cross-function analysis."]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-yaml",children:'- id: semgrep\n  name: semgrep\n  entry: semgrep\n  args: ["--pro", "--disable-version-check", "--quiet", "--skip-unknown-extensions"]\n'})}),"\n",(0,i.jsx)(s.p,{children:"This provides analysis across modified files during the pre-commit scan, which may catch additional vulnerabilities, or prevent false positives."}),"\n",(0,i.jsx)(s.h2,{id:"customization-tips",children:"Customization tips"}),"\n",(0,i.jsx)(s.h3,{id:"useful-arguments",children:"Useful arguments"}),"\n",(0,i.jsx)(s.p,{children:"The provided hooks include useful arguments for Semgrep that you may want to include in your hooks as well."}),"\n",(0,i.jsxs)(s.p,{children:["For example, for the ",(0,i.jsx)(s.code,{children:"semgrep"})," hook that runs with a provided ",(0,i.jsx)(s.code,{children:"--config"}),", the arguments also include:"]}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.code,{children:"--disable-version-check"}),": skip checking whether there's a new version of Semgrep (speeds up the check and avoids irrelevant output)"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.code,{children:"--quiet"}),": only print findings, not other messages"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.code,{children:"--skip-unknown-extensions"}),": if files are modified that aren't in a recognized language, skip them"]}),"\n"]}),"\n",(0,i.jsxs)(s.p,{children:["The ",(0,i.jsx)(s.code,{children:"semgrep-ci"})," hook runs with the pre-commit option ",(0,i.jsx)(s.code,{children:"pass_filenames: false"}),". This is important because ",(0,i.jsx)(s.code,{children:"semgrep ci"})," doesn't expect a list of filenames; it just expects to scan the folder, so you should preserve this option in your usage."]}),"\n",(0,i.jsxs)(s.p,{children:["Adding ",(0,i.jsx)(s.code,{children:"baseline-commit HEAD"})," performs a diff scan; this diff scan only scans the changes being added in the current commit (as intended for a pre-commit hook). It uses ",(0,i.jsx)(s.code,{children:"--dry-run"})," so that findings that have no existence except in the local filesystem aren't added to the platform, which would otherwise result in clutter."]}),"\n",(0,i.jsx)(s.h3,{id:"entry-point",children:"Entry point"}),"\n",(0,i.jsxs)(s.p,{children:["Both of the default hooks use ",(0,i.jsx)(s.code,{children:"semgrep"})," as the ",(0,i.jsx)(s.code,{children:"entry"}),", which means the command executed is just ",(0,i.jsx)(s.code,{children:"semgrep"})," with the ",(0,i.jsx)(s.code,{children:"args"})," provided. However, you can write your own ",(0,i.jsx)(s.code,{children:"entry"})," point. This approach is used in the less commonly used ",(0,i.jsx)(s.code,{children:"semgrep-docker"})," hook also available in the ",(0,i.jsx)(s.a,{href:"https://github.com/semgrep/pre-commit/blob/develop/.pre-commit-hooks.yaml",children:"semgrep/pre-commit repository"}),"."]}),"\n",(0,i.jsx)(s.p,{children:"It can also be used with a standard Semgrep execution to set environment variables in addition to (or instead of) arguments:"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:" entry: sh -c 'env SEMGREP_RULES=<SEMGREP_RULESET_URL> semgrep scan --code --no-suppress-errors --baseline-commit HEAD'\n"})}),"\n",(0,i.jsxs)(s.p,{children:["In this case, setting ",(0,i.jsx)(s.code,{children:"SEMGREP_RULES=<SEMGREP_RULESET_URL>"})," substitutes for supplying ",(0,i.jsx)(s.code,{children:"--config"})," and ",(0,i.jsx)(s.code,{children:"<SEMGREP_RULESET_URL>"})," in the ",(0,i.jsx)(s.code,{children:"args"}),"."]})]})}function h(e={}){const{wrapper:s}={...(0,o.R)(),...e.components};return s?(0,i.jsx)(s,{...e,children:(0,i.jsx)(l,{...e})}):l(e)}},28453:(e,s,n)=>{n.d(s,{R:()=>r,x:()=>c});var t=n(96540);const i={},o=t.createContext(i);function r(e){const s=t.useContext(o);return t.useMemo((function(){return"function"==typeof e?e(s):{...s,...e}}),[s,e])}function c(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:r(e.components),t.createElement(o.Provider,{value:s},e.children)}}}]);