"use strict";(self.webpackChunkmegadocs=self.webpackChunkmegadocs||[]).push([[76322],{28453:(e,n,t)=>{t.d(n,{R:()=>a,x:()=>c});var s=t(96540);const i={},r=s.createContext(i);function a(e){const n=s.useContext(r);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:a(e.components),s.createElement(r.Provider,{value:n},e.children)}},29900:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>o,contentTitle:()=>c,default:()=>h,frontMatter:()=>a,metadata:()=>s,toc:()=>l});const s=JSON.parse('{"id":"kb/rules/match-comments","title":"Match comments with Semgrep","description":"Semgrep\'s generic pattern matching mode can match comments in code files.","source":"@site/docs/kb/rules/match-comments.md","sourceDirName":"kb/rules","slug":"/kb/rules/match-comments","permalink":"/semgrep-docs/kb/rules/match-comments","draft":false,"unlisted":false,"editUrl":"https://github.com/kyle-semgrep/semgrep-docs/edit/main?base=kyle-semgrep:main/docs/kb/rules/match-comments.md","tags":[{"inline":true,"label":"Rules","permalink":"/semgrep-docs/tags/rules"},{"inline":true,"label":"Semgrep Code","permalink":"/semgrep-docs/tags/semgrep-code"}],"version":"current","lastUpdatedAt":1752254305000,"frontMatter":{"description":"Semgrep\'s generic pattern matching mode can match comments in code files.","tags":["Rules","Semgrep Code"]},"sidebar":"kbSidebar","previous":{"title":"Match the absence of something in a file","permalink":"/semgrep-docs/kb/rules/match-absence"},"next":{"title":"Fix pattern parse errors when running rules","permalink":"/semgrep-docs/kb/rules/pattern-parse-error"}}');var i=t(74848),r=t(28453);const a={description:"Semgrep's generic pattern matching mode can match comments in code files.",tags:["Rules","Semgrep Code"]},c="Match comments with Semgrep",o={},l=[{value:"Example rule",id:"example-rule",level:2},{value:"Limiting the match to certain file types",id:"limiting-the-match-to-certain-file-types",level:2},{value:"Ignoring some comments in generic mode",id:"ignoring-some-comments-in-generic-mode",level:2},{value:"Additional resources",id:"additional-resources",level:2}];function m(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"match-comments-with-semgrep",children:"Match comments with Semgrep"})}),"\n",(0,i.jsx)(n.p,{children:"When Semgrep rules target specific languages, they generally do not match comments in the targeted code files. Comments are not part of the semantic and syntactic structure of the document, so in most cases they are ignored."}),"\n",(0,i.jsxs)(n.p,{children:["However, it's sometimes useful to match comments. For example, comments can control the behavior of other linters, such as type checkers. You might also have certain formatting standards for comments, such as requiring that a ",(0,i.jsx)(n.code,{children:"TODO"})," comment contains a ticket capturing the required work."]}),"\n",(0,i.jsxs)(n.p,{children:["To match comments with Semgrep, use the ",(0,i.jsx)(n.code,{children:"generic"})," language target to invoke ",(0,i.jsx)(n.a,{href:"/docs/writing-rules/generic-pattern-matching",children:"generic pattern matching"}),". (Alternatively you may use ",(0,i.jsx)(n.code,{children:"pattern-regex"})," which ",(0,i.jsx)(n.a,{href:"/docs/writing-rules/rule-syntax#pattern-regex",children:"does file-level matching"})," rather than semantic / syntactic matching, which is beyond the scope of this article.)"]}),"\n",(0,i.jsx)(n.h2,{id:"example-rule",children:"Example rule"}),"\n",(0,i.jsxs)(n.p,{children:["Suppose that your organization requires all ",(0,i.jsx)(n.code,{children:"TODO"})," comments to have an associated Jira ticket. This rule finds TODO lines with no ",(0,i.jsx)(n.code,{children:"atlassian.net"})," content and identifies any lines not containing a Jira Cloud ticket link."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:'rules:\n  - id: no-todo-without-jira\n    patterns:\n      - pattern: TODO $...ACTION\n      - pattern-not: TODO ... atlassian.net ...\n    options:\n      generic_ellipsis_max_span: 0\n    message: The TODO comment "$...ACTION" does not contain a Jira ticket to resolve the issue\n    languages:\n      - generic\n    severity: INFO\n    metadata:\n      category: best-practice\n'})}),"\n",(0,i.jsx)(n.admonition,{type:"note",children:(0,i.jsxs)(n.p,{children:["Try this pattern in the ",(0,i.jsx)(n.a,{href:"https://semgrep.dev/playground/s/lBDRL",children:"Semgrep Playground"}),"."]})}),"\n",(0,i.jsxs)(n.p,{children:["This rule also includes the ",(0,i.jsx)(n.code,{children:"generic_ellipsis_max_span"})," option, which ",(0,i.jsx)(n.a,{href:"/docs/writing-rules/generic-pattern-matching/#handling-line-based-input",children:"limits the ellipsis to matching on the same line"})," and prevents it from over-matching in this generic context."]}),"\n",(0,i.jsx)(n.h2,{id:"limiting-the-match-to-certain-file-types",children:"Limiting the match to certain file types"}),"\n",(0,i.jsxs)(n.p,{children:["If particular types of comments are only relevant for certain files, you can use the ",(0,i.jsx)(n.code,{children:"paths:"})," key to limit the rule to files of that type. For example, ",(0,i.jsx)(n.code,{children:"mypy"})," ",(0,i.jsx)(n.a,{href:"https://mypy.readthedocs.io/en/stable/error_codes.html#silencing-errors-based-on-error-codes",children:"type ignores"})," are only relevant in Python files."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:'...\nrules:\n  - id: no-mypy-ignore\n    ...\n    paths:\n      include:\n        - "*.py"\n'})}),"\n",(0,i.jsx)(n.h2,{id:"ignoring-some-comments-in-generic-mode",children:"Ignoring some comments in generic mode"}),"\n",(0,i.jsxs)(n.p,{children:["It is possible to ",(0,i.jsx)(n.a,{href:"/docs/writing-rules/generic-pattern-matching#ignoring-comments",children:"ignore comments of particular types"})," in generic mode using the ",(0,i.jsx)(n.code,{children:"generic_comment_style"})," option. For example, to ignore C-style comments but match any other style:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"rules:\n  - id: css-blue-is-not-allowed\n    pattern: |\n      color: blue\n    options:\n      # ignore comments of the form /* ... */\n      generic_comment_style: c\n    message: |\n      Blue is not allowed.\n    languages:\n      - generic\n    severity: INFO\n"})}),"\n",(0,i.jsx)(n.h2,{id:"additional-resources",children:"Additional resources"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"/docs/kb/rules/ellipsis-metavariables",children:"Matching multiple tokens with ellipsis metavariables"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"/docs/writing-rules/experiments/aliengrep",children:"Aliengrep experiment"})}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(m,{...e})}):m(e)}}}]);