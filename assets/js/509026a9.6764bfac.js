"use strict";(self.webpackChunkmegadocs=self.webpackChunkmegadocs||[]).push([[73861],{10064:(e,s,i)=>{i.d(s,{Ay:()=>l,RM:()=>t});var r=i(74848),n=i(28453);const t=[];function a(e){const s={code:"code",p:"p",pre:"pre",...(0,n.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(s.p,{children:"The following command runs an optimized set of rules for your project:"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:"semgrep --config p/default\n"})})]})}function l(e={}){const{wrapper:s}={...(0,n.R)(),...e.components};return s?(0,r.jsx)(s,{...e,children:(0,r.jsx)(a,{...e})}):a(e)}},21250:(e,s,i)=>{i.d(s,{A:()=>n});i(96540);var r=i(74848);function n(e){let{ruleId:s}=e;const i=new URL("https://semgrep.dev/r");return i.searchParams.set("q",s),(0,r.jsx)("a",{href:i,target:"_blank",children:s})}},28453:(e,s,i)=>{i.d(s,{R:()=>a,x:()=>l});var r=i(96540);const n={},t=r.createContext(n);function a(e){const s=r.useContext(t);return r.useMemo((function(){return"function"==typeof e?e(s):{...s,...e}}),[s,e])}function l(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(n):e.components||n:a(e.components),r.createElement(t.Provider,{value:s},e.children)}},69059:(e,s,i)=>{i.r(s),i.d(s,{assets:()=>p,contentTitle:()=>d,default:()=>g,frontMatter:()=>c,metadata:()=>r,toc:()=>h});const r=JSON.parse('{"id":"cheat-sheets/java-jsp-xss","title":"XSS prevention for Java + JSP","description":"XSS prevention for Java + JavaServer Pages (JSP).","source":"@site/docs/cheat-sheets/java-jsp-xss.mdx","sourceDirName":"cheat-sheets","slug":"/cheat-sheets/java-jsp-xss","permalink":"/semgrep-docs/cheat-sheets/java-jsp-xss","draft":false,"unlisted":false,"editUrl":"https://github.com/kyle-semgrep/semgrep-docs/edit/main/docs/cheat-sheets/java-jsp-xss.mdx","tags":[],"version":"current","lastUpdatedAt":1753220396000,"frontMatter":{"slug":"java-jsp-xss","description":"XSS prevention for Java + JavaServer Pages (JSP)."},"sidebar":"cheatsheetSidebar","previous":{"title":"XSS prevention for Go net/http","permalink":"/semgrep-docs/cheat-sheets/go-xss"},"next":{"title":"XSS prevention for Ruby on Rails","permalink":"/semgrep-docs/cheat-sheets/rails-xss"}}');var n=i(74848),t=i(28453),a=i(21250),l=i(88483),o=i(10064);const c={slug:"java-jsp-xss",description:"XSS prevention for Java + JavaServer Pages (JSP)."},d="XSS prevention for Java + JSP",p={},h=[...l.RM,{value:"Mitigation Summary",id:"mitigation-summary",level:2},{value:"Check your project using Semgrep",id:"check-your-project-using-semgrep",level:3},...o.RM,{value:"1. Server code: writing a response directly",id:"1-server-code-writing-a-response-directly",level:2},{value:"1.A Using the <strong>PrintWriter</strong> from <strong>HttpServletResponse</strong>",id:"1a-using-the-printwriter-from-httpservletresponse",level:3},{value:"Mitigation",id:"mitigation",level:4},{value:"Semgrep rule",id:"semgrep-rule",level:4},{value:"1.B. Using the <strong>OutputStream</strong> from <strong>HttpServletResponse</strong>",id:"1b-using-the-outputstream-from-httpservletresponse",level:3},{value:"References",id:"references",level:4},{value:"Mitigation",id:"mitigation-1",level:4},{value:"Semgrep rule",id:"semgrep-rule-1",level:4},{value:"2. JSP page: Variable is not explicitly escaped",id:"2-jsp-page-variable-is-not-explicitly-escaped",level:2},{value:"2.A. Any variable used without <strong>&lt;c ...&gt;</strong> tag",id:"2a-any-variable-used-without-c--tag",level:3},{value:"References",id:"references-1",level:4},{value:"Mitigation",id:"mitigation-2",level:4},{value:"Semgrep rule",id:"semgrep-rule-2",level:4},{value:"2.B.Any expression without <strong>escapeXml</strong>",id:"2bany-expression-without-escapexml",level:3},{value:"References",id:"references-2",level:4},{value:"Mitigation",id:"mitigation-3",level:4},{value:"Semgrep rule",id:"semgrep-rule-3",level:4},{value:"3. JSP page: Variable in dangerous location",id:"3-jsp-page-variable-in-dangerous-location",level:2},{value:"3.A. Unquoted variable in HTML attribute",id:"3a-unquoted-variable-in-html-attribute",level:3},{value:"References",id:"references-3",level:4},{value:"Mitigation",id:"mitigation-4",level:4},{value:"3.B. Variable in <strong>href</strong> attribute",id:"3b-variable-in-href-attribute",level:3},{value:"References",id:"references-4",level:4},{value:"Mitigation",id:"mitigation-5",level:4},{value:"3.C. Variable in <strong>&lt;script&gt;</strong> block",id:"3c-variable-in-script-block",level:3},{value:"References",id:"references-5",level:4},{value:"Mitigation",id:"mitigation-6",level:4}];function u(e){const s={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",hr:"hr",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(s.header,{children:(0,n.jsx)(s.h1,{id:"xss-prevention-for-java--jsp",children:"XSS prevention for Java + JSP"})}),"\n",(0,n.jsx)(l.Ay,{}),"\n",(0,n.jsx)(s.h2,{id:"mitigation-summary",children:"Mitigation Summary"}),"\n",(0,n.jsxs)(s.p,{children:["JSPs are fraught with peril. HTML escaping in JSP templates requires escaping all data that is rendered onto the page. Worse, business logic can be embedded into JSPs with scriptlets. This is easy to forget or abuse and can easily create XSS vulnerabilities. The default option should be the safe option: Consider using a view or template engine that escapes by default, such as JSF or Velocity. If you cannot migrate to another framework, use a custom EL resolver that applies escaping by default in JSPs, such as\n",(0,n.jsx)(s.a,{href:"https://docs.oracle.com/javaee/6/api/javax/el/ELResolver.html",children:"https://docs.oracle.com/javaee/6/api/javax/el/ELResolver.html"}),", otherwise you MUST ensure all data is escaped. Do not use scriptlets."]}),"\n",(0,n.jsxs)(s.p,{children:["If you are developing a REST API, consider using JAX-RS instead of writing directly to ",(0,n.jsx)(s.code,{children:"HttpServletResponse"}),". This is easier to review, maintain, and audit for issues. And as always, develop a secure coding policy and use a security checker to enforce it."]}),"\n",(0,n.jsxs)(s.p,{children:["Semgrep ruleset for this cheatsheet: ",(0,n.jsx)(s.a,{href:"https://semgrep.dev/p/minusworld.java-httpservlet-jsp-xss",children:"p/minusworld.java-httpservlet-jsp-xss"})]}),"\n",(0,n.jsx)(s.h3,{id:"check-your-project-using-semgrep",children:"Check your project using Semgrep"}),"\n",(0,n.jsx)(o.Ay,{}),"\n",(0,n.jsx)(s.h2,{id:"1-server-code-writing-a-response-directly",children:"1. Server code: writing a response directly"}),"\n",(0,n.jsxs)(s.h3,{id:"1a-using-the-printwriter-from-httpservletresponse",children:["1.A Using the ",(0,n.jsx)(s.strong,{children:"PrintWriter"})," from ",(0,n.jsx)(s.strong,{children:"HttpServletResponse"})]}),"\n",(0,n.jsxs)(s.p,{children:["The ",(0,n.jsx)(s.code,{children:"PrintWriter from "}),"HttpServletResponse` permits writing data directly to the response that will be returned to the user. This bypasses any safety mechanisms built into any frameworks in use."]}),"\n",(0,n.jsx)(s.p,{children:"Example:"}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-java",children:'response.getWriter().write("<p>Hello, " + name + "!</p>");\n'})}),"\n",(0,n.jsx)(s.h4,{id:"mitigation",children:"Mitigation"}),"\n",(0,n.jsxs)(s.p,{children:["Ban use of ",(0,n.jsx)(s.code,{children:"PrintWriter"})," from ",(0,n.jsx)(s.code,{children:"HttpServletResponse"}),". Alternatively, render JSP pages using request forwarding: ",(0,n.jsx)(s.code,{children:'request.getRequestDispatcher("/page.jsp").forward(...);'})]}),"\n",(0,n.jsx)(s.h4,{id:"semgrep-rule",children:"Semgrep rule"}),"\n",(0,n.jsx)(a.A,{ruleId:"java.lang.security.audit.xss.no-direct-response-writer.no-direct-response-writer"}),"\n",(0,n.jsxs)(s.h3,{id:"1b-using-the-outputstream-from-httpservletresponse",children:["1.B. Using the ",(0,n.jsx)(s.strong,{children:"OutputStream"})," from ",(0,n.jsx)(s.strong,{children:"HttpServletResponse"})]}),"\n",(0,n.jsxs)(s.p,{children:["The ",(0,n.jsx)(s.code,{children:"OutputStream"})," from ",(0,n.jsx)(s.code,{children:"HttpServletResponse"})," permits writing data directly to the response that will be returned to the user. This bypasses any safety mechanisms built into any frameworks in use."]}),"\n",(0,n.jsx)(s.p,{children:"Example:"}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-java",children:'String template = "<p>Hello, " + name + "!</p>";\nresponse.getOutputStream().write(template.getBytes());\n'})}),"\n",(0,n.jsx)(s.h4,{id:"references",children:"References"}),"\n",(0,n.jsxs)(s.ul,{children:["\n",(0,n.jsx)(s.li,{children:(0,n.jsx)(s.a,{href:"https://www.baeldung.com/jsp#forwarding",children:"Request forwarding to render JSP pages"})}),"\n"]}),"\n",(0,n.jsx)(s.h4,{id:"mitigation-1",children:"Mitigation"}),"\n",(0,n.jsxs)(s.p,{children:["Ban use of ",(0,n.jsx)(s.code,{children:"OutputStream"})," from ",(0,n.jsx)(s.code,{children:"HttpServletResponse"}),". Render JSP pages using request forwarding: ",(0,n.jsx)(s.code,{children:'request.getRequestDispatcher("/page.jsp").forward(...);'}),"."]}),"\n",(0,n.jsx)(s.h4,{id:"semgrep-rule-1",children:"Semgrep rule"}),"\n",(0,n.jsx)(a.A,{ruleId:"java.lang.security.audit.xss.no-direct-response-writer.no-direct-response-writer"}),"\n",(0,n.jsx)(s.hr,{}),"\n",(0,n.jsx)(s.h2,{id:"2-jsp-page-variable-is-not-explicitly-escaped",children:"2. JSP page: Variable is not explicitly escaped"}),"\n",(0,n.jsxs)(s.h3,{id:"2a-any-variable-used-without-c--tag",children:["2.A. Any variable used without ",(0,n.jsxs)(s.strong,{children:["<c",":out"," ...>"]})," tag"]}),"\n",(0,n.jsxs)(s.p,{children:["The ",(0,n.jsx)(s.code,{children:"out"})," tag from the JSTL taglib escapes the given value. Without this or another escaping method, data in the JSP will be unescaped. This could create XSS vulnerabilities."]}),"\n",(0,n.jsx)(s.p,{children:"Example:"}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-java",children:"<div>${userObj.name}</div>\n"})}),"\n",(0,n.jsx)(s.h4,{id:"references-1",children:"References"}),"\n",(0,n.jsxs)(s.ul,{children:["\n",(0,n.jsx)(s.li,{children:(0,n.jsx)(s.a,{href:"https://stackoverflow.com/questions/2658922/xss-prevention-in-jsp-servlet-web-application",children:"XSS prevention in JSP application"})}),"\n",(0,n.jsx)(s.li,{children:(0,n.jsx)(s.a,{href:"https://pukkaone.github.io/2011/01/03/jsp-cross-site-scripting-elresolver.html",children:"JSP cross-site scripting ELResolver"})}),"\n"]}),"\n",(0,n.jsx)(s.h4,{id:"mitigation-2",children:"Mitigation"}),"\n",(0,n.jsxs)(s.p,{children:["Require use of JSTL ",(0,n.jsx)(s.code,{children:"escapeXml"})," function in every expression. Alternatively, require use of JSTL ",(0,n.jsx)(s.code,{children:"escapeXml"})," function in every expression."]}),"\n",(0,n.jsx)(s.h4,{id:"semgrep-rule-2",children:"Semgrep rule"}),"\n",(0,n.jsx)(a.A,{ruleId:"java.lang.security.audit.xss.jsp.use-escapexml.use-escapexml"}),"\n",(0,n.jsxs)(s.h3,{id:"2bany-expression-without-escapexml",children:["2.B.Any expression without ",(0,n.jsx)(s.strong,{children:"escapeXml"})]}),"\n",(0,n.jsxs)(s.p,{children:["The ",(0,n.jsx)(s.code,{children:"escapeXml"})," JSTL expression will escape XML characters. Any data rendered without this or another escaping method will be a potential site for XSS."]}),"\n",(0,n.jsx)(s.p,{children:"Example:"}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-java",children:"<div>${userObj.name}</div>\n"})}),"\n",(0,n.jsx)(s.h4,{id:"references-2",children:"References"}),"\n",(0,n.jsxs)(s.ul,{children:["\n",(0,n.jsx)(s.li,{children:(0,n.jsx)(s.a,{href:"https://stackoverflow.com/questions/2658922/xss-prevention-in-jsp-servlet-web-application",children:"XSS prevention in JSP application"})}),"\n",(0,n.jsx)(s.li,{children:(0,n.jsx)(s.a,{href:"https://pukkaone.github.io/2011/01/03/jsp-cross-site-scripting-elresolver.html",children:"JSP cross-site scripting ELResolver"})}),"\n"]}),"\n",(0,n.jsx)(s.h4,{id:"mitigation-3",children:"Mitigation"}),"\n",(0,n.jsxs)(s.p,{children:["Require use of JSTL ",(0,n.jsx)(s.code,{children:"escapeXml"})," function in every expression. Alternatively, require use of JSTL ",(0,n.jsx)(s.code,{children:"escapeXml"})," function in every expression."]}),"\n",(0,n.jsx)(s.h4,{id:"semgrep-rule-3",children:"Semgrep rule"}),"\n",(0,n.jsx)(a.A,{ruleId:"java.lang.security.audit.xss.jsp.use-escapexml.use-escapexml"}),"\n",(0,n.jsx)(s.hr,{}),"\n",(0,n.jsx)(s.h2,{id:"3-jsp-page-variable-in-dangerous-location",children:"3. JSP page: Variable in dangerous location"}),"\n",(0,n.jsx)(s.h3,{id:"3a-unquoted-variable-in-html-attribute",children:"3.A. Unquoted variable in HTML attribute"}),"\n",(0,n.jsxs)(s.p,{children:["Unquoted template variables rendered into HTML attributes is a potential XSS vector because an attacker could inject JavaScript handlers which do not require HTML characters. An example handler might look like: ",(0,n.jsx)(s.code,{children:"onmouseover=alert(1)"}),". HTML escaping will not mitigate this. The variable must be quoted to avoid this."]}),"\n",(0,n.jsx)(s.p,{children:"Example:"}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-java",children:"<div class=${classes}></div>\n"})}),"\n",(0,n.jsx)(s.h4,{id:"references-3",children:"References"}),"\n",(0,n.jsxs)(s.ul,{children:["\n",(0,n.jsx)(s.li,{children:(0,n.jsx)(s.a,{href:"https://flask.palletsprojects.com/en/1.1.x/security/#cross-site-scripting-xss",children:"Flask cross-site scripting considerations - unquoted variable in HTML attribute"})}),"\n"]}),"\n",(0,n.jsx)(s.h4,{id:"mitigation-4",children:"Mitigation"}),"\n",(0,n.jsx)(s.p,{children:"Flag unquoted HTML attributes with Jinja expressions. Alternatively, always use quotes around HTML attributes."}),"\n",(0,n.jsxs)(s.h3,{id:"3b-variable-in-href-attribute",children:["3.B. Variable in ",(0,n.jsx)(s.strong,{children:"href"})," attribute"]}),"\n",(0,n.jsxs)(s.p,{children:["Template variables in a ",(0,n.jsx)(s.code,{children:"href"})," value could still accept the ",(0,n.jsx)(s.code,{children:"javascript:"})," URI. This could be a XSS vulnerability. HTML escaping will not prevent this. Use ",(0,n.jsx)(s.code,{children:"url_for"})," to generate links."]}),"\n",(0,n.jsx)(s.p,{children:"Example:"}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-java",children:'<a href="${link}"></a>\n'})}),"\n",(0,n.jsx)(s.h4,{id:"references-4",children:"References"}),"\n",(0,n.jsxs)(s.ul,{children:["\n",(0,n.jsx)(s.li,{children:(0,n.jsxs)(s.a,{href:"https://flask.palletsprojects.com/en/1.1.x/security/#cross-site-scripting-xss",children:["Flask cross-site scripting considerations - variable in ",(0,n.jsx)(s.code,{children:"href"})]})}),"\n"]}),"\n",(0,n.jsx)(s.h4,{id:"mitigation-5",children:"Mitigation"}),"\n",(0,n.jsxs)(s.p,{children:["Flag template variables in ",(0,n.jsx)(s.code,{children:"href"})," attributes."]}),"\n",(0,n.jsxs)(s.h3,{id:"3c-variable-in-script-block",children:["3.C. Variable in ",(0,n.jsx)(s.strong,{children:"<script>"})," block"]}),"\n",(0,n.jsx)(s.p,{children:"Template variables placed directly into JavaScript or similar are now directly in a code execution context. Normal HTML escaping will not prevent the possibility of code injection because code can be written without HTML characters. This creates the potential for XSS vulnerabilities, or worse."}),"\n",(0,n.jsx)(s.h4,{id:"references-5",children:"References"}),"\n",(0,n.jsxs)(s.ul,{children:["\n",(0,n.jsx)(s.li,{children:(0,n.jsx)(s.a,{href:"https://www.veracode.com/blog/secure-development/nodejs-template-engines-why-default-encoders-are-not-enough",children:"Template engines: Why default encoders are not enough"})}),"\n",(0,n.jsx)(s.li,{children:(0,n.jsx)(s.a,{href:"https://adamj.eu/tech/2020/02/18/safely-including-data-for-javascript-in-a-django-template/",children:"Safely including data for JavaScript in a Django template"})}),"\n",(0,n.jsx)(s.li,{children:(0,n.jsxs)(s.a,{href:"https://docs.djangoproject.com/en/3.0/ref/templates/builtins/#json-script",children:[(0,n.jsx)(s.code,{children:"json_script"})," documentation"]})}),"\n"]}),"\n",(0,n.jsx)(s.p,{children:"Example:"}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-java",children:"<script>var name = ${name};<\/script>\n"})}),"\n",(0,n.jsx)(s.h4,{id:"mitigation-6",children:"Mitigation"}),"\n",(0,n.jsxs)(s.p,{children:["Ban template variables in ",(0,n.jsx)(s.code,{children:"<script>"})," blocks."]})]})}function g(e={}){const{wrapper:s}={...(0,t.R)(),...e.components};return s?(0,n.jsx)(s,{...e,children:(0,n.jsx)(u,{...e})}):u(e)}},88483:(e,s,i)=>{i.d(s,{Ay:()=>l,RM:()=>t});var r=i(74848),n=i(28453);const t=[];function a(e){const s={p:"p",...(0,n.R)(),...e.components};return(0,r.jsx)(s.p,{children:"This is a cross-site scripting (XSS) prevention cheat sheet by Semgrep, Inc. It contains code patterns of potential XSS in an application. Instead of scrutinizing code for exploitable vulnerabilities, the recommendations in this cheat sheet pave a safe road for developers that mitigate the possibility of XSS in your code. By following these recommendations, you can be reasonably sure your code is free of XSS."})}function l(e={}){const{wrapper:s}={...(0,n.R)(),...e.components};return s?(0,r.jsx)(s,{...e,children:(0,r.jsx)(a,{...e})}):a(e)}}}]);