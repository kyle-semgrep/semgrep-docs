"use strict";(self.webpackChunkmegadocs=self.webpackChunkmegadocs||[]).push([[70854],{10064:(e,i,s)=>{s.d(i,{Ay:()=>l,RM:()=>t});var n=s(74848),r=s(28453);const t=[];function a(e){const i={code:"code",p:"p",pre:"pre",...(0,r.R)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(i.p,{children:"The following command runs an optimized set of rules for your project:"}),"\n",(0,n.jsx)(i.pre,{children:(0,n.jsx)(i.code,{className:"language-bash",children:"semgrep --config p/default\n"})})]})}function l(e={}){const{wrapper:i}={...(0,r.R)(),...e.components};return i?(0,n.jsx)(i,{...e,children:(0,n.jsx)(a,{...e})}):a(e)}},21250:(e,i,s)=>{s.d(i,{A:()=>r});s(96540);var n=s(74848);function r(e){let{ruleId:i}=e;const s=new URL("https://semgrep.dev/r");return s.searchParams.set("q",i),(0,n.jsx)("a",{href:s,target:"_blank",children:i})}},28453:(e,i,s)=>{s.d(i,{R:()=>a,x:()=>l});var n=s(96540);const r={},t=n.createContext(r);function a(e){const i=n.useContext(t);return n.useMemo((function(){return"function"==typeof e?e(i):{...i,...e}}),[i,e])}function l(e){let i;return i=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:a(e.components),n.createElement(t.Provider,{value:i},e.children)}},40662:(e,i,s)=>{s.r(i),s.d(i,{assets:()=>h,contentTitle:()=>o,default:()=>x,frontMatter:()=>d,metadata:()=>n,toc:()=>p});const n=JSON.parse('{"id":"cheat-sheets/express-xss","title":"XSS prevention for ExpressJS","description":"ExpressJS mitigation cheat sheet by Semgrep.","source":"@site/docs/cheat-sheets/express-xss.mdx","sourceDirName":"cheat-sheets","slug":"/cheat-sheets/express-xss","permalink":"/semgrep-docs/cheat-sheets/express-xss","draft":false,"unlisted":false,"editUrl":"https://github.com/kyle-semgrep/semgrep-docs/edit/main/docs/cheat-sheets/express-xss.mdx","tags":[],"version":"current","lastUpdatedAt":1752260268000,"frontMatter":{"slug":"express-xss","description":"ExpressJS mitigation cheat sheet by Semgrep."},"sidebar":"cheatsheetSidebar","previous":{"title":"XSS prevention for Django","permalink":"/semgrep-docs/cheat-sheets/django-xss"},"next":{"title":"XSS prevention for Flask","permalink":"/semgrep-docs/cheat-sheets/flask-xss"}}');var r=s(74848),t=s(28453),a=s(21250),l=s(88483),c=s(10064);const d={slug:"express-xss",description:"ExpressJS mitigation cheat sheet by Semgrep."},o="XSS prevention for ExpressJS",h={},p=[...l.RM,{value:"Mitigation summary",id:"mitigation-summary",level:2},{value:"Check your project using Semgrep",id:"check-your-project-using-semgrep",level:3},...c.RM,{value:"1. Server code: Bypassing the template engine",id:"1-server-code-bypassing-the-template-engine",level:2},{value:"1.A. Direct use of <code>res.send()</code>",id:"1a-direct-use-of-ressend",level:3},{value:"References",id:"references",level:4},{value:"Mitigation",id:"mitigation",level:4},{value:"Semgrep rule",id:"semgrep-rule",level:4},{value:"1.B. Direct use of <code>res.write()</code>",id:"1b-direct-use-of-reswrite",level:3},{value:"References",id:"references-1",level:4},{value:"Mitigation",id:"mitigation-1",level:4},{value:"Semgrep rule",id:"semgrep-rule-1",level:4},{value:"1.C. Mustache: overwriting the global escape function",id:"1c-mustache-overwriting-the-global-escape-function",level:3},{value:"References",id:"references-2",level:4},{value:"Mitigation",id:"mitigation-2",level:4},{value:"Semgrep rule",id:"semgrep-rule-2",level:4},{value:"2. Templates: Variable explicitly unescaped",id:"2-templates-variable-explicitly-unescaped",level:2},{value:"2.A. Mustache: Triple braces <code>{{{ ... }}}</code>",id:"2a-mustache-triple-braces---",level:3},{value:"References",id:"references-3",level:4},{value:"Mitigation:",id:"mitigation-3",level:4},{value:"Semgrep rule",id:"semgrep-rule-3",level:4},{value:"2.B. Mustache: Ampersand <code>&amp;</code>",id:"2b-mustache-ampersand-",level:3},{value:"References",id:"references-4",level:4},{value:"Mitigation",id:"mitigation-4",level:4},{value:"Semgrep rule",id:"semgrep-rule-4",level:4},{value:"2.C. Pug: The unescape operator, <code>!=</code>",id:"2c-pug-the-unescape-operator-",level:3},{value:"References",id:"references-5",level:4},{value:"Mitigation",id:"mitigation-5",level:4},{value:"Semgrep rule",id:"semgrep-rule-5",level:4},{value:"2.D. Pug: Unescaped strings with <code>!{ ... }</code>",id:"2d-pug-unescaped-strings-with---",level:3},{value:"References",id:"references-6",level:4},{value:"Mitigation:",id:"mitigation-6",level:4},{value:"Semgrep rule",id:"semgrep-rule-6",level:4},{value:"2.E Pug: And-attributes, <code>$attributes(...)</code>",id:"2e-pug-and-attributes-attributes",level:3},{value:"References",id:"references-7",level:4},{value:"Mitigation",id:"mitigation-7",level:4},{value:"Semgrep rule",id:"semgrep-rule-7",level:4},{value:"2.F. EJS: Unescaped content, <code>&lt;%- ... %&gt;</code>",id:"2f-ejs-unescaped-content----",level:3},{value:"References",id:"references-8",level:4},{value:"Mitigation",id:"mitigation-8",level:4},{value:"Semgrep rule",id:"semgrep-rule-8",level:4},{value:"3. Templates: Variable in dangerous location",id:"3-templates-variable-in-dangerous-location",level:2},{value:"3.A. Mustache: Unquoted variable in HTML attribute",id:"3a-mustache-unquoted-variable-in-html-attribute",level:3},{value:"References",id:"references-9",level:4},{value:"Mitigation",id:"mitigation-9",level:4},{value:"3.B. EJS: Unquoted variable in HTML attribute",id:"3b-ejs-unquoted-variable-in-html-attribute",level:3},{value:"References",id:"references-10",level:4},{value:"Mitigation",id:"mitigation-10",level:4},{value:"3.C. Mustache: Variable in <code>href</code> attribute",id:"3c-mustache-variable-in-href-attribute",level:3},{value:"References",id:"references-11",level:4},{value:"Mitigation",id:"mitigation-11",level:4},{value:"Semgrep rule",id:"semgrep-rule-9",level:4},{value:"3.D. Pug: Variable in <code>href</code> attribute",id:"3d-pug-variable-in-href-attribute",level:3},{value:"References",id:"references-12",level:4},{value:"Mitigation",id:"mitigation-12",level:4},{value:"Semgrep rule",id:"semgrep-rule-10",level:4},{value:"3.E. EJS: Variable in <code>href</code> attribute",id:"3e-ejs-variable-in-href-attribute",level:3},{value:"References",id:"references-13",level:4},{value:"Mitigation",id:"mitigation-13",level:4},{value:"Semgrep rule",id:"semgrep-rule-11",level:4},{value:"3.F. Mustache: Variable in <code>&lt;script&gt;</code> block",id:"3f-mustache-variable-in-script-block",level:3},{value:"References",id:"references-14",level:4},{value:"Mitigation",id:"mitigation-14",level:4},{value:"Semgrep rule",id:"semgrep-rule-12",level:4},{value:"3.G. Pug: Variable in <code>&lt;script&gt;</code> block",id:"3g-pug-variable-in-script-block",level:3},{value:"References",id:"references-15",level:4},{value:"Mitigation",id:"mitigation-15",level:4},{value:"Semgrep rule",id:"semgrep-rule-13",level:4},{value:"3.H. EJS: Variable in <code>&lt;script&gt;</code> block",id:"3h-ejs-variable-in-script-block",level:3},{value:"References",id:"references-16",level:4},{value:"Mitigation",id:"mitigation-16",level:4},{value:"Semgrep rule",id:"semgrep-rule-14",level:4}];function u(e){const i={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",hr:"hr",li:"li",p:"p",pre:"pre",ul:"ul",...(0,t.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(i.header,{children:(0,r.jsx)(i.h1,{id:"xss-prevention-for-expressjs",children:"XSS prevention for ExpressJS"})}),"\n",(0,r.jsx)(l.Ay,{}),"\n",(0,r.jsx)(i.h2,{id:"mitigation-summary",children:"Mitigation summary"}),"\n",(0,r.jsxs)(i.p,{children:["In general, always use a template engine and ",(0,r.jsx)(i.code,{children:"res.render()"})," to render HTML content. Some common template engines include Pug, Mustache, and EJS. If you need HTML escaping, escape the content. Try to do so in JavaScript code if possible. Review each individual case carefully. Once reviewed, exempt the finding with ",(0,r.jsx)(i.code,{children:"# nosemgrep"}),". Beware of putting data in dangerous locations such as in ",(0,r.jsx)(i.code,{children:"script"})," tags. And as always, run a security checker on your code."]}),"\n",(0,r.jsx)(i.h3,{id:"check-your-project-using-semgrep",children:"Check your project using Semgrep"}),"\n",(0,r.jsx)(c.Ay,{}),"\n",(0,r.jsx)(i.h2,{id:"1-server-code-bypassing-the-template-engine",children:"1. Server code: Bypassing the template engine"}),"\n",(0,r.jsxs)(i.h3,{id:"1a-direct-use-of-ressend",children:["1.A. Direct use of ",(0,r.jsx)(i.code,{children:"res.send()"})]}),"\n",(0,r.jsx)(i.p,{children:"Writing directly to the response object bypasses the template engine which means content will not be autoescaped. This could introduce a XSS vulnerability."}),"\n",(0,r.jsx)(i.p,{children:"Example:"}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-javascript",children:'res.send("<div>" + user.name + "</div>")\n'})}),"\n",(0,r.jsx)(i.h4,{id:"references",children:"References"}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsx)(i.li,{children:(0,r.jsxs)(i.a,{href:"https://stackoverflow.com/questions/36765667/xssexpressjs-prevent-run-script-form-post-request",children:["Sanitizers required when sending data via ",(0,r.jsx)(i.code,{children:"res.send()"})]})}),"\n",(0,r.jsx)(i.li,{children:(0,r.jsxs)(i.a,{href:"https://expressjs.com/en/api.html#res.send",children:[(0,r.jsx)(i.code,{children:"res.send()"})," documentation"]})}),"\n"]}),"\n",(0,r.jsx)(i.h4,{id:"mitigation",children:"Mitigation"}),"\n",(0,r.jsxs)(i.p,{children:["Ban ",(0,r.jsx)(i.code,{children:"res.send()"}),". Alternatively, use a template engine and call ",(0,r.jsx)(i.code,{children:"res.render()"}),"."]}),"\n",(0,r.jsx)(i.h4,{id:"semgrep-rule",children:"Semgrep rule"}),"\n",(0,r.jsx)(a.A,{ruleId:"javascript.express.security.audit.xss.direct-response-write.direct-response-write"}),"\n",(0,r.jsxs)(i.h3,{id:"1b-direct-use-of-reswrite",children:["1.B. Direct use of ",(0,r.jsx)(i.code,{children:"res.write()"})]}),"\n",(0,r.jsx)(i.p,{children:"Writing directly to the response object bypasses the template engine which means content will not be autoescaped. This could introduce a XSS vulnerability."}),"\n",(0,r.jsx)(i.p,{children:"Example:"}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-javascript",children:'res.write("<div>" + user.name + "</div>")\n'})}),"\n",(0,r.jsx)(i.h4,{id:"references-1",children:"References"}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsx)(i.li,{children:(0,r.jsxs)(i.a,{href:"https://stackoverflow.com/questions/36765667/xssexpressjs-prevent-run-script-form-post-request",children:["Sanitizers required when sending data via ",(0,r.jsx)(i.code,{children:"res.send()"})]})}),"\n",(0,r.jsx)(i.li,{children:(0,r.jsxs)(i.a,{href:"https://nodejs.org/api/http.html#http_response_write_chunk_encoding_callback",children:[(0,r.jsx)(i.code,{children:"response.write()"})," documentation"]})}),"\n",(0,r.jsx)(i.li,{children:(0,r.jsxs)(i.a,{href:"https://stackoverflow.com/questions/44692048/what-is-the-difference-between-res-send-and-res-write-in-express/44693016",children:["Differences between ",(0,r.jsx)(i.code,{children:"res.send()"})," and ",(0,r.jsx)(i.code,{children:"res.write()"})]})}),"\n"]}),"\n",(0,r.jsx)(i.h4,{id:"mitigation-1",children:"Mitigation"}),"\n",(0,r.jsxs)(i.p,{children:["Ban ",(0,r.jsx)(i.code,{children:"response.write()"}),". Alternatively, use a template engine and call ",(0,r.jsx)(i.code,{children:"res.render()"}),"."]}),"\n",(0,r.jsx)(i.h4,{id:"semgrep-rule-1",children:"Semgrep rule"}),"\n",(0,r.jsx)(a.A,{ruleId:"javascript.express.security.audit.xss.direct-response-write.direct-response-write"}),"\n",(0,r.jsx)(i.h3,{id:"1c-mustache-overwriting-the-global-escape-function",children:"1.C. Mustache: overwriting the global escape function"}),"\n",(0,r.jsxs)(i.p,{children:[(0,r.jsx)(i.code,{children:"Mustache.escape()"})," is the global escape function for Mustache. If this is overwritten, escaping may not happen properly and this could introduce XSS vulnerabilities."]}),"\n",(0,r.jsx)(i.p,{children:"Example:"}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-javascript",children:"Mustache.escape = function(text) {return text;};\n"})}),"\n",(0,r.jsx)(i.h4,{id:"references-2",children:"References"}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsx)(i.li,{children:(0,r.jsx)(i.a,{href:"https://github.com/janl/mustache.js#variables",children:"Disable HTML escaping globally in Mustache template"})}),"\n"]}),"\n",(0,r.jsx)(i.h4,{id:"mitigation-2",children:"Mitigation"}),"\n",(0,r.jsxs)(i.p,{children:["Ban overwriting ",(0,r.jsx)(i.code,{children:"Mustache.escape"}),". If necessary, use triple braces to escape only what you need in the template. Review each usage carefully and exempt with ",(0,r.jsx)(i.code,{children:"\x3c!-- nosemgrepgrep --\x3e"}),"."]}),"\n",(0,r.jsx)(i.h4,{id:"semgrep-rule-2",children:"Semgrep rule"}),"\n",(0,r.jsx)(a.A,{ruleId:"javascript.express.security.audit.xss.mustache.escape-function-overwrite.escape-function-overwrite"}),"\n",(0,r.jsx)(i.hr,{}),"\n",(0,r.jsx)(i.h2,{id:"2-templates-variable-explicitly-unescaped",children:"2. Templates: Variable explicitly unescaped"}),"\n",(0,r.jsxs)(i.h3,{id:"2a-mustache-triple-braces---",children:["2.A. Mustache: Triple braces ",(0,r.jsx)(i.code,{children:"{{{ ... }}}"})]}),"\n",(0,r.jsx)(i.p,{children:"Triple braces disables escaping for the content inside. This could expose your application to XSS vulnerabilities."}),"\n",(0,r.jsx)(i.p,{children:"Example:"}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-javascript",children:"{{{ user_name }}}\n"})}),"\n",(0,r.jsx)(i.h4,{id:"references-3",children:"References"}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsx)(i.li,{children:(0,r.jsx)(i.a,{href:"https://github.com/janl/mustache.js#variables",children:"Rendering unescaped HTML in Mustache"})}),"\n"]}),"\n",(0,r.jsx)(i.h4,{id:"mitigation-3",children:"Mitigation:"}),"\n",(0,r.jsxs)(i.p,{children:["Ban triple braces. Alternatively, only use this if necessary. Review each usage carefully and exempt with ",(0,r.jsx)(i.code,{children:"\x3c!-- nosemgrep --\x3e"}),"."]}),"\n",(0,r.jsx)(i.h4,{id:"semgrep-rule-3",children:"Semgrep rule"}),"\n",(0,r.jsx)(a.A,{ruleId:"javascript.express.security.audit.xss.mustache.explicit-unescape.template-explicit-unescape"}),"\n",(0,r.jsxs)(i.h3,{id:"2b-mustache-ampersand-",children:["2.B. Mustache: Ampersand ",(0,r.jsx)(i.code,{children:"&"})]}),"\n",(0,r.jsx)(i.p,{children:"The ampersand disables escaping for the following variable. This could expose your application to XSS vulnerabilities."}),"\n",(0,r.jsx)(i.p,{children:"Example:"}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-javascript",children:"{{ &user_name }}\n"})}),"\n",(0,r.jsx)(i.h4,{id:"references-4",children:"References"}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsx)(i.li,{children:(0,r.jsx)(i.a,{href:"https://github.com/janl/mustache.js#variables",children:"Rendering unescaped HTML in Mustache"})}),"\n"]}),"\n",(0,r.jsx)(i.h4,{id:"mitigation-4",children:"Mitigation"}),"\n",(0,r.jsx)(i.p,{children:"Ban ampersand escaping in template expressions. Alternatively, prefer triple braces, if necessary."}),"\n",(0,r.jsx)(i.h4,{id:"semgrep-rule-4",children:"Semgrep rule"}),"\n",(0,r.jsx)(a.A,{ruleId:"javascript.express.security.audit.xss.mustache.explicit-unescape.template-explicit-unescape"}),"\n",(0,r.jsxs)(i.h3,{id:"2c-pug-the-unescape-operator-",children:["2.C. Pug: The unescape operator, ",(0,r.jsx)(i.code,{children:"!="})]}),"\n",(0,r.jsxs)(i.p,{children:["The unescape operator, ",(0,r.jsx)(i.code,{children:"!="}),", disables HTML escaping for the content. This permits raw HTML to be rendered in a template, which could create a XSS vulnerability."]}),"\n",(0,r.jsx)(i.p,{children:"Example:"}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-javascript",children:"a(href!=url) Documentation\n"})}),"\n",(0,r.jsx)(i.h4,{id:"references-5",children:"References"}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsx)(i.li,{children:(0,r.jsx)(i.a,{href:"https://pugjs.org/language/attributes.html#unescaped-attributes",children:"Pug unescaped attributes documentation"})}),"\n"]}),"\n",(0,r.jsx)(i.h4,{id:"mitigation-5",children:"Mitigation"}),"\n",(0,r.jsxs)(i.p,{children:["Ban ",(0,r.jsx)(i.code,{children:"!="}),"; it is rarely necessary. Often, you want ",(0,r.jsx)(i.code,{children:"!{...}"}),". If you must use this, review each usage carefully and exempt with ",(0,r.jsx)(i.code,{children:"\x3c!-- nosemgrep --\x3e"}),"."]}),"\n",(0,r.jsx)(i.h4,{id:"semgrep-rule-5",children:"Semgrep rule"}),"\n",(0,r.jsx)(a.A,{ruleId:"javascript.express.security.audit.xss.pug.explicit-unescape.template-explicit-unescape"}),"\n",(0,r.jsxs)(i.h3,{id:"2d-pug-unescaped-strings-with---",children:["2.D. Pug: Unescaped strings with ",(0,r.jsx)(i.code,{children:"!{ ... }"})]}),"\n",(0,r.jsxs)(i.p,{children:[(0,r.jsx)(i.code,{children:"!{...}"})," disables HTML escaping for the content. This permits raw HTML to be rendered in a template, which could create a XSS vulnerability."]}),"\n",(0,r.jsx)(i.p,{children:"Example:"}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-javascript",children:"p Joel: !{riskyBusiness}\n"})}),"\n",(0,r.jsx)(i.h4,{id:"references-6",children:"References"}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsx)(i.li,{children:(0,r.jsx)(i.a,{href:"https://pugjs.org/language/interpolation.html#string-interpolation-unescaped",children:"String Interpolation, Unescaped"})}),"\n"]}),"\n",(0,r.jsx)(i.h4,{id:"mitigation-6",children:"Mitigation:"}),"\n",(0,r.jsxs)(i.p,{children:["Ban ",(0,r.jsx)(i.code,{children:"!{...}"}),". Alternatively, only use this if necessary. Review each usage carefully and exempt with ",(0,r.jsx)(i.code,{children:"\x3c!-- nosemgrep --\x3e"}),"."]}),"\n",(0,r.jsx)(i.h4,{id:"semgrep-rule-6",children:"Semgrep rule"}),"\n",(0,r.jsx)(a.A,{ruleId:"javascript.express.security.audit.xss.pug.explicit-unescape.template-explicit-unescape"}),"\n",(0,r.jsxs)(i.h3,{id:"2e-pug-and-attributes-attributes",children:["2.E Pug: And-attributes, ",(0,r.jsx)(i.code,{children:"$attributes(...)"})]}),"\n",(0,r.jsxs)(i.p,{children:["The ",(0,r.jsx)(i.code,{children:"&attributes(...)"})," syntax explodes an object into attributes of an element. Attributes are not automatically escaped using this method. This permits raw HTML to be rendered in a template, which could create a XSS vulnerability."]}),"\n",(0,r.jsx)(i.p,{children:"Example:"}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-html",children:"div#foo(data-bar='foo')&attributes({'data-foo': 'bar'})\n"})}),"\n",(0,r.jsx)(i.h4,{id:"references-7",children:"References"}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsx)(i.li,{children:(0,r.jsx)(i.a,{href:"https://pugjs.org/language/attributes.html#attributes",children:"&attributes documentation"})}),"\n"]}),"\n",(0,r.jsx)(i.h4,{id:"mitigation-7",children:"Mitigation"}),"\n",(0,r.jsxs)(i.p,{children:["Ban ",(0,r.jsx)(i.code,{children:"&attributes(...)"}),". Alternatively, prefer ",(0,r.jsx)(i.code,{children:"!="})," only if necessary."]}),"\n",(0,r.jsx)(i.h4,{id:"semgrep-rule-7",children:"Semgrep rule"}),"\n",(0,r.jsx)(a.A,{ruleId:"javascript.express.security.audit.xss.pug.and-attributes.template-and-attributes"}),"\n",(0,r.jsxs)(i.h3,{id:"2f-ejs-unescaped-content----",children:["2.F. EJS: Unescaped content, ",(0,r.jsx)(i.code,{children:"<%- ... %>"})]}),"\n",(0,r.jsx)(i.p,{children:"A hyphen instead of an equals in EJS expressions disables escaping for the content inside. This could expose your application to XSS vulnerabilities."}),"\n",(0,r.jsx)(i.p,{children:"Example:"}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-html",children:"<div><%- user.name %></div>\n"})}),"\n",(0,r.jsx)(i.h4,{id:"references-8",children:"References"}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsx)(i.li,{children:(0,r.jsx)(i.a,{href:"http://www.managerjs.com/blog/2015/05/will-ejs-escape-save-me-from-xss-sorta/",children:"Will EJS save me from XSS?"})}),"\n"]}),"\n",(0,r.jsx)(i.h4,{id:"mitigation-8",children:"Mitigation"}),"\n",(0,r.jsxs)(i.p,{children:["Ban ",(0,r.jsx)(i.code,{children:"<%- ... %>"}),". Alternatively, only use it if necessary. Review each usage carefully and exempt with ",(0,r.jsx)(i.code,{children:"\x3c!-- nosemgrep --\x3e"}),"."]}),"\n",(0,r.jsx)(i.h4,{id:"semgrep-rule-8",children:"Semgrep rule"}),"\n",(0,r.jsx)(a.A,{ruleId:"javascript.express.security.audit.xss.ejs.explicit-unescape.template-explicit-unescape"}),"\n",(0,r.jsx)(i.hr,{}),"\n",(0,r.jsx)(i.h2,{id:"3-templates-variable-in-dangerous-location",children:"3. Templates: Variable in dangerous location"}),"\n",(0,r.jsx)(i.h3,{id:"3a-mustache-unquoted-variable-in-html-attribute",children:"3.A. Mustache: Unquoted variable in HTML attribute"}),"\n",(0,r.jsxs)(i.p,{children:["Unquoted template variables rendered into HTML attributes is a potential XSS vector because an attacker could inject JavaScript handlers which do not require HTML characters. An example handler might look like: ",(0,r.jsx)(i.code,{children:"onmouseover=alert(1)"}),". HTML escaping will not mitigate this. The variable must be quoted to avoid this."]}),"\n",(0,r.jsx)(i.p,{children:"Eexample:"}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-html",children:"<div class={{ classes }}></div>\n"})}),"\n",(0,r.jsx)(i.h4,{id:"references-9",children:"References"}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsx)(i.li,{children:(0,r.jsx)(i.a,{href:"https://flask.palletsprojects.com/en/1.1.x/security/#cross-site-scripting-xss",children:"Flask cross-site scripting considerations - unquoted variable in HTML attribute (relevant to all templates)"})}),"\n"]}),"\n",(0,r.jsx)(i.h4,{id:"mitigation-9",children:"Mitigation"}),"\n",(0,r.jsx)(i.p,{children:"'Flag unquoted HTML attributes with Mustache expressions. Alternatively, always use quotes around HTML attributes."}),"\n",(0,r.jsx)(i.h3,{id:"3b-ejs-unquoted-variable-in-html-attribute",children:"3.B. EJS: Unquoted variable in HTML attribute"}),"\n",(0,r.jsxs)(i.p,{children:["Unquoted template variables rendered into HTML attributes is a potential XSS vector because an attacker could inject JavaScript handlers which do not require HTML characters. An example handler might look like: ",(0,r.jsx)(i.code,{children:"onmouseover=alert(1)"}),". HTML escaping will not mitigate this. The variable must be quoted to avoid this."]}),"\n",(0,r.jsx)(i.p,{children:"Example:"}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-html",children:"<div class=<%= classes %>></div>\n"})}),"\n",(0,r.jsx)(i.h4,{id:"references-10",children:"References"}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsx)(i.li,{children:(0,r.jsx)(i.a,{href:"https://flask.palletsprojects.com/en/1.1.x/security/#cross-site-scripting-xss",children:"Flask cross-site scripting considerations - unquoted variable in HTML attribute (relevant to all templates)"})}),"\n"]}),"\n",(0,r.jsx)(i.h4,{id:"mitigation-10",children:"Mitigation"}),"\n",(0,r.jsx)(i.p,{children:"Flag unquoted HTML attributes with EJS expressions. Alternatively, always use quotes around HTML attributes."}),"\n",(0,r.jsxs)(i.h3,{id:"3c-mustache-variable-in-href-attribute",children:["3.C. Mustache: Variable in ",(0,r.jsx)(i.code,{children:"href"})," attribute"]}),"\n",(0,r.jsxs)(i.p,{children:["Template variables in a ",(0,r.jsx)(i.code,{children:"href"})," value could still accept the ",(0,r.jsx)(i.code,{children:"javascript:"})," URI. This could be a XSS vulnerability. HTML escaping will not prevent this. Begin links with a forward slash '/' prior to the template expression to generate dynamic links: ",(0,r.jsx)(i.code,{children:'<a href="/{{ url }}}">'})]}),"\n",(0,r.jsx)(i.p,{children:"Example:"}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-html",children:'<a href="{{ url }}">\n'})}),"\n",(0,r.jsx)(i.h4,{id:"references-11",children:"References"}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsx)(i.li,{children:(0,r.jsxs)(i.a,{href:"https://flask.palletsprojects.com/en/1.1.x/security/#cross-site-scripting-xss",children:["Flask cross-site scripting considerations - variable in ",(0,r.jsx)(i.code,{children:"href"})," (relevant to all templates)"]})}),"\n"]}),"\n",(0,r.jsx)(i.h4,{id:"mitigation-11",children:"Mitigation"}),"\n",(0,r.jsxs)(i.p,{children:["Flag template variables in ",(0,r.jsx)(i.code,{children:"href"})," attributes. Alternatively, use a literal forward slash preceding the template expression to generate relative links."]}),"\n",(0,r.jsx)(i.h4,{id:"semgrep-rule-9",children:"Semgrep rule"}),"\n",(0,r.jsx)(a.A,{ruleId:"javascript.express.security.audit.xss.mustache.var-in-href.var-in-href"}),"\n",(0,r.jsxs)(i.h3,{id:"3d-pug-variable-in-href-attribute",children:["3.D. Pug: Variable in ",(0,r.jsx)(i.code,{children:"href"})," attribute"]}),"\n",(0,r.jsxs)(i.p,{children:["Template variables in a ",(0,r.jsx)(i.code,{children:"href"})," value could still accept the ",(0,r.jsx)(i.code,{children:"javascript:"})," URI. This could be a XSS vulnerability. HTML escaping will not prevent this. Begin links with a forward slash '/' prior to the template expression to generate dynamic links: ",(0,r.jsx)(i.code,{children:"a(href='/' + link)=\"hello\""})]}),"\n",(0,r.jsx)(i.p,{children:"Example:"}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-html",children:'a(href=link)="hello"\n'})}),"\n",(0,r.jsx)(i.h4,{id:"references-12",children:"References"}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsx)(i.li,{children:(0,r.jsxs)(i.a,{href:"https://flask.palletsprojects.com/en/1.1.x/security/#cross-site-scripting-xss",children:["Flask cross-site scripting considerations - variable in ",(0,r.jsx)(i.code,{children:"href"})," (relevant to all templates)"]})}),"\n"]}),"\n",(0,r.jsx)(i.h4,{id:"mitigation-12",children:"Mitigation"}),"\n",(0,r.jsxs)(i.p,{children:["Flag template variables in ",(0,r.jsx)(i.code,{children:"href"})," attributes. Alternatively, append the link to a literal forward slash to forcibly generate relative links."]}),"\n",(0,r.jsx)(i.h4,{id:"semgrep-rule-10",children:"Semgrep rule"}),"\n",(0,r.jsx)(a.A,{ruleId:"javascript.express.security.audit.xss.pug.var-in-href.var-in-href"}),"\n",(0,r.jsxs)(i.h3,{id:"3e-ejs-variable-in-href-attribute",children:["3.E. EJS: Variable in ",(0,r.jsx)(i.code,{children:"href"})," attribute"]}),"\n",(0,r.jsxs)(i.p,{children:["Template variables in a ",(0,r.jsx)(i.code,{children:"href"})," value could still accept the ",(0,r.jsx)(i.code,{children:"javascript:"})," URI. This could be a XSS vulnerability. HTML escaping will not prevent this. Begin links with a forward slash '/' prior to the template expression to generate dynamic links: ",(0,r.jsx)(i.code,{children:'<a href="/<%= link %>">'})]}),"\n",(0,r.jsx)(i.p,{children:"Example:"}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-html",children:'<a href="<%= link %>"></a>\n'})}),"\n",(0,r.jsx)(i.h4,{id:"references-13",children:"References"}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsx)(i.li,{children:(0,r.jsxs)(i.a,{href:"https://flask.palletsprojects.com/en/1.1.x/security/#cross-site-scripting-xss",children:["Flask cross-site scripting considerations - variable in ",(0,r.jsx)(i.code,{children:"href"})," (relevant to all templates)"]})}),"\n"]}),"\n",(0,r.jsx)(i.h4,{id:"mitigation-13",children:"Mitigation"}),"\n",(0,r.jsxs)(i.p,{children:["Flag template variables in ",(0,r.jsx)(i.code,{children:"href"})," attributes. Alternatively, use a literal forward slash preceding the template expression to generate relative links."]}),"\n",(0,r.jsx)(i.h4,{id:"semgrep-rule-11",children:"Semgrep rule"}),"\n",(0,r.jsx)(a.A,{ruleId:"javascript.express.security.audit.xss.ejs.var-in-href.var-in-href"}),"\n",(0,r.jsxs)(i.h3,{id:"3f-mustache-variable-in-script-block",children:["3.F. Mustache: Variable in ",(0,r.jsx)(i.code,{children:"<script>"})," block"]}),"\n",(0,r.jsx)(i.p,{children:"Template variables placed directly into JavaScript or similar are now directly in a code execution context. Normal HTML escaping will not prevent the possibility of code injection because code can be written without HTML characters. This creates the potential for XSS vulnerabilities, or worse."}),"\n",(0,r.jsx)(i.p,{children:"Example:"}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-html",children:"<script>var name = {{ name }};<\/script>\n"})}),"\n",(0,r.jsx)(i.h4,{id:"references-14",children:"References"}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsx)(i.li,{children:(0,r.jsx)(i.a,{href:"https://www.veracode.com/blog/secure-development/nodejs-template-engines-why-default-encoders-are-not-enough",children:"Template engines: Why default encoders are not enough"})}),"\n",(0,r.jsx)(i.li,{children:(0,r.jsx)(i.a,{href:"https://blog.ircmaxell.com/2018/06/protecting-rails-xss.html",children:"Protecting against XSS in Rails - JavaScript contexts. (Relevant to all template engines.)"})}),"\n"]}),"\n",(0,r.jsx)(i.h4,{id:"mitigation-14",children:"Mitigation"}),"\n",(0,r.jsxs)(i.p,{children:["Ban template variables in ",(0,r.jsx)(i.code,{children:"<script>"})," blocks. Alternatively, avoid wherever possible. If absolutely necessary, locate a JavaScript encoding library and enforce its usage."]}),"\n",(0,r.jsx)(i.h4,{id:"semgrep-rule-12",children:"Semgrep rule"}),"\n",(0,r.jsx)(a.A,{ruleId:"javascript.express.security.audit.xss.mustache.var-in-script-tag.var-in-script-tag"}),"\n",(0,r.jsxs)(i.h3,{id:"3g-pug-variable-in-script-block",children:["3.G. Pug: Variable in ",(0,r.jsx)(i.code,{children:"<script>"})," block"]}),"\n",(0,r.jsx)(i.p,{children:"Template variables placed directly into JavaScript or similar are now directly in a code execution context. Normal HTML escaping will not prevent the possibility of code injection because code can be written without HTML characters. This creates the potential for XSS vulnerabilities, or worse."}),"\n",(0,r.jsx)(i.p,{children:"Example:"}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-html",children:'script(type="text/javascript")="a += " + a\n'})}),"\n",(0,r.jsx)(i.h4,{id:"references-15",children:"References"}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsx)(i.li,{children:(0,r.jsx)(i.a,{href:"https://www.veracode.com/blog/secure-development/nodejs-template-engines-why-default-encoders-are-not-enough",children:"Template engines: Why default encoders are not enough"})}),"\n",(0,r.jsx)(i.li,{children:(0,r.jsx)(i.a,{href:"https://blog.ircmaxell.com/2018/06/protecting-rails-xss.html",children:"Protecting against XSS in Rails - JavaScript contexts. (Relevant to all template engines.)"})}),"\n"]}),"\n",(0,r.jsx)(i.h4,{id:"mitigation-15",children:"Mitigation"}),"\n",(0,r.jsxs)(i.p,{children:["Ban template variables in ",(0,r.jsx)(i.code,{children:"<script>"})," blocks. Alternatively, avoid wherever possible. If absolutely necessary, locate a JavaScript encoding library and enforce its usage."]}),"\n",(0,r.jsx)(i.h4,{id:"semgrep-rule-13",children:"Semgrep rule"}),"\n",(0,r.jsx)(a.A,{ruleId:"javascript.express.security.audit.xss.pug.var-in-script-tag.var-in-script-tag"}),"\n",(0,r.jsxs)(i.h3,{id:"3h-ejs-variable-in-script-block",children:["3.H. EJS: Variable in ",(0,r.jsx)(i.code,{children:"<script>"})," block"]}),"\n",(0,r.jsx)(i.p,{children:"Template variables placed directly into JavaScript or similar are now directly in a code execution context. Normal HTML escaping will not prevent the possibility of code injection because code can be written without HTML characters. This creates the potential for XSS vulnerabilities, or worse."}),"\n",(0,r.jsx)(i.p,{children:"Example:"}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-html",children:"<script>var name = <%= name %>;<\/script>\n"})}),"\n",(0,r.jsx)(i.h4,{id:"references-16",children:"References"}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsx)(i.li,{children:(0,r.jsx)(i.a,{href:"https://www.veracode.com/blog/secure-development/nodejs-template-engines-why-default-encoders-are-not-enough",children:"Template engines: Why default encoders are not enough"})}),"\n",(0,r.jsx)(i.li,{children:(0,r.jsx)(i.a,{href:"https://blog.ircmaxell.com/2018/06/protecting-rails-xss.html",children:"Protecting against XSS in Rails - JavaScript contexts. (Relevant to all template engines.)"})}),"\n"]}),"\n",(0,r.jsx)(i.h4,{id:"mitigation-16",children:"Mitigation"}),"\n",(0,r.jsxs)(i.p,{children:["Ban template variables in ",(0,r.jsx)(i.code,{children:"<script>"})," blocks. Alternatively, avoid wherever possible. If absolutely necessary, locate a JavaScript encoding library and enforce its usage."]}),"\n",(0,r.jsx)(i.h4,{id:"semgrep-rule-14",children:"Semgrep rule"}),"\n",(0,r.jsx)(a.A,{ruleId:"javascript.express.security.audit.xss.ejs.var-in-script-tag.var-in-script-tag"})]})}function x(e={}){const{wrapper:i}={...(0,t.R)(),...e.components};return i?(0,r.jsx)(i,{...e,children:(0,r.jsx)(u,{...e})}):u(e)}},88483:(e,i,s)=>{s.d(i,{Ay:()=>l,RM:()=>t});var n=s(74848),r=s(28453);const t=[];function a(e){const i={p:"p",...(0,r.R)(),...e.components};return(0,n.jsx)(i.p,{children:"This is a cross-site scripting (XSS) prevention cheat sheet by Semgrep, Inc. It contains code patterns of potential XSS in an application. Instead of scrutinizing code for exploitable vulnerabilities, the recommendations in this cheat sheet pave a safe road for developers that mitigate the possibility of XSS in your code. By following these recommendations, you can be reasonably sure your code is free of XSS."})}function l(e={}){const{wrapper:i}={...(0,r.R)(),...e.components};return i?(0,n.jsx)(i,{...e,children:(0,n.jsx)(a,{...e})}):a(e)}}}]);