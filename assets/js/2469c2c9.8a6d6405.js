"use strict";(self.webpackChunkmegadocs=self.webpackChunkmegadocs||[]).push([[80177],{28453:(e,n,i)=>{i.d(n,{R:()=>a,x:()=>l});var s=i(96540);const t={},r=s.createContext(t);function a(e){const n=s.useContext(r);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:a(e.components),s.createElement(r.Provider,{value:n},e.children)}},54520:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>p,contentTitle:()=>l,default:()=>c,frontMatter:()=>a,metadata:()=>s,toc:()=>o});const s=JSON.parse('{"id":"kb/semgrep-ci/azure-using-templates-with-semgrep","title":"Running Semgrep using templates in Azure Pipelines","description":"Running Semgrep commands in Azure Pipelines templates.","source":"@site/docs/kb/semgrep-ci/azure-using-templates-with-semgrep.md","sourceDirName":"kb/semgrep-ci","slug":"/kb/semgrep-ci/azure-using-templates-with-semgrep","permalink":"/semgrep-docs/kb/semgrep-ci/azure-using-templates-with-semgrep","draft":false,"unlisted":false,"editUrl":"https://github.com/kyle-semgrep/semgrep-docs/edit/main/docs/kb/semgrep-ci/azure-using-templates-with-semgrep.md","tags":[{"inline":true,"label":"Azure Pipelines","permalink":"/semgrep-docs/tags/azure-pipelines"},{"inline":true,"label":"Templates","permalink":"/semgrep-docs/tags/templates"}],"version":"current","lastUpdatedAt":1752260268000,"frontMatter":{"tags":["Azure Pipelines","Templates"],"description":"Running Semgrep commands in Azure Pipelines templates."},"sidebar":"kbSidebar","previous":{"title":"Semgrep with self-hosted Ubuntu runners in Azure Pipelines","permalink":"/semgrep-docs/kb/semgrep-ci/azure-self-hosted-ubuntu"},"next":{"title":"Set up Jenkins Freestyle projects for Bitbucket repositories","permalink":"/semgrep-docs/kb/semgrep-ci/bitbucket-jenkins-freestyle-projects"}}');var t=i(74848),r=i(28453);const a={tags:["Azure Pipelines","Templates"],description:"Running Semgrep commands in Azure Pipelines templates."},l="Running Semgrep using templates in Azure Pipelines",p={},o=[{value:"Motivation",id:"motivation",level:2},{value:"Defining Semgrep commands in a template file",id:"defining-semgrep-commands-in-a-template-file",level:2},{value:"Referencing templates in an Azure Pipeline",id:"referencing-templates-in-an-azure-pipeline",level:2},{value:"Conclusion",id:"conclusion",level:2}];function m(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,r.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"running-semgrep-using-templates-in-azure-pipelines",children:"Running Semgrep using templates in Azure Pipelines"})}),"\n",(0,t.jsx)(n.h2,{id:"motivation",children:"Motivation"}),"\n",(0,t.jsxs)(n.p,{children:["Complex CI configurations housed in large YAML files take a lot of work to maintain and modify. Azure ",(0,t.jsx)(n.a,{href:"https://learn.microsoft.com/en-us/azure/devops/pipelines/process/templates?view=azure-devops",children:"templates"})," extract chunks of logic from larger configurations and encapsulate them in external template files. The template can then be referenced in multiple configurations, keeping pipelines more readable and maintainable."]}),"\n",(0,t.jsx)(n.p,{children:"This guide explains how to:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Create template files to run various Semgrep commands."}),"\n",(0,t.jsx)(n.li,{children:"Include or call templates in your Azure Pipeline."}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"You can then reuse the template files in as many pipelines as you need."}),"\n",(0,t.jsx)(n.h2,{id:"defining-semgrep-commands-in-a-template-file",children:"Defining Semgrep commands in a template file"}),"\n",(0,t.jsx)(n.p,{children:"To add Semgrep commands in a YAML template file:"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["Create a ",(0,t.jsx)(n.code,{children:"templates"})," folder in the repository you want to run Semgrep in."]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"Commit the following templates:"}),"\n",(0,t.jsx)(n.p,{children:"Example YAML template file for a Semgrep full scan:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:'steps:\n- script: |\n    echo "Semgrep full scan"\n    python -m pip install --upgrade pip\n    pip install semgrep\n    semgrep ci\n'})}),"\n",(0,t.jsx)(n.p,{children:"Example YAML template file for a Semgrep pull request scan:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:"steps:\n- checkout: self\n  clean: true\n  fetchDepth: 10000\n  persistCredentials: true\n- script: |\n    echo \"Pull Request Scan from branch: $(Build.SourceBranchName)\"\n    git fetch origin master:origin/master\n    python -m pip install --upgrade pip\n    pip install semgrep\n    semgrep ci\n  env:\n   SEMGREP_PR_ID: $(System.PullRequest.PullRequestNumber)\n   SEMGREP_BASELINE_REF: 'origin/master'\n"})}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.admonition,{type:"note",children:(0,t.jsxs)(n.p,{children:["You must define separate templates for full scans and ",(0,t.jsx)(n.a,{href:"/deployment/customize-ci-jobs#set-up-diff-aware-scans",children:"diff-aware scans"}),". This is because there are different environment variables used in the template for diff-aware scans, such as ",(0,t.jsx)(n.code,{children:"SEMGREP_PR_ID"})," and ",(0,t.jsx)(n.code,{children:"SEMGREP_BASELINE_REF"}),"."]})}),"\n",(0,t.jsx)(n.h2,{id:"referencing-templates-in-an-azure-pipeline",children:"Referencing templates in an Azure Pipeline"}),"\n",(0,t.jsx)(n.p,{children:"With the templates defined, reference them in other Azure Pipelines like this:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"pool:\n  vmImage: ubuntu-latest\n\nvariables:\n- group: Semgrep_Variables\n\njobs:\n- job: Semgrep_Full_Scan\n  condition: eq(variables['Build.SourceBranchName'], 'master')\n  steps:\n  - template: templates/full_scan_semgrep.yml\n\n- job: Semgrep_PR_Scan\n  condition: ne(variables['Build.SourceBranchName'], 'master')\n  steps:\n  - template: templates/pr_scan_semgrep.yml\n"})}),"\n",(0,t.jsx)(n.admonition,{type:"tip",children:(0,t.jsxs)(n.p,{children:["You can even define your templates in a centralized repository and ",(0,t.jsx)(n.a,{href:"https://learn.microsoft.com/en-us/azure/devops/pipelines/process/templates?view=azure-devops#use-other-repositories",children:"reference them in other repositories"}),"."]})}),"\n",(0,t.jsx)(n.h2,{id:"conclusion",children:"Conclusion"}),"\n",(0,t.jsx)(n.p,{children:"Using templates in Azure Pipelines is a good practice to simplify pipeline configuration files, improving both readability and maintainability. Pipeline templates can also speed up the Semgrep onboarding process for repositories by allowing you to reuse the same template in each repository."})]})}function c(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(m,{...e})}):m(e)}}}]);