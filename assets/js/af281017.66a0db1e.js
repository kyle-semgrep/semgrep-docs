"use strict";(self.webpackChunkmegadocs=self.webpackChunkmegadocs||[]).push([[87387],{28453:(e,t,n)=>{n.d(t,{R:()=>i,x:()=>a});var r=n(96540);const s={},o=r.createContext(s);function i(e){const t=r.useContext(o);return r.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function a(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:i(e.components),r.createElement(o.Provider,{value:t},e.children)}},32736:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>a,default:()=>c,frontMatter:()=>i,metadata:()=>r,toc:()=>d});const r=JSON.parse('{"id":"troubleshooting/rules","title":"Troubleshooting rules","description":"Follow these troubleshooting steps when your pattern fails to parse, your rule doesn\'t match its intended code, and other rule writing pitfalls.","source":"@site/docs/troubleshooting/rules.md","sourceDirName":"troubleshooting","slug":"/troubleshooting/rules","permalink":"/semgrep-docs/troubleshooting/rules","draft":false,"unlisted":false,"editUrl":"https://github.com/kyle-semgrep/semgrep-docs/edit/main/docs/troubleshooting/rules.md","tags":[{"inline":true,"label":"Troubleshooting","permalink":"/semgrep-docs/tags/troubleshooting"},{"inline":true,"label":"Rule writing","permalink":"/semgrep-docs/tags/rule-writing"}],"version":"current","lastUpdatedAt":1752504841000,"frontMatter":{"slug":"rules","tags":["Troubleshooting","Rule writing"],"description":"Follow these troubleshooting steps when your pattern fails to parse, your rule doesn\'t match its intended code, and other rule writing pitfalls."},"sidebar":"rulewritingSidebar","previous":{"title":"Metavariable analysis","permalink":"/semgrep-docs/writing-rules/metavariable-analysis"},"next":{"title":"Introduction","permalink":"/semgrep-docs/writing-rules/experiments/introduction"}}');var s=n(74848),o=n(28453);const i={slug:"rules",tags:["Troubleshooting","Rule writing"],description:"Follow these troubleshooting steps when your pattern fails to parse, your rule doesn't match its intended code, and other rule writing pitfalls."},a="Troubleshooting rules",l={},d=[{value:"If your pattern can\u2019t be parsed",id:"if-your-pattern-cant-be-parsed",level:2},{value:"If your rule doesn&#39;t match where it should",id:"if-your-rule-doesnt-match-where-it-should",level:2},{value:"If your pattern doesn&#39;t match where it should",id:"if-your-pattern-doesnt-match-where-it-should",level:2},{value:"If a regex pattern doesn&#39;t match where it should",id:"if-a-regex-pattern-doesnt-match-where-it-should",level:2}];function h(e){const t={a:"a",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,o.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(t.header,{children:(0,s.jsx)(t.h1,{id:"troubleshooting-rules",children:"Troubleshooting rules"})}),"\n",(0,s.jsxs)(t.p,{children:["This page intends to help rule authors fix common mistakes when writing Semgrep rules. If you have a problem while running a rule you didn't write yourself, please ",(0,s.jsx)(t.a,{href:"https://github.com/semgrep/semgrep-rules/issues/new/choose",children:"open a GitHub issue in the Semgrep Registry"})," repository."]}),"\n",(0,s.jsx)(t.h2,{id:"if-your-pattern-cant-be-parsed",children:"If your pattern can\u2019t be parsed"}),"\n",(0,s.jsx)(t.p,{children:"This error means your pattern does not look like complete source code in the selected language."}),"\n",(0,s.jsx)(t.p,{children:'"Complete source code" means that the Semgrep pattern must look like a valid, complete expression or statement on its own.'}),"\n",(0,s.jsxs)(t.p,{children:["To illustrate with an example, Python isn't able to parse ",(0,s.jsx)(t.code,{children:"if 4 < 5"})," as a line of code, because it's missing the code block on the right hand side."]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-python",children:'>>> if 4 < 5\n  File "<stdin>", line 1\n    if 4 < 5\n            ^\nSyntaxError: invalid syntax\n>>>\n'})}),"\n",(0,s.jsx)(t.p,{children:"To get Python to parse this, you need to add a colon and a code block:"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-python",children:'>>> if 4 < 5: print("it works!")\n...\nit works!\n>>>\n'})}),"\n",(0,s.jsx)(t.p,{children:"The same way Python's parser cannot parse partial statements or expressions, Semgrep cannot either."}),"\n",(0,s.jsxs)(t.p,{children:["The Semgrep pattern ",(0,s.jsx)(t.code,{children:"if $X < 5"})," is invalid, and needs to be changed to a complete statement with a wildcard: ",(0,s.jsx)(t.code,{children:"if $X < 5: ..."})]}),"\n",(0,s.jsx)(t.p,{children:"While the most common reason for pattern parse errors is the above, other things to check would be:"}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsx)(t.li,{children:"Make sure the correct language is selected"}),"\n",(0,s.jsxs)(t.li,{children:["If your pattern uses a metavariable, make sure it's all uppercase and does not start with a number. Valid metavariable names include ",(0,s.jsx)(t.code,{children:"$X"}),", ",(0,s.jsx)(t.code,{children:"$NAME"}),", and ",(0,s.jsx)(t.code,{children:"$_VAR_2"}),". Invalid metavariable names include ",(0,s.jsx)(t.code,{children:"$name"}),", ",(0,s.jsx)(t.code,{children:"$1stvar"})," and ",(0,s.jsx)(t.code,{children:"$VAR-WITH-DASHES"}),"."]}),"\n"]}),"\n",(0,s.jsx)(t.h2,{id:"if-your-rule-doesnt-match-where-it-should",children:"If your rule doesn't match where it should"}),"\n",(0,s.jsxs)(t.p,{children:["In general, it helps to test the patterns within your rule in isolation. If you scan for the patterns one by one and they each find what you expect, the issue is with the Boolean logic within your rule. Review the ",(0,s.jsx)(t.a,{href:"/writing-rules/rule-syntax",children:"rule syntax"})," to make sure the operators are meant to behave like you expect. If you managed to find a pattern that behaves incorrectly, continue debugging with the section below."]}),"\n",(0,s.jsx)(t.h2,{id:"if-your-pattern-doesnt-match-where-it-should",children:"If your pattern doesn't match where it should"}),"\n",(0,s.jsx)(t.p,{children:"If you isolated the issue to one specific pattern, here are some common issues to look out for:"}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsxs)(t.li,{children:["When referencing something imported from a module, you need to fully qualify the import path. To match ",(0,s.jsx)(t.code,{children:"import google.metrics; metrics.send(foo)"})," in Python, your pattern needs to be ",(0,s.jsx)(t.code,{children:"google.metrics.send(...)"})," instead of ",(0,s.jsx)(t.code,{children:"metrics.send(...)"}),"."]}),"\n",(0,s.jsxs)(t.li,{children:["If your pattern uses a metavariable, make sure it's all uppercase and does not start with a number. Valid metavariable names include ",(0,s.jsx)(t.code,{children:"$X"}),", ",(0,s.jsx)(t.code,{children:"$NAME"}),", and ",(0,s.jsx)(t.code,{children:"$_VAR_2"}),". Invalid metavariable names include ",(0,s.jsx)(t.code,{children:"$name"}),", ",(0,s.jsx)(t.code,{children:"$1stvar"})," and ",(0,s.jsx)(t.code,{children:"$VAR-WITH-DASHES"}),"."]}),"\n"]}),"\n",(0,s.jsx)(t.h2,{id:"if-a-regex-pattern-doesnt-match-where-it-should",children:"If a regex pattern doesn't match where it should"}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsxs)(t.li,{children:["When using ",(0,s.jsx)(t.code,{children:"metavariable-regex"}),", the regex will match against all characters of the found metavariable. This means that if the metavariable matches a ",(0,s.jsx)(t.code,{children:'"foo"'})," string in your code, the ",(0,s.jsx)(t.code,{children:"metavariable-regex"})," pattern will run against a five character string with the quote characters at either end."]}),"\n",(0,s.jsxs)(t.li,{children:["Note that using the pipe (",(0,s.jsx)(t.code,{children:"|"}),") character will append a newline to your regex! If you are writing ",(0,s.jsx)(t.code,{children:"pattern-regex: |"})," and then a newline with the regex, you almost certainly want the ",(0,s.jsx)(t.code,{children:"|-"})," operator as in ",(0,s.jsx)(t.code,{children:"pattern-regex: |-"})," to remove that trailing newline."]}),"\n"]})]})}function c(e={}){const{wrapper:t}={...(0,o.R)(),...e.components};return t?(0,s.jsx)(t,{...e,children:(0,s.jsx)(h,{...e})}):h(e)}}}]);