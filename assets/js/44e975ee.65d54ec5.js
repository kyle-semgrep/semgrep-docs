"use strict";(self.webpackChunkmegadocs=self.webpackChunkmegadocs||[]).push([[2607],{28453:(e,n,r)=>{r.d(n,{R:()=>o,x:()=>l});var s=r(96540);const i={},t=s.createContext(i);function o(e){const n=s.useContext(t);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:o(e.components),s.createElement(t.Provider,{value:n},e.children)}},81353:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>d,contentTitle:()=>a,default:()=>h,frontMatter:()=>l,metadata:()=>s,toc:()=>c});const s=JSON.parse('{"id":"deployment/add-semgrep-other-ci","title":"Add Semgrep to other CI providers","description":"Set up your CI pipeline manually with Semgrep AppSec Platform for centralized rule and findings management.","source":"@site/docs/deployment/add-semgrep-other-ci.md","sourceDirName":"deployment","slug":"/deployment/add-semgrep-to-other-ci-providers","permalink":"/semgrep-docs/deployment/add-semgrep-to-other-ci-providers","draft":false,"unlisted":false,"editUrl":"https://github.com/kyle-semgrep/semgrep-docs/edit/main/docs/deployment/add-semgrep-other-ci.md","tags":[{"inline":true,"label":"Deployment","permalink":"/semgrep-docs/tags/deployment"},{"inline":true,"label":"Semgrep AppSec Platform","permalink":"/semgrep-docs/tags/semgrep-app-sec-platform"}],"version":"current","lastUpdatedAt":1752260268000,"frontMatter":{"slug":"add-semgrep-to-other-ci-providers","title":"Add Semgrep to other CI providers","hide_title":true,"description":"Set up your CI pipeline manually with Semgrep AppSec Platform for centralized rule and findings management.","tags":["Deployment","Semgrep AppSec Platform"]},"sidebar":"scanSidebar","previous":{"title":"Add Semgrep to CI/CD","permalink":"/semgrep-docs/deployment/add-semgrep-to-ci"},"next":{"title":"Customize CI jobs","permalink":"/semgrep-docs/deployment/customize-ci-jobs"}}');var i=r(74848),t=r(28453),o=r(91224);const l={slug:"add-semgrep-to-other-ci-providers",title:"Add Semgrep to other CI providers",hide_title:!0,description:"Set up your CI pipeline manually with Semgrep AppSec Platform for centralized rule and findings management.",tags:["Deployment","Semgrep AppSec Platform"]},a="Add Semgrep manually to CI providers",d={},c=[{value:"General steps",id:"general-steps",level:2},{value:"Create a SEMGREP_APP_TOKEN",id:"create-a-semgrep_app_token",level:3},{value:"Create a Semgrep CI job",id:"create-a-semgrep-ci-job",level:3},{value:"Run the job",id:"run-the-job",level:3},{value:"Verify the connection",id:"verify-the-connection",level:3},{value:"Troubleshoot your CI job",id:"troubleshoot-your-ci-job",level:3},{value:"Data collected by Semgrep AppSec Platform",id:"data-collected-by-semgrep-appsec-platform",level:2},{value:"Next steps",id:"next-steps",level:2},...o.RM];function p(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...e.components},{Details:r}=n;return r||function(e,n){throw new Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Details",!0),(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"add-semgrep-manually-to-ci-providers",children:"Add Semgrep manually to CI providers"})}),"\n",(0,i.jsx)(n.admonition,{title:"Your deployment journey",type:"note",children:(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["You have gained the necessary ",(0,i.jsx)(n.a,{href:"/deployment/checklist",children:"resource access and permissions"})," required for deployment."]}),"\n",(0,i.jsxs)(n.li,{children:["You have ",(0,i.jsx)(n.a,{href:"/deployment/create-account-and-orgs",children:"created a Semgrep account and organization"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:["For GitHub and GitLab users: You have ",(0,i.jsx)(n.a,{href:"/deployment/connect-scm",children:"connected your source code manager"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:["Optionally, you have ",(0,i.jsx)(n.a,{href:"/deployment/sso",children:"set up SSO"}),"."]}),"\n"]})}),"\n",(0,i.jsx)(n.p,{children:"This guide walks you through creating a Semgrep job for CI providers for which Semgrep AppSec Platform has no explicit guidance. Without explicit guidance, you must manually make a CI configuration file yourself."}),"\n",(0,i.jsxs)(n.p,{children:["Check ",(0,i.jsxs)(n.a,{href:"/deployment/add-semgrep-to-ci/#guided-setup-for-ci-providers-in-semgrep-appsec-platform",children:[(0,i.jsx)("i",{class:"fa-regular fa-file-lines"})," Add Semgrep to CI"]})," first to ensure that this guide applies to your CI provider."]}),"\n",(0,i.jsx)(n.p,{children:"Skip this guide if you have already configured a CI job."}),"\n",(0,i.jsx)(n.p,{children:"The steps provided here are known to work with the following CI providers:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"AppVeyor"}),"\n",(0,i.jsx)(n.li,{children:"Bamboo"}),"\n",(0,i.jsx)(n.li,{children:"Bitrise"}),"\n",(0,i.jsx)(n.li,{children:"Buildbot"}),"\n",(0,i.jsx)(n.li,{children:"Codeship"}),"\n",(0,i.jsx)(n.li,{children:"Codefresh"}),"\n",(0,i.jsx)(n.li,{children:"Drone CI"}),"\n",(0,i.jsx)(n.li,{children:"Nomad"}),"\n",(0,i.jsx)(n.li,{children:"TeamCity CI"}),"\n",(0,i.jsx)(n.li,{children:"Travis CI"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"general-steps",children:"General steps"}),"\n",(0,i.jsx)(n.p,{children:"The following steps provide an overview of the process. View the succeeding sections for detailed instructions."}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["Create a ",(0,i.jsx)(n.code,{children:"SEMGREP_APP_TOKEN"}),"."]}),"\n",(0,i.jsx)(n.li,{children:"Add this token as a credential, secret, or token into your CI provider."}),"\n",(0,i.jsx)(n.li,{children:"Create a CI job that runs Semgrep; this step is typically achieved by committing a CI configuration file. The syntax of the configuration file depends on your CI provider.."}),"\n",(0,i.jsx)(n.li,{children:"The CI job can automatically start to run depending on your configuration. If the job does not start, run the job through the CI provider's interface or by committing code."}),"\n",(0,i.jsxs)(n.li,{children:["Semgrep detects the ",(0,i.jsx)(n.code,{children:"SEMGREP_APP_TOKEN"}),", sends it to Semgrep AppSec Platform for verification, and if verified, findings are sent to Semgrep AppSec Platform."]}),"\n",(0,i.jsx)(n.li,{children:"Define additional environment variables to enable other Semgrep AppSec Platform features. This is done last because it is easier to troubleshoot modifications to jobs after ensuring that the base CI job runs correctly."}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"The next sections go over these steps in detail."}),"\n",(0,i.jsx)(n.h3,{id:"create-a-semgrep_app_token",children:"Create a SEMGREP_APP_TOKEN"}),"\n",(0,i.jsxs)(n.p,{children:["To create a ",(0,i.jsx)(n.code,{children:"SEMGREP_APP_TOKEN"}),", follow these steps:"]}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["Sign in to ",(0,i.jsxs)(n.a,{href:"https://semgrep.dev/login",children:[(0,i.jsx)("i",{class:"fas fa-external-link fa-xs"})," Semgrep AppSec Platform"]}),"."]}),"\n",(0,i.jsxs)(n.li,{children:["Click ",(0,i.jsx)(n.strong,{children:(0,i.jsxs)(n.a,{href:"https://semgrep.dev/orgs/-/settings/tokens",children:[(0,i.jsx)("i",{class:"fa-solid fa-gear"})," Settings"]})})," > ",(0,i.jsx)(n.strong,{children:"Tokens"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:["Click ",(0,i.jsx)(n.strong,{children:"Create new token"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:["Copy the name and value, then click ",(0,i.jsx)(n.strong,{children:"Save"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:["Store the token value into your CI provider. Tokens can also be referred to as ",(0,i.jsx)(n.code,{children:"secrets"}),", ",(0,i.jsx)(n.code,{children:"credentials"}),", or ",(0,i.jsx)(n.code,{children:"secure variables"}),". The steps to do this vary depending on your CI provider."]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"create-a-semgrep-ci-job",children:"Create a Semgrep CI job"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["Add Semgrep to your CI pipeline. Do either of the following:","\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["Reference or add the ",(0,i.jsx)(n.a,{href:"https://hub.docker.com/r/semgrep/semgrep",children:"Semgrep Docker image"}),". This is the recommended method."]}),"\n",(0,i.jsxs)(n.li,{children:["Add ",(0,i.jsx)(n.code,{children:"pip install semgrep"})," into your configuration file as a step or command, depending on your CI provider's syntax.","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["If you see an error during the installation process due to your Python environment being externally managed by a package manager, see ",(0,i.jsx)(n.a,{href:"/kb/semgrep-appsec-platform/error-externally-managed-environment",children:"Semgrep's article for instructions on how to proceed"}),"."]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["Add ",(0,i.jsx)(n.code,{children:"semgrep ci"})," as a step or command."]}),"\n",(0,i.jsxs)(n.li,{children:["Set the ",(0,i.jsx)(n.code,{children:"SEMGREP_APP_TOKEN"})," environment variable within your configuration file."]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["The following example is a ",(0,i.jsx)(n.code,{children:"bitbucket-pipelines.yml"})," file that adds Semgrep through the Docker image:"]}),"\n",(0,i.jsxs)(r,{children:[(0,i.jsx)("summary",{children:"Add Semgrep through the Docker image."}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"image: atlassian/default-image:latest\n\npipelines:\n  default:\n    - parallel:\n      - step:\n        name: 'Run Semgrep scan with current branch'\n        deployment: dev\n        # Reference the Semgrep Docker image:\n        image: semgrep/semgrep\n        script:\n        # You need to set the token as an environment variable\n        # (see Create a `SEMGREP_APP_TOKEN` section).\n          - export $SEMGREP_APP_TOKEN\n          # Run semgrep ci:\n          - semgrep ci\n"})})]}),"\n",(0,i.jsxs)(n.p,{children:["The next example is a ",(0,i.jsx)(n.code,{children:"Jenkinsfile"})," configuration that adds Semgrep by installing it:"]}),"\n",(0,i.jsxs)(r,{children:[(0,i.jsx)("summary",{children:"Add Semgrep by installing it."}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-javascript",children:"pipeline {\n  agent any\n  stages {\n    stage('Semgrep-Scan') {\n        environment {\n          // You need to set the token as an environment variable\n          // (see Create a `SEMGREP_APP_TOKEN` section).\n          SEMGREP_APP_TOKEN = credentials('SEMGREP_APP_TOKEN')\n        }\n      steps {\n        // Install and run Semgrep:\n        sh 'pip3 install semgrep'\n        sh 'semgrep ci'\n      }\n    }\n  }\n}\n"})})]}),"\n",(0,i.jsx)(n.h3,{id:"run-the-job",children:"Run the job"}),"\n",(0,i.jsx)(n.p,{children:"Depending on your CI provider and configuration, the job runs automatically. Otherwise, trigger the job by committing code or opening a PR or MR."}),"\n",(0,i.jsx)(n.h3,{id:"verify-the-connection",children:"Verify the connection"}),"\n",(0,i.jsx)(n.p,{children:"To verify that your Semgrep CI job is connected to Semgrep AppSec Platform:"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["Go to your Semgrep AppSec Platform ",(0,i.jsx)(n.a,{href:"https://semgrep.dev/orgs/-/projects",children:"Projects page"}),"."]}),"\n",(0,i.jsx)(n.li,{children:"Verify that your repository is listed on the Projects page and that Semgrep AppSec Platform is running a scan."}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"troubleshoot-your-ci-job",children:"Troubleshoot your CI job"}),"\n",(0,i.jsx)(n.p,{children:"Semgrep attempts to automatically detect certain CI values, such as your repository's name and URL. These values are used to provide context to findings in Semgrep AppSec Platform and hyperlinks to the code that generated the finding."}),"\n",(0,i.jsx)(n.p,{children:"Refer to the following table for common issues and the corresponding environment variables you can set to fix them:"}),"\n",(0,i.jsxs)("table",{children:[(0,i.jsx)("thead",{children:(0,i.jsxs)("tr",{children:[(0,i.jsx)("th",{children:"Issue"}),(0,i.jsx)("th",{children:"Environment variable to set"}),(0,i.jsx)("th",{children:"Affected CI providers"})]})}),(0,i.jsxs)("tbody",{children:[(0,i.jsxs)("tr",{children:[(0,i.jsx)("td",{children:"Can't establish a connection to Semgrep AppSec Platform."}),(0,i.jsx)("td",{children:(0,i.jsx)("code",{children:"SEMGREP_APP_TOKEN"})}),(0,i.jsx)("td",{children:"Must be set for all CI providers."})]}),(0,i.jsxs)("tr",{children:[(0,i.jsx)("td",{children:"Semgrep doesn't scan your PRs or MRs."}),(0,i.jsx)("td",{children:(0,i.jsx)("code",{children:"SEMGREP_BASELINE_REF"})}),(0,i.jsxs)("td",{children:["Required for CI providers ",(0,i.jsx)("strong",{children:"except"})," GitHub Actions or GitLab CI/CD."]})]}),(0,i.jsx)("td",{rowspan:"6",children:"Can't click hyperlinks to your repository from Semgrep AppSec Platform, nor can Semgrep AppSec Platform create PR or MR comments."}),(0,i.jsx)("td",{children:(0,i.jsx)("code",{children:"SEMGREP_REPO_NAME"})}),(0,i.jsxs)("td",{rowspan:"5",children:["Set these environment variables as needed to troubleshoot broken links for any CI provider ",(0,i.jsx)("strong",{children:"except"})," GitHub Actions and GitLab CI/CD."]}),(0,i.jsx)("tr",{children:(0,i.jsx)("td",{children:(0,i.jsx)("code",{children:"SEMGREP_REPO_URL"})})}),(0,i.jsx)("tr",{children:(0,i.jsx)("td",{children:(0,i.jsx)("code",{children:"SEMGREP_BRANCH"})})}),(0,i.jsx)("tr",{children:(0,i.jsx)("td",{children:(0,i.jsx)("code",{children:"SEMGREP_JOB_URL"})})}),(0,i.jsx)("tr",{children:(0,i.jsx)("td",{children:(0,i.jsx)("code",{children:"SEMGREP_COMMIT"})})}),(0,i.jsxs)("tr",{children:[(0,i.jsx)("td",{children:(0,i.jsx)("code",{children:"SEMGREP_PR_ID"})}),(0,i.jsxs)("td",{children:["Required to enable hyperlinks for ",(0,i.jsx)("strong",{children:"Azure Pipelines"}),"."]})]})]})]}),"\n",(0,i.jsx)(n.h2,{id:"data-collected-by-semgrep-appsec-platform",children:"Data collected by Semgrep AppSec Platform"}),"\n",(0,i.jsx)(n.p,{children:"When running in CI, Semgrep runs fully in the CI build environment. Unless you have explicitly granted code access to Semgrep, your code is not sent anywhere."}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Semgrep AppSec Platform collects ",(0,i.jsx)(n.a,{href:"/semgrep-ci/findings-ci",children:"findings data"}),", which includes the line number of the code match, but not the code. It is hashed using a one-way hashing function."]}),"\n",(0,i.jsx)(n.li,{children:"Findings data is used to generate line-specific hyperlinks to your source code management system and support other Semgrep functions."}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"next-steps",children:"Next steps"}),"\n",(0,i.jsx)(o.Ay,{opening_phrase:"Set up diff-aware scanning for"})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(p,{...e})}):p(e)}},91224:(e,n,r)=>{r.d(n,{Ay:()=>l,RM:()=>t});var s=r(74848),i=r(28453);const t=[];function o(e){const n={a:"a",li:"li",p:"p",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.p,{children:"You've set up Semgrep to scan in your repository and send findings after each scan. Your core deployment is almost complete."}),"\n",(0,s.jsx)(n.p,{children:"Remaining steps include:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Optional: ",(0,s.jsxs)(n.a,{href:"/deployment/customize-ci-jobs",children:[(0,s.jsx)("i",{class:"fa-regular fa-file-lines"})," Customize your CI job"]}),"."]}),"\n",(0,s.jsxs)(n.li,{children:["For software composition analysis (SCA) scans using ",(0,s.jsx)(n.strong,{children:"Jenkins or Maven"}),": ",(0,s.jsxs)(n.a,{href:"/semgrep-supply-chain/setup-infrastructure",children:[(0,s.jsx)("i",{class:"fa-regular fa-file-lines"})," Set up SCA scans for your infrastructure."]})]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)("span",{children:e.opening_phrase})," ",(0,s.jsx)("strong",{children:"feature branches"})," (non-trunk branches) when a pull request or merge request is open. This is a prerequisite to receiving PR or MR comments. See ",(0,s.jsx)("a",{href:"/docs/deployment/customize-ci-jobs#set-up-diff-aware-scans",children:"Set up diff-aware scans"}),"."]}),"\n",(0,s.jsxs)(n.li,{children:["Set up ",(0,s.jsx)(n.strong,{children:"PR or MR comments"}),", which post findings to developers in your SCM. This involves developers in the security process as active participants. See ",(0,s.jsxs)(n.a,{href:"/category/pr-or-mr-comments",children:[(0,s.jsx)("i",{class:"fa-regular fa-file-lines"})," PR or MR comments"]})," for next steps."]}),"\n"]})]})}function l(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(o,{...e})}):o(e)}}}]);