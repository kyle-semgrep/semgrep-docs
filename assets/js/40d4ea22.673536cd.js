"use strict";(self.webpackChunkmegadocs=self.webpackChunkmegadocs||[]).push([[40781],{28453:(e,n,t)=>{t.d(n,{R:()=>r,x:()=>c});var o=t(96540);const i={},s=o.createContext(i);function r(e){const n=o.useContext(s);return o.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:r(e.components),o.createElement(s.Provider,{value:n},e.children)}},62160:(e,n,t)=>{t.d(n,{A:()=>o});const o=t.p+"assets/images/integration-defectdojo-example-eea7e6a0d90b83d3924f1420a61943e1.png"},80208:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>a,contentTitle:()=>c,default:()=>p,frontMatter:()=>r,metadata:()=>o,toc:()=>d});const o=JSON.parse('{"id":"kb/integrations/defect-dojo-integration","title":"How to connect Semgrep and DefectDojo","description":"How to connect Semgrep and DefectDojo","source":"@site/docs/kb/integrations/defect-dojo-integration.md","sourceDirName":"kb/integrations","slug":"/kb/integrations/defect-dojo-integration","permalink":"/docs/kb/integrations/defect-dojo-integration","draft":false,"unlisted":false,"editUrl":"https://github.com/kyle-semgrep/semgrep-docs/edit/main?base=kyle-semgrep:main/docs/kb/integrations/defect-dojo-integration.md","tags":[{"inline":true,"label":"DefectDojo","permalink":"/docs/tags/defect-dojo"},{"inline":true,"label":"Integrations","permalink":"/docs/tags/integrations"}],"version":"current","lastUpdatedAt":1752253235000,"frontMatter":{"tags":["DefectDojo","Integrations"],"description":"How to connect Semgrep and DefectDojo"},"sidebar":"kbSidebar","previous":{"title":"Customize Semgrep in pre-commit","permalink":"/docs/kb/integrations/customize-semgrep-precommit"},"next":{"title":"How to paginate responses from the Semgrep API","permalink":"/docs/kb/integrations/pagination"}}');var i=t(74848),s=t(28453);const r={tags:["DefectDojo","Integrations"],description:"How to connect Semgrep and DefectDojo"},c="How to connect Semgrep and DefectDojo",a={},d=[{value:"Integration",id:"integration",level:2},{value:"DefectDojo API example",id:"defectdojo-api-example",level:3},{value:"Running the script",id:"running-the-script",level:3},{value:"Integrating Semgrep and DefectDojo in a CI pipeline",id:"integrating-semgrep-and-defectdojo-in-a-ci-pipeline",level:2},{value:"Conclusions",id:"conclusions",level:2}];function l(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"how-to-connect-semgrep-and-defectdojo",children:"How to connect Semgrep and DefectDojo"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.a,{href:"https://www.defectdojo.com/",children:"DefectDojo"})," is a well-known vulnerability management tool. It allows you to gather security issues from other tools, including Semgrep. By integrating Semgrep findings into DefectDojo, security teams can more easily monitor their overall security posture."]}),"\n",(0,i.jsx)(n.h2,{id:"integration",children:"Integration"}),"\n",(0,i.jsx)(n.p,{children:"Follow these steps to prepare DefectDojo and generate Semgrep findings in the proper format:"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["In DefectDojo:","\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["Create your ",(0,i.jsx)(n.a,{href:"https://defectdojo.github.io/django-DefectDojo/usage/models/#products",children:(0,i.jsx)(n.strong,{children:"product"})}),"."]}),"\n",(0,i.jsxs)(n.li,{children:["In that DefectDojo product, create an ",(0,i.jsx)(n.a,{href:"https://defectdojo.github.io/django-DefectDojo/usage/models/#engagement",children:"engagement"}),", called ",(0,i.jsx)(n.code,{children:"semgrep"}),". This is a CI/CD engagement type and the name designates the CI/CD tool used."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["Run semgrep as ",(0,i.jsx)(n.code,{children:"semgrep ... --json > report.json"})," to generate a JSON report."]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["Now, you are ready to use the ",(0,i.jsx)(n.a,{href:"https://demo.defectdojo.org/api/v2/oa3/swagger-ui/",children:"DefectDojo API"}),"."]}),"\n",(0,i.jsx)(n.h3,{id:"defectdojo-api-example",children:"DefectDojo API example"}),"\n",(0,i.jsxs)(n.p,{children:["To run API DefectDojo operations such as GET, POST, and DELETE, an API token is necessary. To get it, follow the ",(0,i.jsx)(n.a,{href:"https://defectdojo.github.io/django-DefectDojo/integrations/api-v2-docs/",children:"API guide"}),"."]}),"\n",(0,i.jsxs)(n.p,{children:["Once you have a token, store it as an environment variable named ",(0,i.jsx)(n.code,{children:"DEFECT_DOJO_API_TOKEN"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"export DEFECT_DOJO_API_TOKEN=[YOUR_DEFECT_DOJO_TOKEN]\n"})}),"\n",(0,i.jsxs)(n.p,{children:["The DefectDojo API uses the ",(0,i.jsx)(n.code,{children:"/api/v2/import-scan/"})," endpoint for the first import and the ",(0,i.jsx)(n.code,{children:"/api/v2/reimport-scan"})," endpoint for following imports."]}),"\n",(0,i.jsx)(n.p,{children:"These endpoints take the following parameters:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"file"}),": The Semgrep scan findings report or export in JSON format."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"scan_type"}),': A descriptive name for the scan type. In this example, the scan type is "Semgrep JSON Report`".']}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"product_name"}),": The name of the product in DefectDojo to send the Semgrep findings report to."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"engagement_name"}),': The name of the engagement you created the preceding "Integration" section. In this example, ',(0,i.jsx)(n.code,{children:"semgrep"}),"."]}),"\n"]}),"\n",(0,i.jsx)(n.admonition,{type:"info",children:(0,i.jsxs)(n.p,{children:["The DefectDojo API allows identifying the parameters either by name or by ID. This example follows the ",(0,i.jsx)(n.strong,{children:"By name"})," approach."]})}),"\n",(0,i.jsx)(n.p,{children:"Here is an example snippet of a Python function using this endpoint:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"def uploadToDefectDojo(is_new_import, token, url, product_name, engagement_name, filename):\n    multipart_form_data = {\n        'file': (filename, open(filename, 'rb')),\n        'scan_type': (None, 'Semgrep JSON Report'),\n        'product_name': (None, product_name),\n        'engagement_name': (None, engagement_name),\n    }\n\n    endpoint = '/api/v2/import-scan/' if is_new_import else '/api/v2/reimport-scan/'\n    r = requests.post(\n        url + endpoint,\n        files=multipart_form_data,\n        headers={\n            'Authorization': 'Token ' + token,\n        }\n    )\n    if r.status_code != 200:\n        sys.exit(f'Post failed: {r.text}')\n    print(r.text)\n"})}),"\n",(0,i.jsxs)(n.p,{children:["The full version of this Python script can be found ",(0,i.jsx)(n.a,{href:"https://github.com/r2c-CSE/semgrep-utilities/blob/main/integrations/defectdojo/import_semgrep_to_defect_dojo.py",children:"here"}),". Feel free to use this in your own environment after reviewing the script to make sure it works for you."]}),"\n",(0,i.jsx)(n.h3,{id:"running-the-script",children:"Running the script"}),"\n",(0,i.jsx)(n.p,{children:"To continue with the preceding example and run the script, execute the following command:"}),"\n",(0,i.jsx)("pre",{class:"language-bash",children:(0,i.jsxs)("code",{children:["python3 integrations/defectdojo/import_semgrep_to_defect_dojo.py --host ",(0,i.jsx)("span",{className:"placeholder",children:"DOJO_URL"})," --product ",(0,i.jsx)("span",{className:"placeholder",children:"PRODUCT_NAME"})," --engagement ",(0,i.jsx)("span",{className:"placeholder",children:"ENGAGEMENT_NAME"})," --report ",(0,i.jsx)("span",{className:"placeholder",children:"REPORT_FILE"})]})}),"\n",(0,i.jsx)(n.p,{children:"Where:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"DOJO_URL"})," is the URL where DefectDojo is."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"PRODUCT_NAME"})," is the DefectDojo product name."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"ENGAGEMENT_NAME"})," is the DefectDojo engagement name for that product."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"REPORT_FILE"})," is the Semgrep report path."]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"integrating-semgrep-and-defectdojo-in-a-ci-pipeline",children:"Integrating Semgrep and DefectDojo in a CI pipeline"}),"\n",(0,i.jsxs)(n.p,{children:["To prevent tampering with findings, it is crucial to import scan results to DefectDojo in the ",(0,i.jsx)(n.strong,{children:"same pipeline or CI job"})," as the scan itself."]}),"\n",(0,i.jsx)(n.p,{children:"The following is an example of a GitLab job importing Semgrep findings to DefectDojo:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:'import-semgrep-to-defectdojo:\n  stage: import\n  image: python:3.9-bullseye\n  script:\n    - echo "Importing Semgrep scan to DefectDojo"\n    - pip3 install requests\n    - curl -O https://raw.githubusercontent.com/r2c-CSE/semgrep-utilities/main/integrations/defectdojo/import_semgrep_to_defect_dojo.py\n    # Adding checksum validation\n    - echo $IMPORT_SEMGREP_TO_DEFECTDOJO_SHA_CHECKSUM > sha-import-dd.tmp\n    - shasum -a 256 -U -c sha-import-dd.tmp\n    - python3 import_semgrep_to_defect_dojo.py --host $DEFECTDOJO_URL --product $PRODUCT --engagement semgrep --report report.json || true\n  rules:\n    # Scan changed files in MRs, (diff-aware scanning):\n    - if: $CI_MERGE_REQUEST_IID\n    # Scan mainline (default) branches and report all findings.\n    - if: $CI_COMMIT_BRANCH == $CI_DEFAULT_BRANCH\n  tags:\n    - defectdojo\n  variables:\n    DEFECT_DOJO_API_TOKEN: $DEFECT_DOJO_API_TOKEN\n'})}),"\n",(0,i.jsx)(n.admonition,{type:"tip",children:(0,i.jsx)(n.p,{children:"As a good security practice, this pipeline includes checksum validation for the import script, to ensure that the script has not been tampered with."})}),"\n",(0,i.jsxs)(n.p,{children:["There are some environment variables defined in the ",(0,i.jsx)(n.code,{children:"gitlab-ci.yml"})," file, such as:"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"DEFECTDOJO_URL"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"PRODUCT"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"IMPORT_SEMGREP_TO_DEFECTDOJO_SHA_CHECKSUM"})}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["They must be defined in the GitLab pipeline. Settings->CI/CD->Variables:\n",(0,i.jsx)(n.img,{alt:"image info",src:t(80525).A+"",width:"2246",height:"968"})]}),"\n",(0,i.jsx)(n.p,{children:"In the example, the values are:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"DEFECTDOJO_URL"})," = ",(0,i.jsx)(n.a,{href:"http://localhost:8080/",children:"http://localhost:8080/"})," (Local DefectDojo deployment)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"PRODUCT"})," = chess-game"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"IMPORT_SEMGREP_TO_DEFECTDOJO_SHA_CHECKSUM"})," = c41aed4055adeee415b795cc17a069b144fb51bc31f6c4925be3b82d0b54de33 Uimport_semgrep_to_defect_dojo.py"]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["The content for this last variable was generated with the following command:\n",(0,i.jsx)(n.code,{children:"shasum -a 256 -U import_semgrep_to_defect_dojo.py"}),"\nThis command generates a unique checksum, taking as input the content of the script, and it will be used to verify that the script has not changed."]}),"\n",(0,i.jsx)(n.p,{children:"In the pipeline, the integrity of the script is verified with the following commands:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"echo $IMPORT_SEMGREP_TO_DEFECTDOJO_SHA_CHECKSUM > sha-import-dd.tmp\nshasum -a 256 -U -c sha-import-dd.tmp\n"})}),"\n",(0,i.jsx)(n.p,{children:"If the script has not changed since the checksum was generated, the pipeline will continue normal execution. Otherwise it will stop and return an error."}),"\n",(0,i.jsxs)(n.p,{children:["Example DefectDojo screenshot, after a pipeline execution:\n",(0,i.jsx)(n.img,{alt:"image info",src:t(62160).A+"",width:"2960",height:"1432"})]}),"\n",(0,i.jsx)(n.h2,{id:"conclusions",children:"Conclusions"}),"\n",(0,i.jsxs)(n.p,{children:["If you use multiple vulnerability tools, including Semgrep, importing results to ",(0,i.jsx)(n.a,{href:"https://www.defectdojo.com/",children:"DefectDojo"})," can be helpful in managing data across all of these tools."]})]})}function p(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(l,{...e})}):l(e)}},80525:(e,n,t)=>{t.d(n,{A:()=>o});const o=t.p+"assets/images/integration-defectdojo-gitlab-variables-07e19aed1ab5d4ce03f6cf836c68fb1f.png"}}]);