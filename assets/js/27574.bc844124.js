"use strict";(self.webpackChunkmegadocs=self.webpackChunkmegadocs||[]).push([[27574],{27574:(e,r,t)=>{t.r(r),t.d(r,{SearchView:()=>w});var a=t(74848),s=t(14221),n=t(3374),i=t(96540),c=t(79111);const l=(0,i.memo)((function({value:e,match:r}){if(!r||""===r)return(0,a.jsx)(a.Fragment,{children:e});const t=e?e.split(""):[],s=r.trim().replace(/[|\\{}()[\]^$+*?.]/g,"\\$&"),n=RegExp(`(${s.replaceAll(" ","|")})`,"ig");let c=0,l=0;const o=[];if(e)for(;;){const r=n.exec(e);if(null===r)break;o.push((0,a.jsxs)(i.Fragment,{children:[t.splice(0,r.index-l).join(""),(0,a.jsx)("span",{className:"MarkpromptMatch",children:t.splice(0,n.lastIndex-r.index).join("")})]},c++)),l=n.lastIndex}return(0,a.jsxs)(a.Fragment,{children:[o,t.join("")]})}));function o(e){return e?.replace(/\|/gi,"").replace(/-{2,}/gi,"").replace(/-{2,}/gi,"").replace(/\s{2,}/gi," ")}const u=(0,i.forwardRef)(((e,r)=>{const{href:t,title:s,heading:n,subtitle:u,onMouseMove:p,onClick:d,searchQuery:h,linkAs:m,...k}=e,f=m??"a",g=(0,i.useMemo)((()=>o(s)),[s]),S=(0,i.useMemo)((()=>o(u)),[u]);return(0,a.jsx)("li",{...k,ref:r,className:"MarkpromptSearchResult",children:(0,a.jsx)(f,{href:t,onMouseMove:p,onClick:d,className:"MarkpromptSearchResultLink",children:(0,a.jsxs)("div",{className:"MarkpromptSearchResultContainer",children:[(0,a.jsx)("div",{className:"MarkpromptSearchResultIconWrapper MarkpromptSearchResultIconWrapperBordered",children:t?.includes("#")?(0,a.jsx)(c.Se,{className:"MarkpromptSearchResultIcon","aria-hidden":!0}):(0,a.jsx)(c.ds,{className:"MarkpromptSearchResultIcon","aria-hidden":!0})}),(0,a.jsxs)("div",{className:"MarkpromptSearchResultContentWrapper",children:[n&&(0,a.jsx)("div",{className:"MarkpromptSearchResultHeading",children:(0,a.jsx)(l,{value:n,match:h})}),(0,a.jsx)("div",{className:"MarkpromptSearchResultTitle",children:(0,a.jsx)(l,{value:g,match:h})}),S&&(0,a.jsx)("div",{className:"MarkpromptSearchResultSubtitle",children:(0,a.jsx)(l,{value:S,match:h})})]})]})})})}));u.displayName="Markprompt.SearchResult";var p=t(54574),d=t(58849);const h={limit:8};const m=(e,r,t={})=>{if(!Number.isFinite(r))throw new TypeError("Expected `wait` to be a finite number");let a,s,n=[];return function(...i){return new Promise((c=>{const l=t.before&&!s;clearTimeout(s),s=setTimeout((()=>{s=null;const r=t.before?a:e.apply(this,i);for(c of n)c(r);n=[]}),r),l?(a=e.apply(this,i),c(a)):n.push(c)}))}};m.promise=e=>{let r;return async function(...t){if(r)return r;try{return r=e.apply(this,t),await r}finally{r=void 0}}};const k=m;var f=t(36164),g=t(80874);function S({apiUrl:e,projectKey:r,debug:t,searchOptions:a}){const[n,c]=(0,i.useState)("indeterminate"),[l,o]=(0,i.useState)(""),[u,m]=(0,i.useState)([]),{ref:S,abort:y}=(0,g.I)(),b=(0,i.useCallback)((async n=>{if(y(),""===n)return S.current&&S.current.abort(),m([]),void c("indeterminate");c("preload");const i=new AbortController;S.current=i;try{let l;l="algolia"===a?.provider?.name?async function(e,r){try{const t=r?.provider;if("algolia"!==t?.name)throw new Error(`Unknown provider: ${t?.name}`);const{limit:a=h.limit}=r??{},s=await fetch(`https://${t.appId}-dsn.algolia.net/1/indexes/${t.indexName}/query`,{method:"POST",body:JSON.stringify({query:e,hitsPerPage:a,getRankingInfo:1,...r?.provider?.searchParameters}),signal:r?.signal,headers:{"X-Algolia-API-Key":t.apiKey,"X-Algolia-Application-Id":t.appId}});if(!s.ok){const e=await(0,d.u1)(s);throw new Error(`Failed to fetch search results: ${e||"Unknown error"}`)}return await s.json()}catch(t){if((0,d.zf)(t))return;throw t}}(n,{...a,signal:i.signal}).then((e=>e?.hits||[])):async function(e,r,t={}){try{const{limit:a=h.limit,apiUrl:n}=t??{},i=(0,p.A)({limit:a,apiUrl:n},{...s.l,...h}),c=new URLSearchParams({query:e,projectKey:r,limit:String(i.limit)}),l=await fetch(`${i.apiUrl}/search?${c.toString()}`,{method:"GET",signal:t?.signal,headers:new Headers({"X-Markprompt-API-Version":"2023-12-01",...i.headers?i.headers:{}})});if(!l.ok){const e=await(0,d.u1)(l);throw new Error(`Failed to fetch search results: ${e||"Unknown error"}`)}return await l.json()}catch(a){if((0,d.zf)(a))return;throw a}}(n,r,{apiUrl:e,...a,signal:i.signal}).then((e=>(t&&console.debug(JSON.stringify(e?.debug,null,2)),e?.data||[])));const o=await l;if(i.signal.aborted)return;if(!o)return;m(function(e,r,t){return r.map((r=>({href:(t?.getHref||f.V.search?.getHref)?.(r),heading:(t?.getHeading||f.V.search?.getHeading)?.(r,e),title:(t?.getTitle||f.V.search?.getTitle)?.(r,e)||"Untitled",subtitle:(t?.getSubtitle||f.V.search?.getSubtitle)?.(r,e)})))}(n,o,a)??[]),c("done")}catch(l){if((0,d.zf)(l))return;console.error(l)}finally{S.current===i&&(S.current=void 0)}}),[y,S,a,r,e,t]);return{state:n,searchResults:u,searchQuery:l,setSearchQuery:o,submitSearchQuery:k(b,220),abort:y}}var y=t(20243),b=t(19609);const v="markprompt-search";function w(e){const{activeView:r,debug:t,onDidSelectResult:l,onDidSelectAsk:o,projectKey:u,apiUrl:p}=e;if(!u)throw new Error("Markprompt: a project key is required. Make sure to pass your Markprompt project key to <SearchView />.");const d=(0,b.o)({...e.searchOptions},f.V.search),h=(0,i.useRef)(null),m=(0,i.useRef)(null),{abort:k,searchResults:g,searchQuery:w,state:j,setSearchQuery:M,submitSearchQuery:R}=S({apiUrl:p||s.l.apiUrl,projectKey:u,debug:t,searchOptions:d}),[N,A]=(0,i.useState)(),I="panels"===e.layout&&w.trim().includes(" "),C=(0,i.useMemo)((()=>"ask"===N?.id),[N?.id]);(0,i.useEffect)((()=>{I||C||A(void 0)}),[w,I,C]),(0,i.useEffect)((()=>{I?A({id:"ask"}):g.length>0&&A({id:"markprompt-result-0"})}),[g,I]),(0,i.useEffect)((()=>{m.current?.focus()}),[r]),(0,i.useEffect)((()=>(r&&"search"!==r&&k(),()=>k())),[k,r]);const E=(0,i.useCallback)((e=>{switch(e.key){case"ArrowDown":{if(!N)return;const r=d?.defaultView?.searches||[],t=g.length+r.length;if("ask"!==N.id&&N.id?.endsWith(""+(t-1)))return;let a;e.preventDefault(),a="ask"===N.id?"markprompt-result-0":N.id?.replace(/\d+$/,(e=>String(Number(e)+1))),A({id:a,trigger:"keyboard"});if(!document.querySelector(`#${a} > a`))return;break}case"ArrowUp":{if(!N)return;if(N.id?.endsWith("-0"))return void(I&&(e.preventDefault(),A({id:"ask",trigger:"keyboard"})));e.preventDefault();const r=N.id?.replace(/\d+$/,(e=>String(Number(e)-1)));A({id:r,trigger:"keyboard"});if(!document.querySelector(`#${r} > a`))return;break}case"Enter":{if(e.ctrlKey||e.metaKey)return;if(!N&&!I)return;if(e.preventDefault(),!N||"ask"===N.id){const e=document.querySelector("#ask");return void e?.click()}if(!N)return;const r=document.querySelector(`#${N.id} a`);if(!r)return;r.click();break}}}),[N,g.length,d?.defaultView?.searches,I]),V=(0,i.useCallback)((async e=>{M(e.target.value),await R(e.target.value)}),[M,R]),$=(0,i.useCallback)((async e=>{e.preventDefault(),await R(w)}),[w,R]);return(0,a.jsxs)("div",{className:"MarkpromptSearchView",children:[(0,a.jsx)(y.lV,{ref:h,className:"MarkpromptForm",onSubmit:$,children:(0,a.jsxs)("div",{className:"MarkpromptPromptWrapper",children:[(0,a.jsx)(y.dd,{ref:m,className:"MarkpromptPrompt",name:v,placeholder:d?.placeholder,labelClassName:"MarkpromptPromptLabel",containerClassName:"MarkpromptTextAreaContainer",value:w,onChange:V,onKeyDown:E,showSubmitButton:!1,type:"search","aria-controls":"markprompt-search-results","aria-activedescendant":N?.id,label:(0,a.jsx)(n.b,{label:d?.label,children:(0,a.jsx)(c.WI,{className:"MarkpromptSearchIconAccented"})}),onSubmit:e=>{e.preventDefault(),h.current?.requestSubmit()}}),(0,a.jsxs)("button",{className:d?.askLabel?"MarkpromptBorderedButton":"MarkpromptGhostButton",type:"button",style:{flexGrow:"none",marginRight:"0.25rem"},onClick:()=>o?.(),"aria-label":d?.askLabel??"Ask AI",children:[(0,a.jsx)(c.BZ,{"aria-hidden":"true",style:d?.askLabel?{width:16,height:16,opacity:.4}:{width:18,height:18}}),d?.askLabel&&(0,a.jsx)("span",{children:d.askLabel})]})]})}),(0,a.jsx)(x,{activeSearchResult:N,onDidSelectResult:l,onDidSelectAsk:()=>o?.(w),searchQuery:w,searchResults:g,searchOptions:d,linkAs:e.linkAs,setActiveSearchResult:A,state:j,isAskVisible:I})]})}function x(e){const{searchQuery:r,searchResults:t,state:s,activeSearchResult:n,setActiveSearchResult:l,onDidSelectResult:o,onDidSelectAsk:p,searchOptions:d,linkAs:h,isAskVisible:m}=e,k=(0,i.useRef)(null);return(0,i.useEffect)((()=>{const e=e=>{if("ArrowDown"===e.key&&void 0===n&&(t.length>0||(d?.defaultView?.searches||[]).length>0)){l({id:"markprompt-result-0",trigger:"keyboard"});const e=document.querySelector(`#${v}`);e instanceof HTMLInputElement&&e.focus()}};return document.addEventListener("keydown",e),()=>{document.removeEventListener("keydown",e)}}),[n,t,l,d?.defaultView?.searches]),(0,i.useEffect)((()=>{if(!n?.id||"keyboard"!==n.trigger)return;const e=document.getElementById(n.id);e?.focus(),e?.scrollIntoView({block:"nearest"})}),[n,t]),(0,a.jsxs)("div",{className:"MarkpromptSearchResultsContainer",children:[m&&(0,a.jsx)("div",{role:"button",tabIndex:0,className:"MarkpromptSearchResult",id:"ask",style:{cursor:"pointer"},onMouseMove:()=>{if("ask"!==k?.current)return k.current="ask",l({id:"ask",trigger:"mouse"}),!0},onClick:p,onKeyDown:e=>{p&&("Enter"!==e.key&&" "!==e.key||p())},children:(0,a.jsx)("div",{className:"MarkpromptSearchResultLink",children:(0,a.jsxs)("div",{className:"MarkpromptSearchResultContainer",children:[(0,a.jsx)("div",{className:"MarkpromptSearchResultIconWrapper MarkpromptSearchResultIconWrapperBordered",children:(0,a.jsx)(c.BZ,{className:"MarkpromptSearchResultIcon"})}),(0,a.jsx)("div",{className:"MarkpromptSearchResultContentWrapper",children:(0,a.jsxs)("div",{className:"MarkpromptSearchResultTitle",children:[(0,a.jsxs)("span",{className:"MarkpromptSearchResultTitleAccent",children:[d?.askLabel??"Ask AI",":"]})," ",r]})}),(0,a.jsx)(c.vK,{className:"MarkpromptSearchResultIcon","aria-hidden":!0})]})})}),"done"===s&&0===t.length&&r.trim().length>0&&(0,a.jsx)("div",{className:"MarkpromptNoSearchResults",children:(0,a.jsxs)("p",{children:["No matches found for ",(0,a.jsxs)("span",{children:["\u201c",r,"\u201d"]})]})}),(0,a.jsx)(y.LT,{searchResults:t,searchOptions:d,className:"MarkpromptSearchResults",headingClassName:"MarkpromptSearchResultSectionHeading",SearchResultComponent:({index:e,...t})=>{const s=`markprompt-result-${e}`;return(0,a.jsx)(u,{...t,id:s,searchQuery:r,onMouseMove:()=>(k?.current===s||(k.current=s,l({id:s,trigger:"mouse"})),!0),onClick:()=>{o?.()},"aria-selected":s===n?.id,linkAs:h})}})]})}}}]);