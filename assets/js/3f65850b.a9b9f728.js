"use strict";(self.webpackChunkmegadocs=self.webpackChunkmegadocs||[]).push([[69756],{3935:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>o,contentTitle:()=>l,default:()=>h,frontMatter:()=>t,metadata:()=>r,toc:()=>c});const r=JSON.parse('{"id":"kb/semgrep-ci/jenkins-shared-library-with-semgrep","title":"Jenkins shared library with Semgrep scans","description":"Setting up Jenkins shared library with Semgrep scans","source":"@site/docs/kb/semgrep-ci/jenkins-shared-library-with-semgrep.md","sourceDirName":"kb/semgrep-ci","slug":"/kb/semgrep-ci/jenkins-shared-library-with-semgrep","permalink":"/semgrep-docs/kb/semgrep-ci/jenkins-shared-library-with-semgrep","draft":false,"unlisted":false,"editUrl":"https://github.com/semgrep/semgrep-docs/edit/main/docs/kb/semgrep-ci/jenkins-shared-library-with-semgrep.md","tags":[{"inline":true,"label":"Jenkins","permalink":"/semgrep-docs/tags/jenkins"},{"inline":true,"label":"Shared Library","permalink":"/semgrep-docs/tags/shared-library"}],"version":"current","lastUpdatedAt":1714162125000,"frontMatter":{"tags":["Jenkins","Shared Library"],"description":"Setting up Jenkins shared library with Semgrep scans"},"sidebar":"kbSidebar","previous":{"title":"Full and diff-aware scans with GitHub and Jenkins","permalink":"/semgrep-docs/kb/semgrep-ci/jenkins-diff-scans"},"next":{"title":"Receive Semgrep MR comments through a GitLab runner","permalink":"/semgrep-docs/kb/semgrep-ci/mr-comments-through-gitlab-runner"}}');var s=i(74848),a=i(28453);const t={tags:["Jenkins","Shared Library"],description:"Setting up Jenkins shared library with Semgrep scans"},l="Jenkins shared library with Semgrep scans",o={},c=[{value:"Motivation",id:"motivation",level:2},{value:"Creating a Jenkins pipeline to call Semgrep",id:"creating-a-jenkins-pipeline-to-call-semgrep",level:2},{value:"Creating a shared library",id:"creating-a-shared-library",level:2},{value:"Create the library file",id:"create-the-library-file",level:3},{value:"Declare your library in Jenkins",id:"declare-your-library-in-jenkins",level:3},{value:"Using the shared library in the Jenkins pipeline",id:"using-the-shared-library-in-the-jenkins-pipeline",level:2},{value:"Conclusions",id:"conclusions",level:2}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",...(0,a.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"jenkins-shared-library-with-semgrep-scans",children:"Jenkins shared library with Semgrep scans"})}),"\n",(0,s.jsx)(n.h2,{id:"motivation",children:"Motivation"}),"\n",(0,s.jsxs)(n.p,{children:["A good practice when programming is to avoid duplicate code. This applies even when defining your build pipelines. To prevent duplicate code when defining Semgrep tests with Jenkins, create a ",(0,s.jsx)(n.a,{href:"https://www.jenkins.io/doc/book/pipeline/shared-libraries/",children:"Jenkins Shared Library"})," with the Semgrep snippet. Then, call this library in all the projects you have in your organization."]}),"\n",(0,s.jsx)(n.h2,{id:"creating-a-jenkins-pipeline-to-call-semgrep",children:"Creating a Jenkins pipeline to call Semgrep"}),"\n",(0,s.jsxs)(n.p,{children:["By following the ",(0,s.jsx)(n.a,{href:"https://semgrep.dev/docs/semgrep-ci/sample-ci-configs/#sample-jenkins-configuration-snippet",children:"Semgrep Jenkins CI configuration"}),", you can create a simple Jenkins pipeline to run Semgrep scans."]}),"\n",(0,s.jsx)(n.p,{children:"When rolling out Semgrep more widely in your organization, you need to replicate this pipeline to the many projects you have in your organization. If the Semgrep configuration later requires updates, each pipeline would have to be updated individually, which is time-consuming. Using a shared library prevents this issue."}),"\n",(0,s.jsx)(n.h2,{id:"creating-a-shared-library",children:"Creating a shared library"}),"\n",(0,s.jsx)(n.p,{children:"A Jenkins shared library encapsulates the Semgrep commands in a single library file, which is then called by all other workflows that use Semgrep."}),"\n",(0,s.jsx)(n.h3,{id:"create-the-library-file",children:"Create the library file"}),"\n",(0,s.jsxs)(n.p,{children:["Create a new repository with a Groovy file in the ",(0,s.jsx)(n.code,{children:"vars/"})," folder. For example, ",(0,s.jsx)(n.code,{children:"vars/semgrepFullScan.groovy"}),". Add the Semgrep snippet to that file:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"def call() {\n  sh '''docker pull semgrep/semgrep && \\\n            docker run \\\n            -e SEMGREP_APP_TOKEN=$SEMGREP_APP_TOKEN \\\n            -v \"$(pwd):$(pwd)\" --workdir $(pwd) \\\n            semgrep/semgrep semgrep ci '''\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"declare-your-library-in-jenkins",children:"Declare your library in Jenkins"}),"\n",(0,s.jsx)(n.p,{children:"These steps are for the Jenkins UI."}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"Go to the Dashboard."}),"\n",(0,s.jsxs)(n.li,{children:["Click ",(0,s.jsxs)(n.strong,{children:[(0,s.jsx)("i",{class:"fa-solid fa-gear"})," Manage Jenkins"]}),"."]}),"\n",(0,s.jsxs)(n.li,{children:["Under ",(0,s.jsx)(n.strong,{children:"System Configuration"}),", click ",(0,s.jsx)(n.strong,{children:"System"}),"."]}),"\n",(0,s.jsxs)(n.li,{children:["In the ",(0,s.jsx)(n.strong,{children:"Global Pipeline Libraries"})," section, define the library, including the name, version, and Git URL."]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"using-the-shared-library-in-the-jenkins-pipeline",children:"Using the shared library in the Jenkins pipeline"}),"\n",(0,s.jsx)(n.p,{children:'Once you have defined the shared library, you can use it in your pipelines. If you named the library "semgrep" in the Jenkins UI, calling it looks like:'}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"@Library('semgrep') _\n\npipeline {\n  agent any\n    environment {\n      // The following variable is required for a Semgrep AppSec Platform-connected scan:\n      SEMGREP_APP_TOKEN = credentials('SEMGREP_APP_TOKEN')\n\n    }\n    stages {\n      stage('Semgrep-Scan') {\n        steps {\n            semgrepFullScan()\n      }\n    }\n  }\n}\n"})}),"\n",(0,s.jsxs)(n.p,{children:["Line 1 must have the name of the shared library, and the function invoked (",(0,s.jsx)(n.code,{children:"semgrepFullScan"}),") must match the name of the Groovy file created before (",(0,s.jsx)(n.code,{children:"semgrepFullScan.groovy"}),")."]}),"\n",(0,s.jsx)(n.h2,{id:"conclusions",children:"Conclusions"}),"\n",(0,s.jsx)(n.p,{children:"Using a Jenkins Shared Library can simplify your pipelines and avoid code duplication across all your projects, saving you time if you need to add flags to the Semgrep command or otherwise update it."})]})}function h(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},28453:(e,n,i)=>{i.d(n,{R:()=>t,x:()=>l});var r=i(96540);const s={},a=r.createContext(s);function t(e){const n=r.useContext(a);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:t(e.components),r.createElement(a.Provider,{value:n},e.children)}}}]);