"use strict";(self.webpackChunkmegadocs=self.webpackChunkmegadocs||[]).push([[34708],{21011:(e,n,i)=>{i.d(n,{A:()=>t});const t=i.p+"assets/images/bitbucket-jenkins-pullrequest-2-6466bf03f1b5c70d19aa621da557edde.png"},22159:(e,n,i)=>{i.d(n,{A:()=>t});const t=i.p+"assets/images/bitbucket-jenkins-events-497a2f04409215c95748994db9ec753f.png"},28453:(e,n,i)=>{i.d(n,{R:()=>c,x:()=>o});var t=i(96540);const s={},r=t.createContext(s);function c(e){const n=t.useContext(r);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:c(e.components),t.createElement(r.Provider,{value:n},e.children)}},31611:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>l,contentTitle:()=>o,default:()=>d,frontMatter:()=>c,metadata:()=>t,toc:()=>p});const t=JSON.parse('{"id":"kb/semgrep-ci/bitbuket-jenkins-pipeline-projects","title":"Set up Jenkins pipeline projects for Bitbucket repositories","description":"Set up Jenkins pipeline projects for Bitbucket repositories.","source":"@site/docs/kb/semgrep-ci/bitbuket-jenkins-pipeline-projects.md","sourceDirName":"kb/semgrep-ci","slug":"/kb/semgrep-ci/bitbuket-jenkins-pipeline-projects","permalink":"/semgrep-docs/kb/semgrep-ci/bitbuket-jenkins-pipeline-projects","draft":false,"unlisted":false,"editUrl":"https://github.com/kyle-semgrep/semgrep-docs/edit/main/docs/kb/semgrep-ci/bitbuket-jenkins-pipeline-projects.md","tags":[{"inline":true,"label":"Bitbucket","permalink":"/semgrep-docs/tags/bitbucket"},{"inline":true,"label":"Jenkins","permalink":"/semgrep-docs/tags/jenkins"},{"inline":true,"label":"Pipeline projects","permalink":"/semgrep-docs/tags/pipeline-projects"}],"version":"current","lastUpdatedAt":1752262761000,"frontMatter":{"tags":["Bitbucket","Jenkins","Pipeline projects"],"description":"Set up Jenkins pipeline projects for Bitbucket repositories."},"sidebar":"kbSidebar","previous":{"title":"Triggering events from Bitbucket to Jenkins","permalink":"/semgrep-docs/kb/semgrep-ci/bitbucket-triggering-events-to-jenkins"},"next":{"title":"Semgrep in CI vs CLI: align your SAST scan results and understand differences","permalink":"/semgrep-docs/kb/semgrep-ci/ci-vs-cli"}}');var s=i(74848),r=i(28453);const c={tags:["Bitbucket","Jenkins","Pipeline projects"],description:"Set up Jenkins pipeline projects for Bitbucket repositories."},o="Set up Jenkins pipeline projects for Bitbucket repositories",l={},p=[{value:"Prerequisites",id:"prerequisites",level:2},{value:"Create a Jenkins pipeline project",id:"create-a-jenkins-pipeline-project",level:2},{value:"Test the new Jenkins pipeline project",id:"test-the-new-jenkins-pipeline-project",level:2}];function a(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",header:"header",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"set-up-jenkins-pipeline-projects-for-bitbucket-repositories",children:"Set up Jenkins pipeline projects for Bitbucket repositories"})}),"\n",(0,s.jsx)(n.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,s.jsxs)(n.p,{children:["Ensure you have set up ",(0,s.jsx)(n.a,{href:"https://semgrep.dev/docs/kb/semgrep-ci/bitbucket-triggering-events-to-jenkins/",children:"triggering events from Bitbucket to Jenkins"}),"."]}),"\n",(0,s.jsx)(n.h2,{id:"create-a-jenkins-pipeline-project",children:"Create a Jenkins pipeline project"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["From the ",(0,s.jsx)(n.strong,{children:"Jenkins Dashboard"})," click on create a ",(0,s.jsx)(n.strong,{children:"New Item"}),"."]}),"\n",(0,s.jsxs)(n.li,{children:["Type a project name and select the ",(0,s.jsx)(n.strong,{children:"Pipeline"})," option.\n",(0,s.jsx)(n.img,{alt:"Filled-out item name and Pipeline option",src:i(63728).A+"",width:"2358",height:"952"})]}),"\n",(0,s.jsxs)(n.li,{children:["In the ",(0,s.jsx)(n.strong,{children:"General section"}),", click the ",(0,s.jsxs)(n.strong,{children:[(0,s.jsx)("i",{class:"fa-solid fa-square-check"})," Build with Bitbucket Push and Pull Request Plugin"]}),". Alternatively, the plugin can also be called ",(0,s.jsx)(n.strong,{children:"Bitbucket Cloud Pull Request"})," or ",(0,s.jsx)(n.strong,{children:"Bitbucket Server Pull Request"}),"."]}),"\n",(0,s.jsxs)(n.li,{children:["In ",(0,s.jsx)(n.strong,{children:"Triggers > Select an Action"})," select ",(0,s.jsx)(n.strong,{children:"Created"})," and ",(0,s.jsx)(n.strong,{children:"Updated"}),".\n",(0,s.jsx)(n.img,{alt:"Build triggers for the pipeline project",src:i(22159).A+"",width:"2754",height:"1210"})]}),"\n",(0,s.jsxs)(n.li,{children:["In the ",(0,s.jsx)(n.strong,{children:"Pipeline Section"}),":","\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["In ",(0,s.jsx)(n.strong,{children:"Repository URL"}),", enter the Bitbucket repository URL."]}),"\n",(0,s.jsxs)(n.li,{children:["In ",(0,s.jsx)(n.strong,{children:"Branch Specifier"}),", enter your main or trunk branch (",(0,s.jsx)(n.code,{children:"master"})," in the screenshot)."]}),"\n",(0,s.jsxs)(n.li,{children:["In ",(0,s.jsx)(n.strong,{children:"Script Path"}),", enter the path to your 'Jenkinsfile'.\n",(0,s.jsx)(n.img,{alt:"Pipeline section &gt; Repository URL and Branch Specifier examples.",src:i(35634).A+"",width:"2702",height:"1238"}),"\n",(0,s.jsx)(n.img,{alt:"Pipeline section &gt; Script Path example",src:i(66601).A+"",width:"2768",height:"1160"})]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["Create the ",(0,s.jsx)(n.strong,{children:"Jenkinsfile"})," in the Bitbucket repository. It must define the logic to run Semgrep diff scans if it is a pull request or Semgrep full scans if it is a push to the main branch. It can look like this:"]}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"pipeline {\n      agent any\n      environment {\n        SEMGREP_APP_TOKEN = credentials('SEMGREP_APP_TOKEN')\n        SEMGREP_BASELINE_REF = \"origin/master\"\n      }\n      stages {\n        stage('Semgrep-Scan') {\n         steps {\n          script {\n            if (env.BITBUCKET_PULL_REQUEST_ID) {\n              echo \"Semgrep diff scan\"\n              sh '''git checkout ${BITBUCKET_PULL_REQUEST_LATEST_COMMIT_FROM_SOURCE_BRANCH}'''\n              sh '''git fetch origin +ref/heads/*:refs/remotes/origin/*'''\n              sh '''docker run \\\n                -e SEMGREP_APP_TOKEN=$SEMGREP_APP_TOKEN \\\n                -e SEMGREP_PR_ID=${BITBUCKET_PULL_REQUEST_ID} \\\n                -e SEMGREP_BASELINE_REF=$SEMGREP_BASELINE_REF \\\n                -v \"$(pwd):$(pwd)\" --workdir $(pwd) \\\n                 semgrep/semgrep semgrep ci'''\n              }\n              else {\n                 echo \"Semgrep full scan\"\n                 sh '''docker run \\\n                   -e SEMGREP_APP_TOKEN=$SEMGREP_APP_TOKEN \\\n                   -v \"$(pwd):$(pwd)\" --workdir $(pwd) \\\n                   semgrep/semgrep semgrep ci'''\n               }\n             }\n           }\n         }\n      }\n}\n"})}),"\n",(0,s.jsx)(n.admonition,{type:"note",children:(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Ensure that you have defined a ",(0,s.jsx)(n.code,{children:"SEMGREP_APP_TOKEN"})," as a credential in Jenkins."]}),"\n",(0,s.jsxs)(n.li,{children:["The variable SEMGREP_BASELINE_REF must be set to the main branch, in the example: ",(0,s.jsx)(n.code,{children:"origin/master"}),"."]}),"\n"]})}),"\n",(0,s.jsx)(n.h2,{id:"test-the-new-jenkins-pipeline-project",children:"Test the new Jenkins pipeline project"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["Commit a change in the repository and create a pull request. It automatically runs a Semgrep diff scan in Jenkins:\n",(0,s.jsx)(n.img,{alt:"Status view of a failed job run.",src:i(46520).A+"",width:"1632",height:"962"}),"\n",(0,s.jsx)(n.img,{alt:"Console or log view of a job.",src:i(21011).A+"",width:"2838",height:"820"}),"\nNote that the pull request can be marked as ",(0,s.jsx)(n.strong,{children:"failed"})," if there are blocking findings, as in the example."]}),"\n",(0,s.jsx)(n.li,{children:"Merge the change to master. It will run a Semgrep full scan in Jenkins."}),"\n"]})]})}function d(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(a,{...e})}):a(e)}},35634:(e,n,i)=>{i.d(n,{A:()=>t});const t=i.p+"assets/images/bitbucket-jenkins-pipeline-section-1-49beedabea68d4a3e9af08e90aab60f8.png"},46520:(e,n,i)=>{i.d(n,{A:()=>t});const t=i.p+"assets/images/bitbucket-jenkins-pullrequest-1-d33997e12b1ec2b3f1e0320810d24397.png"},63728:(e,n,i)=>{i.d(n,{A:()=>t});const t=i.p+"assets/images/bitbucket-jenkins-new-0f182a325617da9f7955bcb3a4bfe5f8.png"},66601:(e,n,i)=>{i.d(n,{A:()=>t});const t=i.p+"assets/images/bitbucket-jenkins-pipeline-section-2-a31d0ff1ec092522e81b661cff522fe4.png"}}]);