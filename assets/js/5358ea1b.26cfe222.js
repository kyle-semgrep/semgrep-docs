"use strict";(self.webpackChunkmegadocs=self.webpackChunkmegadocs||[]).push([[77887],{10820:(e,s,i)=>{i.r(s),i.d(s,{assets:()=>o,contentTitle:()=>c,default:()=>h,frontMatter:()=>a,metadata:()=>n,toc:()=>l});const n=JSON.parse('{"id":"semgrep-secrets/historical-scanning","title":"Scan your Git history (beta)","description":"Detect valid, leaked secrets in previous Git commits through a historical scan.","source":"@site/docs/semgrep-secrets/historical-scanning.md","sourceDirName":"semgrep-secrets","slug":"/semgrep-secrets/historical-scanning","permalink":"/docs/semgrep-secrets/historical-scanning","draft":false,"unlisted":false,"editUrl":"https://github.com/kyle-semgrep/semgrep-docs/edit/main/docs/semgrep-secrets/historical-scanning.md","tags":[{"inline":true,"label":"Semgrep Secrets","permalink":"/docs/tags/semgrep-secrets"},{"inline":true,"label":"Semgrep AppSec Platform","permalink":"/docs/tags/semgrep-app-sec-platform"}],"version":"current","lastUpdatedAt":1752252315000,"frontMatter":{"slug":"historical-scanning","append_help_link":true,"title":"Scan your Git history (beta)","hide_title":true,"description":"Detect valid, leaked secrets in previous Git commits through a historical scan.","tags":["Semgrep Secrets","Semgrep AppSec Platform"]},"sidebar":"scanSidebar","previous":{"title":"Scan for secrets","permalink":"/docs/semgrep-secrets/getting-started"},"next":{"title":"Scan for generic secrets","permalink":"/docs/semgrep-secrets/generic-secrets"}}');var r=i(74848),t=i(28453);const a={slug:"historical-scanning",append_help_link:!0,title:"Scan your Git history (beta)",hide_title:!0,description:"Detect valid, leaked secrets in previous Git commits through a historical scan.",tags:["Semgrep Secrets","Semgrep AppSec Platform"]},c="Scan your Git history (beta)",o={},l=[{value:"Feature maturity",id:"feature-maturity",level:2},{value:"Run historical scans",id:"run-historical-scans",level:2},{value:"Prerequisites",id:"prerequisites",level:3},{value:"Enable historical scans for full Secrets scans",id:"enable-historical-scans-for-full-secrets-scans",level:3},{value:"Run a one-off historical scan",id:"run-a-one-off-historical-scan",level:3},{value:"Run a local test scan",id:"run-a-local-test-scan",level:3},{value:"View or hide historical findings",id:"view-or-hide-historical-findings",level:2},{value:"Scope of findings",id:"scope-of-findings",level:2},{value:"Triage process",id:"triage-process",level:2},{value:"Limitations",id:"limitations",level:2},{value:"Size of commit history",id:"size-of-commit-history",level:3}];function d(e){const s={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(s.header,{children:(0,r.jsx)(s.h1,{id:"scan-your-git-history-beta",children:"Scan your Git history (beta)"})}),"\n",(0,r.jsxs)(s.p,{children:["Detect valid, leaked secrets in previous Git commits through a ",(0,r.jsx)(s.strong,{children:"historical scan"}),"."]}),"\n",(0,r.jsx)(s.p,{children:"You can perform one-time historical scans or enable historical scans for full Secrets scans. Detecting valid secrets in your Git history is a step towards reducing your repository's attack surface."}),"\n",(0,r.jsx)(s.p,{children:"You can run historical scans in the CLI and in your Semgrep deployment, which enables you to track and triage these secrets."}),"\n",(0,r.jsx)(s.h2,{id:"feature-maturity",children:"Feature maturity"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:["This feature is in ",(0,r.jsx)(s.strong,{children:"public beta"}),". See ",(0,r.jsx)(s.a,{href:"#limitations",children:"Limitations"})," for more information."]}),"\n",(0,r.jsx)(s.li,{children:"All Semgrep Secrets customers can enable this feature."}),"\n",(0,r.jsx)(s.li,{children:"Currently, only rules that perform HTTP validation are incorporated during historical scanning. Findings that have been verified as valid are surfaced."}),"\n",(0,r.jsxs)(s.li,{children:["Please leave feedback either by reaching out to your technical account manager (TAM) or through the ",(0,r.jsxs)(s.strong,{children:[(0,r.jsx)("i",{class:"fa-solid fa-bullhorn"})," Feedback"]})," form in Semgrep AppSec Platform's navigation bar."]}),"\n"]}),"\n",(0,r.jsx)(s.h2,{id:"run-historical-scans",children:"Run historical scans"}),"\n",(0,r.jsxs)(s.p,{children:["You can enable historical scans for your full scans, perform one-time historical scans on the CLI, or create an on-demand CI job. Historical scans display ",(0,r.jsx)(s.strong,{children:"valid, leaked secrets"})," to ensure a high true positive rate. Diff-aware scans do ",(0,r.jsx)(s.strong,{children:"not"})," perform historical scans."]}),"\n",(0,r.jsx)(s.h3,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"CLI tool"}),": Historical scanning requires at least Semgrep ",(0,r.jsx)(s.strong,{children:"v1.65.0"}),". See ",(0,r.jsx)(s.a,{href:"/update/",children:"Update"})," for instructions."]}),"\n"]}),"\n",(0,r.jsx)(s.h3,{id:"enable-historical-scans-for-full-secrets-scans",children:"Enable historical scans for full Secrets scans"}),"\n",(0,r.jsx)(s.admonition,{type:"tip",children:(0,r.jsxs)(s.p,{children:["If possible, ",(0,r.jsx)(s.a,{href:"#run-a-local-test-scan",children:"test historical scans locally"})," to create a benchmark of performance and scan times before adding historical scans to your formal security process."]})}),"\n",(0,r.jsxs)(s.ol,{children:["\n",(0,r.jsx)(s.li,{children:"Sign in to Semgrep AppSec Platform."}),"\n",(0,r.jsxs)(s.li,{children:["Go to ",(0,r.jsx)(s.strong,{children:"Settings > General > Secrets"}),"."]}),"\n",(0,r.jsxs)(s.li,{children:["Click the ",(0,r.jsxs)(s.strong,{children:[(0,r.jsx)("i",{class:"fa-solid fa-toggle-large-on"})," Historical scanning"]})," toggle.\n",(0,r.jsx)(s.img,{alt:"Historical scanning settings toggle",src:i(82627).A+"#md-width",width:"873",height:"381"})]}),"\n"]}),"\n",(0,r.jsx)(s.p,{children:"Subsequent Semgrep full scans now include historical scanning."}),"\n",(0,r.jsx)(s.h3,{id:"run-a-one-off-historical-scan",children:"Run a one-off historical scan"}),"\n",(0,r.jsx)(s.p,{children:"To run a one-off or on-demand historical scan, you can create a specific CI job and then manually start the job as needed."}),"\n",(0,r.jsx)(s.p,{children:"The general steps are:"}),"\n",(0,r.jsxs)(s.ol,{children:["\n",(0,r.jsxs)(s.li,{children:["Copy your current full scan CI job configuration file, or use ",(0,r.jsx)(s.a,{href:"/semgrep-ci/sample-ci-configs/",children:"a template"}),"."]}),"\n",(0,r.jsxs)(s.li,{children:["Look for the ",(0,r.jsx)(s.code,{children:"semgrep ci"})," command."]}),"\n",(0,r.jsxs)(s.li,{children:["Append the ",(0,r.jsx)(s.code,{children:"--historical-secrets"})," flag:","\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{children:"semgrep ci --historical-secrets\n"})}),"\n"]}),"\n",(0,r.jsxs)(s.li,{children:["Depending on your CI provider, you may have to perform additional steps to enable the job to run manually. For example, GitHub Actions requires the ",(0,r.jsx)(s.code,{children:"workflow_dispatch"})," event to be added to your CI job."]}),"\n"]}),"\n",(0,r.jsx)(s.h3,{id:"run-a-local-test-scan",children:"Run a local test scan"}),"\n",(0,r.jsx)(s.p,{children:"You can run a historical scan locally without sending the scan results to Semgrep AppSec Platform. This can help you determine the time it takes for Semgrep Secrets to run on your repository's Git commit history."}),"\n",(0,r.jsx)(s.p,{children:"To run a test scan, enter the following command:"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:"semgrep ci --secrets --historical-secrets --dry-run\n"})}),"\n",(0,r.jsxs)(s.p,{children:["The historical scan results appear in the ",(0,r.jsx)(s.strong,{children:"Secrets Historical Scan"})," section:"]}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.img,{alt:"Historical scan section in the CLI",src:i(69901).A+"#md-width",width:"784",height:"244"})}),"\n",(0,r.jsx)(s.h2,{id:"view-or-hide-historical-findings",children:"View or hide historical findings"}),"\n",(0,r.jsxs)(s.ol,{children:["\n",(0,r.jsxs)(s.li,{children:["Sign in to ",(0,r.jsxs)(s.a,{href:"https://semgrep.dev/login",children:[(0,r.jsx)("i",{class:"fas fa-external-link fa-xs"})," Semgrep AppSec Platform"]}),"."]}),"\n",(0,r.jsxs)(s.li,{children:["Click ",(0,r.jsxs)(s.strong,{children:[(0,r.jsx)("i",{class:"fa-solid fa-key"})," Secrets"]}),". Historical findings are labeled as shown in the following screenshot:\n",(0,r.jsx)(s.img,{alt:"Secrets finding labeled as historical finding",src:i(68930).A+"#md-width",width:"1522",height:"734"})]}),"\n",(0,r.jsxs)(s.li,{children:["On the filter panel, select ",(0,r.jsx)(s.strong,{children:"Include historical findings"})," to toggle on the display of historical findings."]}),"\n"]}),"\n",(0,r.jsx)(s.h2,{id:"scope-of-findings",children:"Scope of findings"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:["Historical scans display ",(0,r.jsx)(s.strong,{children:"valid"})," Secrets findings. These secrets have been ",(0,r.jsx)(s.a,{href:"/semgrep-secrets/conceptual-overview/#validate-secrets",children:"validated through authentication or a similar function"}),"."]}),"\n",(0,r.jsxs)(s.li,{children:["Historical scans do ",(0,r.jsx)(s.strong,{children:"not"})," display the following finding types:","\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsx)(s.li,{children:"Invalid Secrets findings"}),"\n",(0,r.jsx)(s.li,{children:"Secrets findings without validator functions"}),"\n",(0,r.jsx)(s.li,{children:"Secrets findings with validation errors"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(s.li,{children:["Findings from historical scans are generated through ",(0,r.jsx)(s.strong,{children:"Generic"})," (regex-based) rules only.","\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:["Navigate to ",(0,r.jsx)(s.strong,{children:(0,r.jsxs)(s.a,{href:"https://semgrep.dev/orgs/-/policies/secrets?analysis-method=generic",children:[(0,r.jsx)("i",{class:"fas fa-external-link fa-xs"})," Semgrep AppSec Platform > Policies > Secrets"]})})," and click ",(0,r.jsx)(s.strong,{children:"Generic"})," under ",(0,r.jsx)(s.strong,{children:"Analysis method"})," to view these rules."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(s.p,{children:["For more information on the types of findings by validation, see ",(0,r.jsx)(s.a,{href:"/semgrep-secrets/conceptual-overview/#validate-secrets",children:"Semgrep Secrets overview"}),"."]}),"\n",(0,r.jsx)(s.h2,{id:"triage-process",children:"Triage process"}),"\n",(0,r.jsxs)(s.p,{children:["Historical scan findings are not automatically marked as ",(0,r.jsx)(s.strong,{children:"Fixed"}),". To triage a historical finding, you must:"]}),"\n",(0,r.jsxs)(s.ol,{children:["\n",(0,r.jsx)(s.li,{children:"Manually rotate the secret."}),"\n",(0,r.jsxs)(s.li,{children:["In Semgrep AppSec Platform, click ",(0,r.jsx)(s.strong,{children:"Secrets"}),"."]}),"\n",(0,r.jsxs)(s.li,{children:["Toggle the ",(0,r.jsx)(s.strong,{children:"Hide historical"})," button if it is enabled. This displays all historical findings."]}),"\n",(0,r.jsxs)(s.li,{children:["Select all the checkboxes for secrets you want to triage, then click ",(0,r.jsx)(s.strong,{children:"Triage > Ignore"}),", optionally including a comment in the provided text box."]}),"\n"]}),"\n",(0,r.jsx)(s.h2,{id:"limitations",children:"Limitations"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsx)(s.li,{children:"Historical scanning can slow down scan times. Depending on the size of your repository history, scans can finish in less than 5 minutes or may take more than 60 minutes."}),"\n",(0,r.jsxs)(s.li,{children:["Within Semgrep AppSec Platform, historical scan findings are not automatically marked as ",(0,r.jsx)(s.strong,{children:"Fixed"}),". Findings can only exist in two states: ",(0,r.jsx)(s.code,{children:"Open"})," or ",(0,r.jsx)(s.code,{children:"Ignored"}),". Because Semgrep scans do not automatically detect historical findings as fixed, you must manually rotate and triage the secret as ",(0,r.jsx)(s.code,{children:"Ignored"}),"."]}),"\n",(0,r.jsx)(s.li,{children:"With historical scans enabled, the CLI output displays secrets still present in the current version of the code twice: once at the commit where they were initially added and once at the current commit from the standard Secrets scan. Semgrep AppSec Platform deduplicates the two findings and displays the secret as a current rather than a historical one."}),"\n"]}),"\n",(0,r.jsx)(s.h3,{id:"size-of-commit-history",children:"Size of commit history"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:["Semgrep Secrets scans up to ",(0,r.jsx)(s.strong,{children:"5 GiB"})," of uncompressed blobs. This ranges from around ",(0,r.jsx)(s.strong,{children:"10,000 to 50,000"})," previous commits depending on the average size of the commit."]}),"\n",(0,r.jsx)(s.li,{children:"For repositories with more than 5 GiB of history, Semgrep Secrets is still able to complete the scan, but the scan scope will not cover the older commits beyond 5 GiB."}),"\n",(0,r.jsx)(s.li,{children:"The size of the commit history affects the speed of the scan. Larger repositories take longer to complete."}),"\n",(0,r.jsxs)(s.li,{children:["Semgrep Secrets scans the whole commit history every time a full scan is run. This guarantees that your Git history is also scanned using the ",(0,r.jsx)(s.strong,{children:"latest Secrets rules"}),"."]}),"\n"]})]})}function h(e={}){const{wrapper:s}={...(0,t.R)(),...e.components};return s?(0,r.jsx)(s,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},28453:(e,s,i)=>{i.d(s,{R:()=>a,x:()=>c});var n=i(96540);const r={},t=n.createContext(r);function a(e){const s=n.useContext(t);return n.useMemo((function(){return"function"==typeof e?e(s):{...s,...e}}),[s,e])}function c(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:a(e.components),n.createElement(t.Provider,{value:s},e.children)}},68930:(e,s,i)=>{i.d(s,{A:()=>n});const n=i.p+"assets/images/historical-findings-f1ed8b09afd17646ac1399afb071dab9.png"},69901:(e,s,i)=>{i.d(s,{A:()=>n});const n=i.p+"assets/images/historical-scans-cli-617098c1d11c93e92fc600d23d1af66c.png"},82627:(e,s,i)=>{i.d(s,{A:()=>n});const n=i.p+"assets/images/historical-scanning-settings-f79cf589a5372db5a3739883c7bd0b8f.png"}}]);