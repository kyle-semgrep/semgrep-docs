"use strict";(self.webpackChunkmegadocs=self.webpackChunkmegadocs||[]).push([[15377],{18848:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>c,contentTitle:()=>a,default:()=>h,frontMatter:()=>o,metadata:()=>s,toc:()=>l});const s=JSON.parse('{"id":"kb/semgrep-appsec-platform/missing-pr-comments","title":"Why is my repository not receiving PR or MR comments?","description":"Use this reference to check why you may not be receiving Semgrep comments on PRs or MRs.","source":"@site/docs/kb/semgrep-appsec-platform/missing-pr-comments.md","sourceDirName":"kb/semgrep-appsec-platform","slug":"/kb/semgrep-appsec-platform/missing-pr-comments","permalink":"/semgrep-docs/kb/semgrep-appsec-platform/missing-pr-comments","draft":false,"unlisted":false,"editUrl":"https://github.com/kyle-semgrep/semgrep-docs/edit/main/docs/kb/semgrep-appsec-platform/missing-pr-comments.md","tags":[{"inline":true,"label":"Semgrep in CI","permalink":"/semgrep-docs/tags/semgrep-in-ci"},{"inline":true,"label":"PR comments","permalink":"/semgrep-docs/tags/pr-comments"},{"inline":true,"label":"Rule management","permalink":"/semgrep-docs/tags/rule-management"}],"version":"current","lastUpdatedAt":1753220396000,"frontMatter":{"description":"Use this reference to check why you may not be receiving Semgrep comments on PRs or MRs.","tags":["Semgrep in CI","PR comments","Rule management"]},"sidebar":"kbSidebar","previous":{"title":"Why did the comments on a PR or MR not appear inline?","permalink":"/semgrep-docs/kb/semgrep-appsec-platform/inline-pr-comments"},"next":{"title":"SAML SSO error: There is no AttributeStatement on the Response","permalink":"/semgrep-docs/kb/semgrep-appsec-platform/saml-attributestatement"}}');var r=i(74848),t=i(28453);const o={description:"Use this reference to check why you may not be receiving Semgrep comments on PRs or MRs.",tags:["Semgrep in CI","PR comments","Rule management"]},a="Why is my repository not receiving PR or MR comments?",c={},l=[{value:"Are comments supported in your source code manager (SCM)?",id:"are-comments-supported-in-your-source-code-manager-scm",level:2},{value:"Have you configured permissions and tokens correctly?",id:"have-you-configured-permissions-and-tokens-correctly",level:2},{value:"GitHub",id:"github",level:3},{value:"Azure DevOps, GitLab, and Bitbucket",id:"azure-devops-gitlab-and-bitbucket",level:3},{value:"Azure DevOps",id:"azure-devops",level:4},{value:"GitLab",id:"gitlab",level:4},{value:"Bitbucket",id:"bitbucket",level:4},{value:"Are you running diff-aware scans?",id:"are-you-running-diff-aware-scans",level:2},{value:"Identify a diff-aware scan",id:"identify-a-diff-aware-scan",level:3},{value:"The triggering event for the scan",id:"the-triggering-event-for-the-scan",level:4},{value:"The number of files scanned",id:"the-number-of-files-scanned",level:4},{value:"Whether a baseline scan is conducted",id:"whether-a-baseline-scan-is-conducted",level:4},{value:"Have you correctly configured your policies?",id:"have-you-correctly-configured-your-policies",level:2},{value:"Code: The rule is in Comment or Block mode",id:"code-the-rule-is-in-comment-or-block-mode",level:3},{value:"Secrets: The rule is in Comment or Block mode, and validation settings match",id:"secrets-the-rule-is-in-comment-or-block-mode-and-validation-settings-match",level:3},{value:"Supply Chain: The finding meets your criteria for commenting or blocking",id:"supply-chain-the-finding-meets-your-criteria-for-commenting-or-blocking",level:3},{value:"Is this the first time this finding has been identified?",id:"is-this-the-first-time-this-finding-has-been-identified",level:2},{value:"If you&#39;re still having trouble",id:"if-youre-still-having-trouble",level:2}];function d(e){const n={a:"a",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",img:"img",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"why-is-my-repository-not-receiving-pr-or-mr-comments",children:"Why is my repository not receiving PR or MR comments?"})}),"\n",(0,r.jsx)(n.p,{children:"If you have configured Semgrep in CI and Semgrep AppSec Platform to create comments when a rule generates a finding in a PR or MR, but you are not seeing those comments, review the following possibilities."}),"\n",(0,r.jsx)(n.h2,{id:"are-comments-supported-in-your-source-code-manager-scm",children:"Are comments supported in your source code manager (SCM)?"}),"\n",(0,r.jsx)(n.p,{children:"PR or MR comments are currently supported for:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"All GitHub plans"}),"\n",(0,r.jsx)(n.li,{children:"All GitLab plans"}),"\n",(0,r.jsx)(n.li,{children:"All Bitbucket plans"}),"\n",(0,r.jsx)(n.li,{children:"Azure DevOps Cloud repositories"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"PR or MR comments are not supported for:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Any other SCM or repository provider"}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["If you are using a self-hosted version of your SCM, see ",(0,r.jsx)(n.a,{href:"/deployment/connect-scm/#connect-to-on-premise-orgs-and-projects",children:"Connect to on-premise orgs and projects"})," for more details on configuration."]}),"\n",(0,r.jsx)(n.h2,{id:"have-you-configured-permissions-and-tokens-correctly",children:"Have you configured permissions and tokens correctly?"}),"\n",(0,r.jsx)(n.h3,{id:"github",children:"GitHub"}),"\n",(0,r.jsx)(n.p,{children:"GitHub relies on the Semgrep GitHub app to make comments on code. To receive comments on a project, ensure that you have performed the following steps:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["You have ",(0,r.jsx)(n.a,{href:"/docs/category/scan-repositories-with-the-appsec-platform",children:"onboarded"})," the project to Semgrep AppSec Platform."]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["You have configured your GitHub app with permissions for all repositories that are scanned by Semgrep AppSec Platform. See ",(0,r.jsx)(n.a,{href:"/docs/semgrep-appsec-platform/github-pr-comments",children:"Enabling GitHub pull request comments"})," for details, or review the following examples:"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.img,{alt:"Semgrep GitHub app permissions: all repositories",src:i(19607).A+"#md-width",width:"1924",height:"1184"}),"\n",(0,r.jsxs)(n.em,{children:[(0,r.jsx)(n.strong,{children:"Figure."})," Grant permissions for access to all repositories."]})]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.img,{alt:"Semgrep GitHub app permissions - select repositories",src:i(66196).A+"#md-width",width:"1902",height:"948"}),"\n",(0,r.jsxs)(n.em,{children:[(0,r.jsx)(n.strong,{children:"Figure."})," Grant permissions for access to select repositories. Ensure the repositories you have onboarded to Semgrep AppSec Platform are included here."]})]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"azure-devops-gitlab-and-bitbucket",children:"Azure DevOps, GitLab, and Bitbucket"}),"\n",(0,r.jsxs)(n.p,{children:["For MR comments on GitLab and PR comments on Bitbucket or Azure DevOps, ensure that you have ",(0,r.jsx)(n.a,{href:"/deployment/connect-scm",children:"set up a connection to your SCM organization or project"})," and provided Semgrep with a token that has the required permissions to comment on MRs or PRs."]}),"\n",(0,r.jsx)(n.h4,{id:"azure-devops",children:"Azure DevOps"}),"\n",(0,r.jsxs)(n.p,{children:["See ",(0,r.jsx)(n.a,{href:"/docs/semgrep-appsec-platform/azure-pr-comments",children:"Enable Azure pull request comments"})," for token and configuration guidelines."]}),"\n",(0,r.jsx)(n.h4,{id:"gitlab",children:"GitLab"}),"\n",(0,r.jsxs)(n.p,{children:["The GitLab token should have ",(0,r.jsx)(n.code,{children:"api"})," scope. See ",(0,r.jsx)(n.a,{href:"/docs/semgrep-appsec-platform/gitlab-mr-comments",children:"Enable GitLab merge request comments"})," for details."]}),"\n",(0,r.jsxs)(n.p,{children:["The ",(0,r.jsx)(n.code,{children:"api"})," scoped token must be provided to Semgrep through the SCM connection. Semgrep no longer supports tokens provided in the GitLab CI/CD pipeline."]}),"\n",(0,r.jsx)(n.h4,{id:"bitbucket",children:"Bitbucket"}),"\n",(0,r.jsxs)(n.p,{children:["The Bitbucket token must be a repository access token or a workspace access token. See ",(0,r.jsx)(n.a,{href:"/category/bitbucket-pr-comments",children:"Enable Bitbucket pull request comments"})," for details."]}),"\n",(0,r.jsx)(n.h2,{id:"are-you-running-diff-aware-scans",children:"Are you running diff-aware scans?"}),"\n",(0,r.jsx)(n.p,{children:"In Managed Scans: Semgrep always runs diff-aware scans on pull and merge request events. Full scans run at scheduled intervals."}),"\n",(0,r.jsx)(n.p,{children:"In GitHub Actions and GitLab CI/CD: Semgrep runs diff-aware scans on pull or merge requests by default if you are using the recommended configuration."}),"\n",(0,r.jsxs)(n.p,{children:["In other SCMs or CI systems, or with unusual pipeline configurations: diff-aware scans may require additional setup. Review the ",(0,r.jsx)(n.a,{href:"/category/pr-or-mr-comments",children:"configuration instructions"})," for your SCM or ",(0,r.jsx)(n.a,{href:"/deployment/customize-ci-jobs#set-up-diff-aware-scans",children:"custom configuration for your CI jobs"})," and ensure you have configured your scans correctly."]}),"\n",(0,r.jsx)(n.h3,{id:"identify-a-diff-aware-scan",children:"Identify a diff-aware scan"}),"\n",(0,r.jsx)(n.p,{children:"Semgrep diff-aware scans are most easily identified by reviewing three items in the scan log:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"The triggering event"}),"\n",(0,r.jsx)(n.li,{children:"The number of files scanned"}),"\n",(0,r.jsx)(n.li,{children:"Whether a baseline scan is conducted"}),"\n"]}),"\n",(0,r.jsx)(n.h4,{id:"the-triggering-event-for-the-scan",children:"The triggering event for the scan"}),"\n",(0,r.jsxs)(n.p,{children:["The triggering event for the scan in GitHub or GitLab should typically be ",(0,r.jsx)(n.code,{children:"pull_request"}),". This is the easiest to find but the least reliable, since it's possible to configure diff-aware scans on other event types. In the scan log, this appears as:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"environment - running in environment github-actions, triggering event is pull_request\n"})}),"\n",(0,r.jsx)(n.p,{children:"This line indicates that a scan was triggered from a pull request, and is most likely diff-aware, whereas:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"environment - running in environment github-actions, triggering event is schedule\n"})}),"\n",(0,r.jsx)(n.p,{children:"would not typically indicate a diff-aware scan. Scheduled scans are typically full scans of all code in the repository."}),"\n",(0,r.jsx)(n.h4,{id:"the-number-of-files-scanned",children:"The number of files scanned"}),"\n",(0,r.jsx)(n.p,{children:"The number of files scanned should be approximately the number of files modified in the PR, and should not include all files in the repository."}),"\n",(0,r.jsx)(n.p,{children:"In the scan log, this appears as:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"Scanning 2 files tracked by git with 1194 Code rules, 860 Secrets rules, 768 Supply Chain rules:\n"})}),"\n",(0,r.jsx)(n.p,{children:"This would most likely be a diff-aware scan, unless you are doing a test on a very small repository."}),"\n",(0,r.jsx)(n.p,{children:"However, if you instead see something like:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"Scanning 1002 files tracked by git with 1971 Code rules, 858 Secrets rules, 3619 Supply Chain rules:\n"})}),"\n",(0,r.jsx)(n.p,{children:"and the repository's total number of files is around 1000, then this most likely is not a diff-aware scan."}),"\n",(0,r.jsx)(n.h4,{id:"whether-a-baseline-scan-is-conducted",children:"Whether a baseline scan is conducted"}),"\n",(0,r.jsx)(n.p,{children:"Finally, during the process of a diff-aware scan, Semgrep actually conducts two scans: one at the current tip or head of the PR, and one at the baseline ref or commit."}),"\n",(0,r.jsxs)(n.p,{children:["The following log is anonymized and truncated for clarity, and the exact format of the log may evolve over time. It shows the key item to review, the two distinct ",(0,r.jsx)(n.code,{children:"Scan Status"})," entries:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 Debugging Info \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\n  SCAN ENVIRONMENT\n  versions    - semgrep 1.76.0 on python 3.11.9\n  environment - running in environment github-actions, triggering event is pull_request\nFixing git state for github action pull request\nNot on head ref: fcc...d21; checking that out now.\n\n  CONNECTION\nUsing 104...950 as the merge-base of f5e...1a7 and fcc...d21\n  Initializing scan (deployment=testsemgrep, scan_id=29062823)\n  Enabled products: Code, Supply Chain\n...\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 Scan Status \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n  Scanning 52 files tracked by git with 1898 Code rules, 818 Supply Chain rules:\n...\n  Current version has 60 findings.\n\nCreating git worktree from '104...950' to scan baseline.\n...\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 Scan Status \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n  Scanning 4 files tracked by git with 2 Code rules, 34 Supply Chain rules:\n"})}),"\n",(0,r.jsxs)(n.p,{children:["The initial scan, which occurs at the current commit for the pull request ",(0,r.jsx)(n.code,{children:"fcc...d21"}),", scans 52 files and identifies 60 findings. The baseline scan, which occurs at ",(0,r.jsx)(n.code,{children:"104...950"}),", scans 4 files. Baseline scans typically scan fewer files than the original scan, as they only need to scan files and rules that have findings in the initial scan to determine which of those findings were present before the changes made in the pull or merge request."]}),"\n",(0,r.jsx)(n.p,{children:"This also means that baseline scans are not conducted if all findings in the current commit that are in files added by the PR or MR, because those findings could not have been present before. This information is logged as:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"Skipping baseline scan, because all current findings are in files that didn't exist in the baseline commit.\n"})}),"\n",(0,r.jsx)(n.p,{children:"If the baseline scan is skipped, the scan is still diff-aware; the baseline scan just isn't necessary."}),"\n",(0,r.jsxs)(n.p,{children:["If you review the scans that are not generating comments and find that they are not diff-aware, and you have followed the preceding guidance, feel free to ",(0,r.jsx)(n.a,{href:"/docs/support",children:"reach out to Semgrep support"})," for help."]}),"\n",(0,r.jsx)(n.h2,{id:"have-you-correctly-configured-your-policies",children:"Have you correctly configured your policies?"}),"\n",(0,r.jsx)(n.h3,{id:"code-the-rule-is-in-comment-or-block-mode",children:"Code: The rule is in Comment or Block mode"}),"\n",(0,r.jsxs)(n.p,{children:["To receive comments for a Code rule, the rule must be in the ",(0,r.jsx)(n.a,{href:"https://semgrep.dev/docs/semgrep-code/policies#block-a-pr-or-mr-through-rule-modes",children:"Comment or Block policy mode"}),". Rules in Monitor mode do not generate comments."]}),"\n",(0,r.jsx)(n.h3,{id:"secrets-the-rule-is-in-comment-or-block-mode-and-validation-settings-match",children:"Secrets: The rule is in Comment or Block mode, and validation settings match"}),"\n",(0,r.jsxs)(n.p,{children:["For Secrets, the rule's ",(0,r.jsx)(n.a,{href:"https://semgrep.dev/docs/semgrep-secrets/policies#rule-modes",children:"policy mode"})," must be Comment or Block. The secret must also be valid, unless you have customized your validation state policy. See ",(0,r.jsx)(n.a,{href:"https://semgrep.dev/docs/semgrep-secrets/policies#validation-state-policies",children:"Validation state policies"})," for more information."]}),"\n",(0,r.jsx)(n.h3,{id:"supply-chain-the-finding-meets-your-criteria-for-commenting-or-blocking",children:"Supply Chain: The finding meets your criteria for commenting or blocking"}),"\n",(0,r.jsx)(n.p,{children:'Supply Chain provides flexible policy configuration based on a variety of criteria. When setting up a policy, you can choose the actions "Leave a comment" or "Block and leave a comment". These actions are similar to the Comment and Block modes of Code and Secrets policies. If a finding meets your configured criteria for commenting, then it should result in a comment on the PR or MR.'}),"\n",(0,r.jsx)(n.h2,{id:"is-this-the-first-time-this-finding-has-been-identified",children:"Is this the first time this finding has been identified?"}),"\n",(0,r.jsxs)(n.p,{children:["PR or MR comments are generated when a finding is new. If a finding was seen in a previous scan, it is ",(0,r.jsx)(n.a,{href:"/semgrep-code/remove-duplicates",children:"not new"})," and a comment is not generated."]}),"\n",(0,r.jsx)(n.p,{children:"This prevents repeated comments on findings that have already notified developers."}),"\n",(0,r.jsx)(n.h2,{id:"if-youre-still-having-trouble",children:"If you're still having trouble"}),"\n",(0,r.jsxs)(n.p,{children:["If you've addressed these issues but are still not seeing comments, please ",(0,r.jsx)(n.a,{href:"/docs/support",children:"reach out for help"}),", and provide information on what you've tried so far."]})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},19607:(e,n,i)=>{i.d(n,{A:()=>s});const s=i.p+"assets/images/gh-app-permissions-all-5fcf0e61e73389b97bae3ab2e1287389.png"},28453:(e,n,i)=>{i.d(n,{R:()=>o,x:()=>a});var s=i(96540);const r={},t=s.createContext(r);function o(e){const n=s.useContext(t);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),s.createElement(t.Provider,{value:n},e.children)}},66196:(e,n,i)=>{i.d(n,{A:()=>s});const s=i.p+"assets/images/gh-app-permissions-select-7175bdd38e911f0347285647ecd13530.png"}}]);